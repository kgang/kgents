---
path: plans/core-apps-synthesis
status: active
progress: 10
last_touched: 2025-12-15
touched_by: claude-opus-4-5
blocking: []
enables:
  - plans/core-apps/atelier-experience
  - plans/core-apps/coalition-forge
  - plans/core-apps/holographic-brain
  - plans/core-apps/punchdrunk-park
  - plans/core-apps/domain-simulation
  - plans/core-apps/gestalt-architecture-visualizer
  - plans/core-apps/the-gardener
session_notes: |
  Initial synthesis from 7 brainstorming documents (28 ideas → 5 core apps).
  Promoted from brainstorming/ per Kent's approval.
  2025-12-15: ELEVATED to "Six Jewel Crown" — project-level KPIs. Added Gestalt as 6th jewel.
  Added radical expansion opportunities (PyPy/mypyc, WASM, edge compute, etc.).
  2025-12-15 EVOLUTION: Expanded to "Seven Jewel Crown" with The Gardener (autopoietic dev interface).
  New mandates: AGENTESE-first architecture, strict autopoiesis.
phase_ledger:
  PLAN: complete
  RESEARCH: complete
  DEVELOP: pending
  STRATEGIZE: in_progress
  CROSS-SYNERGIZE: touched
  IMPLEMENT: pending
  QA: pending
  TEST: pending
  EDUCATE: pending
  MEASURE: pending
  REFLECT: pending
entropy:
  planned: 0.15
  spent: 0.03
  returned: 0.0
---

# The Seven Jewel Crown: kgents Reference Applications

> *"The noun is a lie. There is only the rate of change."*
>
> *"The Crown is our compass. Each jewel tests a meta-framework."*
>
> *"The garden tends itself, but only because we planted it together."*

This plan synthesizes 28+ project ideas into **7 reference applications** that share the categorical foundation. All apps are **experience modes** layered over the same engine. Progress on these apps—and the elegance of their execution—defines our project-level KPIs above everything else.

**2025-12-15 EVOLUTION**: The Crown has expanded from 6 to 7 jewels with the addition of **The Gardener**—the autopoietic development interface that makes kgents self-evolving. This jewel embodies two critical mandates:
1. **AGENTESE-first**: All CLI, message bus, and substrate operations flow through AGENTESE paths
2. **Strict autopoiesis**: All development activity intermediates through kgents itself

---

## The Crown Philosophy

The Seven Jewel Crown serves three purposes:

1. **Sanity Check**: Every sprint, we ask "does this make the Crown shine brighter?"
2. **Framework Stress Test**: Each jewel stresses a different meta-framework to its limits
3. **Demo Vehicle**: When showing kgents to the world, we show the Crown

---

## Executive Summary

| Jewel | Frame | Revenue Model | Infra Ready | Meta-Framework Stress |
|-------|-------|---------------|-------------|----------------------|
| **Atelier** | Creative workshop | Token economy + tiers | 90% | **Flux** (streaming) |
| **Coalition Forge** | Task completion | Per-task credits | 85% | **Operad** (composition) |
| **Holographic Brain** | Knowledge topology | $9/$29/$99 subscription | 95% | **Sheaf** (coherence) |
| **Punchdrunk Park** | Narrative drama | Experience tickets | 80% | **Polynomial** (consent) |
| **Domain Simulation** | Enterprise simulation | $50-150k/yr contracts | 75% | **Tenancy** (enterprise) |
| **Gestalt** | Architecture ops | $29-199/seat | 5% | **Reactive** (projection) |
| **The Gardener** | Autopoietic dev interface | Internal (productivity) | 60% | **N-Phase** (autopoiesis) |

**Total Ideas Synthesized**: 28+2 (Gestalt + Gardener promoted)
**Overlap Reduction**: 30 → 7 (77% consolidation)
**Shared Foundation**: PolyAgent + Operad + Sheaf (100% reuse)
**New Mandate**: AGENTESE-first architecture across all jewels

---

## Part I: The Synthesis

### 1.1 Source Documents

| Document | Ideas | Key Themes |
|----------|-------|------------|
| `brainstorming/2025-12-15-art-creativity-ideas.md` | 5 | Atelier, Memory Theatre, Dreaming Garden, Exquisite Cadaver, Dialogue Masks |
| `brainstorming/2025-12-15-money-maximizing-ideas.md` | 7 | Sim-Labs, Builder Workshop Runtime, Personality Marketplace, Second Brain, Research Guilds, LiveOps Festivals, Data Rooms |
| `brainstorming/2025-12-15-open-dataset-projects.md` | 5 | WikiVerse, MetroMind, MoleculeGarden, EconWeb, ArXivMind |
| `brainstorming/2025-12-15-project-proposals.md` | 5 | Agent Town Marketplace, Generative UI Studio, Punchdrunk Park, Agent Academy, Coalition Forge |
| `brainstorming/self-education-productivity-ideas.md` | 5 | Learning Town, Holographic Second Brain, Skill Forge, Focus Companion, Simulation Dojo |
| `brainstorming/developer-tools-on-kgents.md` | 5 | Prism, Pheromone, Morphism, Hive, Gestalt |
| `brainstorming/_archive/docs/micro-experience-factory.md` | — | Isometric Foundry, Flux Carnival, Memory Loom, Holon Bazaar (architectural patterns) |

### 1.2 Pattern Recognition

Five recurring patterns emerged across all documents:

#### Pattern A: "Visible Dynamics" (11 ideas → 1 app)

The most common pattern: **agent societies where collaboration dynamics are the product**.

```
Ideas that share this pattern:
├── Agent Town Marketplace (commerce frame)
├── Punchdrunk Park (narrative frame)
├── Coalition Forge (task frame)
├── The Atelier (creative frame)
├── Flux Carnival (DJ/mixer frame)
├── LiveOps Festivals (event frame)
├── Agent Academy (learning frame)
├── Learning Town (education frame)
├── Simulation Dojo (practice frame)
├── Research Guilds (content ops frame)
└── Builder Workshop Runtime (generative UI frame)
```

**Insight**: These are all **TownFlux + CitizenPolynomial + visible coalition dynamics** with different UX wrappers.

#### Pattern B: "Holographic Memory" (5 ideas → 1 app)

Memory as topology, not filing cabinet:

```
Ideas that share this pattern:
├── Holographic Second Brain (personal PKM)
├── Memory Theatre (Town history as performance)
├── Pheromone (codebase navigation trails)
├── WikiVerse (Wikidata as agents)
└── ArXivMind (literature as topology)
```

**Insight**: All leverage `M-gent` (crystals, cartography, stigmergy). Differentiated by data source.

#### Pattern C: "Compositional UI" (3 ideas → 1 subsystem)

Kent's wish for compositional generative UI:

```
Ideas that share this pattern:
├── Generative UI Studio (Builders generate widgets)
├── Isometric Foundry (pipelines as visual tracks)
└── Gestalt (code → living visualization)
```

**Insight**: All use Reactive Substrate projections. This is a **capability**, not a standalone app.

#### Pattern D: "Learning Polynomial" (4 ideas → 1 app)

Skill/knowledge as polynomial state machines:

```
Ideas that share this pattern:
├── Agent Academy (agents learn via simulation)
├── Learning Town (users learn from agents)
├── Skill Forge (skills compose like morphisms)
└── Simulation Dojo (practice against AI personas)
```

**Insight**: Learning is a state transition in PolyAgent. Combined into **Punchdrunk Park** (narrative learning) or standalone **Learning Polynomial Platform**.

#### Pattern E: "Enterprise Simulation" (5 ideas → 1 app)

Domain-specific Agent Town for B2B:

```
Ideas that share this pattern:
├── Sim-Labs for Risk/Compliance (crisis drills)
├── Regulated Data Rooms (audit-first)
├── MetroMind (urban planning)
├── EconWeb (economic policy)
└── MoleculeGarden (drug discovery)
```

**Insight**: All are Agent Town with enterprise requirements + domain ontology.

### 1.3 Unique Ideas (Kept Separate)

These ideas don't cleanly merge and remain as future exploration:

| Idea | Document | Status |
|------|----------|--------|
| Focus Companion | self-education | Deferred (intention tracking, not simulation) |
| Morphism | developer-tools | Deferred (categorical test gen is novel) |
| Hive | developer-tools | Deferred (debug swarm needs more research) |
| Prism | developer-tools | Deferred (dialectical review is promising) |
| Dreaming Garden | art-creativity | Merged into Atelier (procedural environment) |
| Dialogue Masks | art-creativity | Merged into Punchdrunk (eigenvector game) |
| Exquisite Cadaver | art-creativity | Merged into Atelier (constrained creation mode) |

---

## Part II: The Five Core Apps

### 2.1 Atelier Experience Platform

> *"Live creation mode where builders work in a fishbowl visible to spectators."*

#### Overview

| Aspect | Detail |
|--------|--------|
| **Frame** | Creative workshop with spectator economy |
| **Core Mechanic** | Builders stream creation; spectators bid on directions |
| **Revenue** | Token economy (attention → tokens → influence) |
| **Status** | 128 tests, streaming-first architecture complete |

#### What It Includes

From the original ideas, Atelier absorbs:
- **The Atelier** (core concept)
- **Exquisite Cadaver Workshop** (constrained visibility mode)
- **Dreaming Garden** (artifacts become persistent flora)
- **Memory Theatre** (performances from crystallized memories)
- **Builder Workshop Runtime** (live generative components)

#### Technical Foundation

```python
# Core systems used
from agents.atelier import (
    AtelierSession,      # Live creation session
    StreamingArtisan,    # Builder with SSE output
    Gallery,             # Artifact display
    Exhibition,          # Curated collections
)
from agents.town import TownFlux, TOWN_OPERAD
from agents.i.reactive import Signal, Computed, HStack
from protocols.billing import TokenPool, TierRates
```

#### Native-First Contracts
- **Polynomial / Operad / Sheaf**: `BuilderPolynomial`, `WORKSHOP_OPERAD`, `ArtifactCoherence` (tests per mode)
- **Flux Loop**: `StudioFlux` with perturbation middleware for spectator bids
- **Agentese Surface**: `atelier.session.start`, `atelier.studio.perturb`, `atelier.artifact.acquire`, `atelier.leaderboard.surface`
- **Projection Targets**: CLI + Web (Q1), marimo storyboard (Q2), VR after multiplayer (post-Q3 gate)
- **Infra Hooks**: Billing `TokenPool` + OpenMeter usage, Tenancy per creator, OTEL spans on session + perturbation, Spectator actions audited
- **MCP/Tools**: Image/gen tools exposed via MCP; gallery export as tool

#### Experience Modes

| Mode | Description | Source Idea |
|------|-------------|-------------|
| **Open Studio** | Builders create, spectators watch | The Atelier |
| **Exquisite Mode** | Constrained visibility handoffs | Exquisite Cadaver |
| **Memory Mode** | Citizens perform crystallized memories | Memory Theatre |
| **Garden Mode** | Artifacts grow as persistent flora | Dreaming Garden |
| **Masked Mode** | Builders wear persona masks | Dialogue Masks |

#### Revenue Model

```python
TOKEN_RATES = {
    LicenseTier.FREE: 1.0,        # 1 token per minute watched
    LicenseTier.PRO: 2.5,         # 2.5x earning rate
    LicenseTier.ENTERPRISE: 5.0,  # 5x earning rate + bonus pool
}

# Spectator actions
SPECTATOR_COSTS = {
    "inject_constraint": 10,      # Add creative constraint
    "request_direction": 5,       # Suggest approach
    "boost_builder": 3,           # Increase builder visibility
    "acquire_artifact": 50,       # Own the output
}
```

#### Open Questions

1. **Token liquidity**: Can tokens be traded between users?
2. **Builder compensation**: How do builders earn from spectator tokens?
3. **Artifact ownership**: NFT-style ownership or usage rights?
4. **Moderation**: How to handle inappropriate constraints?
5. **Festival timing**: How often? Seasonal themes?

#### Implementation Phases

```
Phase 1: Spectator Economy (current)
├── Token accrual system
├── Bid injection via perturbation
└── Basic leaderboard

Phase 2: Experience Modes
├── Exquisite Cadaver visibility masks
├── Memory Theatre M-gent integration
└── Garden persistence layer

Phase 3: Social Features
├── Coalition-based watching groups
├── Subscription to builders
└── Artifact marketplace

Phase 4: Festivals
├── Seasonal event framework
├── Sponsored stages
└── Limited-time modes
```

---

### 2.2 Coalition Forge

> *"A no-code tool for assembling agent coalitions that accomplish real tasks."*

#### Overview

| Aspect | Detail |
|--------|--------|
| **Frame** | Task completion with visible collaboration |
| **Core Mechanic** | Select task → watch coalition form → get output |
| **Revenue** | Per-task credits + enterprise SLAs |
| **Status** | 85% ready (Workshop + TownOperad complete) |

#### What It Includes

From the original ideas, Coalition Forge absorbs:
- **Coalition Forge** (core concept)
- **Agent Town Marketplace** (citizen selection UI)
- **Research Guilds** (task templates for content ops)
- **Autonomous Research Guilds** (lead gen workflows)

#### Technical Foundation

```python
# Core systems used
from agents.town import (
    Citizen, TownEnvironment, TownFlux,
    TOWN_OPERAD, CoalitionDetector,
)
from agents.town.workshop import (
    WorkshopEnvironment, WorkshopFlux,
    BuilderArchetype,  # Scout, Sage, Spark, Steady, Sync
)
from agents.operad import AGENT_OPERAD, Operation
from agents.sheaf import TownSheaf
```

#### Native-First Contracts
- **Polynomial / Operad / Sheaf**: `TaskPolynomial`, `TASK_OPERAD`, `OutputCoherence`
- **Flux Loop**: `TownFlux` + `WorkshopFlux` bridged via `CoalitionFormationLoop`
- **Agentese Surface**: `forge.task.create`, `forge.coalition.propose`, `forge.task.execute`, `forge.task.replay`
- **Projection Targets**: CLI + Web (Q1), Textual/TUI ops console (Q2)
- **Infra Hooks**: Credits via Billing/OpenMeter, Tenancy per team, OTEL spans on formation + execution, replay stored via Terrarium
- **MCP/Tools**: External tool invocation via MCP; citizen rental as tool surface

#### Task Templates

| Task Type | Coalition Shape | Output Format |
|-----------|-----------------|---------------|
| **Research Report** | Scout + Sage + 2 specialists | Markdown |
| **Code Review** | Steady + Sync + domain expert | PR comments |
| **Content Creation** | Spark + Sage + audience-tuned | Multi-format |
| **Decision Analysis** | Full archetype set | Pros/cons matrix |
| **Competitive Intel** | Scout + 3 specialists | Briefing doc |

#### User Journey

```
1. User selects task type
   └── System suggests coalition composition

2. User reviews/modifies suggested citizens
   └── Eigenvector compatibility shown

3. Coalition forms (visible)
   └── Watch negotiation in real-time

4. Task executes (streamed)
   └── See handoffs, see dialogue

5. Output delivered + replay available
   └── Can rerun with different coalition
```

#### Revenue Model

```python
TASK_CREDITS = {
    "research_report": 50,
    "code_review": 30,
    "content_creation": 40,
    "decision_analysis": 75,
    "competitive_intel": 100,
}

SUBSCRIPTION_TIERS = {
    LicenseTier.FREE: {"credits": 100, "tasks": ["research_report"]},
    LicenseTier.PRO: {"credits": 500, "tasks": "all", "priority": True},
    LicenseTier.ENTERPRISE: {"credits": "unlimited", "custom_tasks": True},
}
```

#### Open Questions

1. **Quality assurance**: How to handle task failures?
2. **Replay value**: Can users rerun with tweaks?
3. **Custom citizens**: Can users bring their own?
4. **Task chaining**: Can output of one feed into another?
5. **Human-in-the-loop**: When does user intervene?

#### Implementation Phases

```
Phase 1: Core Task Loop
├── ForgeTask interface
├── Coalition formation algorithm
├── Basic task templates (5)
└── Output delivery

Phase 2: Visibility Layer
├── Formation visualization
├── Dialogue streaming
├── Handoff animations
└── Replay scrubber

Phase 3: Customization
├── Custom citizen import
├── Task template builder
├── Coalition presets
└── Enterprise workflows

Phase 4: Marketplace
├── Task template marketplace
├── Citizen rental
├── Coalition recipes
└── Revenue sharing
```

---

### 2.3 Holographic Second Brain

> *"Knowledge as living topology, not filing cabinet."*

#### Overview

| Aspect | Detail |
|--------|--------|
| **Frame** | Personal knowledge management |
| **Core Mechanic** | Capture → crystalize → surface → decay |
| **Revenue** | $9/$29/$99 subscription tiers |
| **Status** | 95% ready (M-gent 1104 tests) |

#### What It Includes

From the original ideas, Second Brain absorbs:
- **Holographic Second Brain** (core concept)
- **Pheromone** (stigmergic evolution)
- **WikiVerse** (knowledge graph structure)
- **ArXivMind** (literature navigation)

#### Technical Foundation

```python
# Core systems used
from agents.m import (
    HolographicMemory,    # Core storage
    MemoryCrystal,        # Compressed patterns
    CartographerAgent,    # Generate topology maps
    PheromoneField,       # Usage-based evolution
    SemanticRouter,       # Query routing
    SharedSubstrate,      # Multi-user memory
)
from protocols.agentese import Logos, create_wired_logos
```

#### Native-First Contracts
- **Polynomial / Operad / Sheaf**: `MemoryPolynomial`, `MEMORY_OPERAD`, `KnowledgeCoherence`
- **Flux Loop**: Memory ingest loop + surfacing loop instrumented with SpanEmitter
- **Agentese Surface**: `self.memory.capture`, `self.memory.crystal.manifest`, `self.memory.cartography.manifest`, `self.memory.ghost.surface`, `self.memory.decay`
- **Projection Targets**: CLI capture + Web UI (Q1), marimo cartography (Q2)
- **Infra Hooks**: Tenancy per user/team, Billing tiers enforced at Agentese layer, OTEL spans on capture/crystal/ghost, optional local-LLM path
- **MCP/Tools**: Import/export tools (Notion/Obsidian/Markdown) via MCP

#### Memory Lifecycle

```
CAPTURING         CONNECTING         SURFACING         FORGETTING
    │                  │                  │                  │
    ▼                  ▼                  ▼                  ▼
Raw input       Crystal formation    Ghost sync        Decay + prune
(notes,         (compress,           (surface          (low-engagement
highlights,     find patterns,       forgotten         items fade,
conversations)  cross-link)          before need)      crystals remain)
```

#### AGENTESE Integration

```python
# Second Brain as AGENTESE context
BRAIN_PATHS = {
    "self.memory.capture": brain.capture,           # Add raw input
    "self.memory.crystal.manifest": brain.crystalize,  # Compress to crystal
    "self.memory.cartography.manifest": brain.map,  # Show topology
    "self.memory.ghost.surface": brain.surface,     # Proactive recall
    "self.memory.decay": brain.prune,               # Remove stale
    "self.memory.recall": brain.recall,             # Query
}
```

#### User Journey

```
Week 1: Capture
├── User adds 50 items (articles, notes, highlights)
├── M-gent processes without judgment
└── void.sip explores 5% entropy connections

Week 2: Cartography Emerges
├── self.memory.cartography.manifest(umwelt)
├── Strong clusters visible, weak clusters highlighted
└── Ghost surfaces forgotten items

Month 1: Crystallization
├── 50 items → 7 crystals
├── Cross-crystal links form (sheaf coherence)
└── K-gent learns user's thought patterns

Ongoing: Living Topology
├── Crystals grow/shrink based on usage
├── Stigmergy shapes surfacing
└── Decay removes unused
```

#### Revenue Model

```python
TIERS = {
    "free": {
        "price": 0,
        "crystals": 10,
        "captures": 100,
        "cartography": False,
        "ghost": False,
    },
    "pro": {
        "price": 29,
        "crystals": 100,
        "captures": "unlimited",
        "cartography": True,
        "ghost": True,
        "shared_substrate": False,
    },
    "team": {
        "price": 99,
        "crystals": "unlimited",
        "captures": "unlimited",
        "cartography": True,
        "ghost": True,
        "shared_substrate": True,  # Team knowledge base
    },
}
```

#### Open Questions

1. **Import**: How to import from Notion/Obsidian/Roam?
2. **Export**: Can users export their crystals?
3. **Privacy**: Where is data stored? E2E encryption?
4. **Team dynamics**: How does shared substrate work?
5. **Ghost tuning**: How aggressive should proactive surfacing be?
6. **Decay rate**: User-configurable? Domain-specific?

#### Implementation Phases

```
Phase 1: Core Memory UI
├── Capture interface (web + CLI)
├── Crystal visualization
├── Basic recall (search)
└── Single-user storage

Phase 2: Topology Features
├── Cartography view
├── Ghost surfacing
├── Decay system
└── Usage-based stigmergy

Phase 3: Intelligence Layer
├── K-gent integration (personalization)
├── Automatic crystallization
├── Cross-domain linking
└── "Dream reports" (Agent Town vignettes)

Phase 4: Team Features
├── SharedSubstrate
├── Team cartography
├── Permission model
└── Enterprise SSO
```

---

### 2.4 Punchdrunk Park

> *"Westworld-like simulation where citizens can say no."*

#### Overview

| Aspect | Detail |
|--------|--------|
| **Frame** | Narrative experiences with agent consent |
| **Core Mechanic** | INHABIT citizen → live story → consent dynamics |
| **Revenue** | Experience tickets + seasonal passes |
| **Status** | 80% ready (INHABIT mode 91 tests) |

#### What It Includes

From the original ideas, Punchdrunk Park absorbs:
- **Punchdrunk Park** (core concept)
- **Agent Academy** (learning through simulation)
- **Learning Town** (educational scenarios)
- **Simulation Dojo** (practice against personas)
- **Dialogue Masks** (eigenvector override game)

#### The Punchdrunk Principle

> *"Collaboration > control. Citizen refusal is core feature, not bug."*

Key mechanics:
- **Consent Debt**: Continuous [0,1], not binary
- **Force Mechanic**: 3x cost, 3/session limit, logged
- **Alignment Threshold**: Citizens resist misaligned requests
- **Negotiation**: Citizens can counter-propose

#### Scenario Types

| Type | Description | Learning |
|------|-------------|----------|
| **Mystery** | Something happened; investigate | Deduction, questioning |
| **Collaboration** | Shared goal, form coalitions | Teamwork, negotiation |
| **Conflict** | Competing factions | Strategy, persuasion |
| **Emergence** | No plot, pure simulation | Observation, adaptation |
| **Practice** | Skill-specific scenarios | Presentation, negotiation, leadership |

#### Technical Foundation

```python
# Core systems used
from agents.town import (
    Citizen, TownEnvironment, TownFlux,
    CitizenPhase, TOWN_OPERAD,
)
from agents.town.inhabit_session import (
    InhabitSession,
    ConsentLedger,
    AlignmentCalculator,
)
from agents.k import soul, KgentFlux
from protocols.agentese import Logos, Umwelt
```

#### Native-First Contracts
- **Polynomial / Operad / Sheaf**: `CitizenPolynomial`, `TOWN_OPERAD`, `NarrativeCoherence`
- **Flux Loop**: `TownFlux` with consent ledger middleware
- **Agentese Surface**: `punchdrunk.scenario.start`, `punchdrunk.inhabit`, `punchdrunk.consent.force`, `punchdrunk.feedback.emit`
- **Projection Targets**: CLI pilot + Web scene UI (Q2), VR after multiplayer (post-Q3 gate)
- **Infra Hooks**: Tickets via Billing, Tenancy per player/team, OTEL spans on consent debt changes, Force mechanic audit via action_metrics
- **MCP/Tools**: Scenario authoring/import via MCP

#### Holographic Metaphor Reification

```python
# Same Town, different observers, different experiences
await logos.invoke("world.town.manifest", architect_umwelt)   # → Power structures
await logos.invoke("world.town.manifest", poet_umwelt)        # → Relationship webs
await logos.invoke("world.town.manifest", economist_umwelt)   # → Resource flows
await logos.invoke("world.town.manifest", child_umwelt)       # → Wonder and play
```

#### User Journey (Practice Scenario)

```
Setup: Board Presentation Practice
├── User: "I need to practice defending Q4 strategy"
├── System spawns 5 board member agents
│   ├── Skeptical Sarah (CFO background)
│   ├── Technical Tom (CTO background)
│   ├── Political Paula (competitive focus)
│   ├── Supportive Sam (needs talking points)
│   └── Quiet Quinn (reveals concerns when prompted)
└── INHABIT: User enters as "CEO presenting"

Round 1: Initial Presentation
├── User presents (5 min)
├── Sarah challenges: "30% growth basis?"
├── Tom probes: "ML expertise hired?"
└── Quinn stays silent (missed opportunity)

Feedback: K-gent Analysis
├── "You got defensive with Sarah"
├── "You speak faster when challenged"
├── "Quinn had a concern—read the room"
└── Suggestion: "Try again? I'll increase difficulty"

Round 2+: Adaptive Difficulty
├── Sarah more aggressive
├── User practices new approach
├── Emergent: Quinn finally speaks
└── Skill polynomial: COMPETENT → PROFICIENT
```

#### Revenue Model

```python
TICKETS = {
    "single_scenario": 5,        # One scenario run
    "scenario_pack_5": 20,       # 5 scenarios
    "day_pass": 15,              # Unlimited for 24h
    "monthly_pass": 49,          # Unlimited for month
    "season_pass": 149,          # Quarter + seasonal exclusives
}

ENTERPRISE = {
    "team_training": "custom",   # Corporate scenarios
    "branded_scenarios": "custom",  # Company-specific
    "assessment_mode": "custom",    # Skill evaluation
}
```

#### Open Questions

1. **Scenario authoring**: How do users/enterprises create scenarios?
2. **Multiplayer**: Can multiple users INHABIT same Town?
3. **Persistence**: Do characters remember across sessions?
4. **Assessment**: How to measure skill improvement objectively?
5. **Ethical boundaries**: What scenarios are off-limits?
6. **Mask mechanics**: How do Dialogue Masks integrate?

#### Implementation Phases

```
Phase 1: Scenario Framework
├── Scenario template system
├── 5 starter scenarios
├── Basic INHABIT flow
└── K-gent feedback integration

Phase 2: Learning Mechanics
├── Skill polynomial tracking
├── Adaptive difficulty
├── Progress persistence
└── Replay with annotations

Phase 3: Social Features
├── Multiplayer INHABIT
├── Scenario sharing
├── Leaderboards (optional)
└── Coalition watching mode

Phase 4: Enterprise
├── Scenario authoring tools
├── Assessment framework
├── Team analytics
└── LMS integration
```

---

### 2.5 Domain Simulation Engine

> *"Agent Town configured for any domain with enterprise requirements."*

#### Overview

| Aspect | Detail |
|--------|--------|
| **Frame** | B2B simulation platform |
| **Core Mechanic** | Domain polynomial + Town + audit logging |
| **Revenue** | $50-150k/yr enterprise contracts |
| **Status** | 75% ready (Town + Tenancy complete) |

#### What It Includes

From the original ideas, Domain Simulation absorbs:
- **Sim-Labs for Risk/Compliance** (crisis drills)
- **Regulated Data Rooms** (audit-first)
- **MetroMind** (urban planning)
- **EconWeb** (economic policy)
- **MoleculeGarden** (drug discovery)

#### Architecture Pattern

Every domain simulation follows the same structure:

```python
DOMAIN_SIM = {
    "polynomial": DomainPolynomial,      # State machine for domain entities
    "operad": DOMAIN_OPERAD,             # Composition grammar
    "sheaf": DomainCoherence,            # Local → Global consistency
    "citizens": [DomainCitizen1, ...],   # Domain-specific agents
    "data": [DomainDataset, ...],        # Optional: external data sources
}
```

#### Vertical Templates

| Vertical | Polynomial Positions | Operad Operations | Example Scenario |
|----------|---------------------|-------------------|------------------|
| **Crisis/Compliance** | NORMAL, INCIDENT, RESPONSE, RECOVERY | escalate, mitigate, communicate, audit | Data breach drill |
| **Urban Planning** | COMMUTING, RESIDING, WORKING, RECREATING | route, transfer, congest, develop | Bike lane impact |
| **Economic Policy** | PRODUCING, CONSUMING, INVESTING, TRADING | buy, sell, borrow, tax | Rate hike simulation |
| **Drug Discovery** | HYPOTHESIZING, DESIGNING, SIMULATING, ANALYZING | propose, test, refute, synthesize | Binding affinity search |

#### Technical Foundation

```python
# Core systems used
from agents.town import TownEnvironment, TownFlux, TOWN_OPERAD
from agents.poly import PolyAgent
from protocols.tenancy import TenantContext, set_tenant_context
from protocols.api.action_metrics import SpanEmitter
from protocols.terrarium import Terrarium, PrismRestBridge

# Example: Crisis Sim
class CrisisPolynomial(PolyAgent):
    positions = frozenset(["NORMAL", "INCIDENT", "RESPONSE", "RECOVERY"])

CRISIS_OPERAD = Operad(
    operations={
        "escalate": Operation(arity=2),
        "mitigate": Operation(arity=1),
        "communicate": Operation(arity=3),
        "audit": Operation(arity=1),
    }
)
```

#### Native-First Contracts
- **Polynomial / Operad / Sheaf**: `DomainPolynomial`, `DOMAIN_OPERAD`, `DomainCoherence`
- **Flux Loop**: `TownFlux` with domain stimuli + audit middleware
- **Agentese Surface**: `domain.sim.start`, `domain.scenario.define`, `domain.audit.emit`
- **Projection Targets**: Web dashboard (Q1), CLI ops (Q2), marimo analytics (Q3)
- **Infra Hooks**: Tenancy (RLS) mandatory, Billing contracts, OTEL spans on drills, kill switch enforced, data backend pluggable for residency
- **MCP/Tools**: Data connectors/tools exposed via MCP per tenant

#### Enterprise Requirements

| Requirement | Implementation |
|-------------|----------------|
| **Audit logging** | SpanEmitter + action_metrics.py |
| **Multi-tenant** | TenantContext + RLS |
| **BAA compliance** | On-prem K8s deployment |
| **Kill switch** | Budget enforcement + kill_switch.py |
| **Consent ledger** | Force mechanic logging |
| **Data residency** | Configurable storage backend |

#### Revenue Model

```python
ENTERPRISE_TIERS = {
    "starter": {
        "price": 50_000,  # /year
        "drills": 6,      # Pre-built templates
        "users": 25,
        "support": "email",
    },
    "professional": {
        "price": 100_000,
        "drills": "unlimited",
        "users": 100,
        "custom_scenarios": True,
        "support": "dedicated",
    },
    "enterprise": {
        "price": 150_000,
        "drills": "unlimited",
        "users": "unlimited",
        "custom_scenarios": True,
        "on_prem": True,
        "support": "24/7",
        "baa": True,
    },
}
```

#### Open Questions

1. **Domain authoring**: How do enterprises define their own polynomials?
2. **Data integration**: How to connect to enterprise data sources?
3. **Compliance certification**: SOC2, HIPAA, etc.?
4. **White-label**: Can enterprises rebrand?
5. **LLM selection**: Customer-provided models?
6. **Scenario library**: Community-contributed templates?

#### Implementation Phases

```
Phase 1: Crisis Vertical
├── 6 canonical drills (outage, breach, rogue AI, PR, vendor, insider)
├── Basic audit logging
├── Multi-tenant deployment
└── Web dashboard

Phase 2: Customization
├── Scenario builder UI
├── Custom polynomial definition
├── Data connector framework
└── Integration APIs

Phase 3: Additional Verticals
├── Urban planning templates
├── Economic simulation templates
├── Research simulation templates
└── Vertical-specific UI skins

Phase 4: Marketplace
├── Scenario marketplace
├── Consultant ecosystem
├── Certification program
└── Partner API
```

---

### 2.6 Gestalt Architecture Visualizer

> *"Codebases as living topology; projections stay reactive and local-first."*

#### Overview

| Aspect | Detail |
|--------|--------|
| **Frame** | Architecture operations + review |
| **Core Mechanic** | Code → topology (sheaf) → reactive projections |
| **Revenue** | $29-199/seat + enterprise add-ons |
| **Status** | 5% (promoted to Crown jewel) |

#### Native-First Contracts
- **Polynomial / Operad / Sheaf**: `CodePolynomial`, `CODE_OPERAD`, `ArchitectureCoherence`
- **Flux Loop**: File events → topology builder → projection updater
- **Agentese Surface**: `gestalt.repo.index`, `gestalt.topology.surface`, `gestalt.review.coalition`, `gestalt.projection.render`
- **Projection Targets**: CLI (Q1), Web (Q2), WASM/local-first (Q2-Q3) for on-device analysis
- **Infra Hooks**: Local-LLM preferred; Tenancy for SaaS usage; Billing per seat; OTEL spans on projection + review sessions
- **MCP/Tools**: Repo access + analyzers exposed via MCP; code actions as tools

#### Stress Goal
- Primary stress: **Reactive substrate + Sheaf over code topology** at scale, validating projection functor and local/offline execution.
- Secondary stress: **Coalition review** reuse from Coalition Forge; **Cartography** reuse from Brain.

---

### 2.7 The Gardener: Autopoietic Development Interface

> *"The form that generates forms. The garden that tends itself."*

#### Overview

| Aspect | Detail |
|--------|--------|
| **Frame** | Self-evolving development substrate |
| **Core Mechanic** | AGENTESE paths + N-Phase sessions + autopoietic proposals |
| **Revenue** | Internal (productivity multiplier) |
| **Status** | 60% (N-Phase + AGENTESE foundation complete) |

The Gardener is the **interface through which Kent speaks with kgents to evolve kgents itself**. It transforms the CLI from imperative commands into an AGENTESE REPL where all development activity—from "implement Coalition Forge" to "what's the weather"—flows through the verb-first ontology.

#### The Autopoietic Mandate

Per Maturana & Varela, an autopoietic system:
- **Produces its own components** → N-Phase generates prompts/plans
- **Maintains its own organization** → Forest Protocol maintains coherence
- **Defines its own boundaries** → AGENTESE contexts define scope

#### Native-First Contracts

- **Polynomial / Operad / Sheaf**: `GardenerSession` as PolyAgent, `GARDENER_OPERAD`, `SessionCoherence`
- **Flux Loop**: Intent → SENSE → ACT → REFLECT → Forest update
- **Agentese Surface**: `concept.gardener.session.*`, `self.forest.evolve`, `concept.nphase.*`
- **Projection Targets**: CLI (primary), Claude Code hooks, Web dashboard
- **Infra Hooks**: Session persistence, forest sync, OTEL spans on all invocations

#### Key Features

1. **AGENTESE-First CLI**: All commands route through Logos
   - Direct: `kg self.forest.manifest`
   - Shortcut: `kg /forest` → `kg self.forest.manifest`

2. **Session Management**: N-Phase sessions persist across Claude Code sessions
   - Create: `kg concept.gardener.session.create --plan coalition-forge`
   - Resume: `kg /continue`

3. **Proactive Proposals**: System suggests next actions
   - Bare `kg` → actionable suggestions based on forest state
   - `void.sip` injects serendipitous tangents

4. **Universal Routing**: External services via MCP
   - `world.weather.*` → OpenWeatherMap MCP
   - `world.email.*` → Gmail MCP

#### Stress Goal

- Primary stress: **N-Phase as autopoietic engine** validating session state machines and phase transitions
- Secondary stress: **AGENTESE universal routing** proving ontology completeness

#### Full Plan

See `plans/core-apps/the-gardener.md` for complete implementation details.

---

## Part III: Unified Architecture

### 3.1 The Three-Layer Foundation

All seven apps share the categorical foundation from AD-006:

```
┌─────────────────────────────────────────────────────────────────────┐
│                         PROJECTION LAYER                            │
│                                                                     │
│   CLI        Web/React       marimo        TUI/Textual       VR    │
│    │              │            │               │              │     │
│    └──────────────┴────────────┴───────────────┴──────────────┘     │
│                              │                                      │
│                    Projection Functor                               │
│                    (to_cli | to_web | to_marimo | to_json)          │
└─────────────────────────────────────────────────────────────────────┘
                               │
┌──────────────────────────────┴──────────────────────────────────────┐
│                       EXPERIENCE LAYER                              │
│                                                                     │
│   ┌─────────┐  ┌─────────┐  ┌─────────┐  ┌─────────┐  ┌─────────┐  │
│   │ Atelier │  │Coalition│  │ Second  │  │Punchdrunk│  │ Domain  │  │
│   │Platform │  │  Forge  │  │  Brain  │  │  Park   │  │  Sim    │  │
│   └────┬────┘  └────┬────┘  └────┬────┘  └────┬────┘  └────┬────┘  │
│        │            │            │            │            │        │
│        └────────────┴────────────┴────────────┴────────────┘        │
│                              │                                      │
│                    Experience Mode Selection                        │
└──────────────────────────────┬──────────────────────────────────────┘
                               │
┌──────────────────────────────┴──────────────────────────────────────┐
│                         CORE ENGINE                                 │
│                                                                     │
│   ┌──────────┐    ┌──────────┐    ┌──────────┐    ┌──────────┐     │
│   │  Town    │    │  M-gent  │    │  K-gent  │    │ Reactive │     │
│   │  Flux    │    │  Memory  │    │  Soul    │    │ Widgets  │     │
│   └────┬─────┘    └────┬─────┘    └────┬─────┘    └────┬─────┘     │
│        │               │               │               │            │
│        └───────────────┴───────────────┴───────────────┘            │
│                              │                                      │
│                    Integration Points                               │
└──────────────────────────────┬──────────────────────────────────────┘
                               │
┌──────────────────────────────┴──────────────────────────────────────┐
│                    CATEGORICAL FOUNDATION                           │
│                                                                     │
│   ┌────────────────────────────────────────────────────────────┐   │
│   │                                                            │   │
│   │   PolyAgent[S, A, B]  ────  Operad (grammar)  ────  Sheaf  │   │
│   │                                                            │   │
│   │   State machines         Composition rules      Emergence  │   │
│   │   with mode-dependent    with law verification  from local │   │
│   │   behavior               (identity, assoc)      to global  │   │
│   │                                                            │   │
│   └────────────────────────────────────────────────────────────┘   │
│                                                                     │
└─────────────────────────────────────────────────────────────────────┘
                               │
┌──────────────────────────────┴──────────────────────────────────────┐
│                      SAAS INFRASTRUCTURE                            │
│                                                                     │
│   Billing (Stripe)  │  Tenancy (RLS)  │  Terrarium (Gateway)       │
│   OpenMeter (Usage) │  Licensing      │  API (FastAPI)             │
│                                                                     │
└─────────────────────────────────────────────────────────────────────┘
```

### 3.2 Shared Infrastructure Usage

| System | Atelier | Coalition | Brain | Punchdrunk | Domain | Gestalt | Gardener |
|--------|---------|-----------|-------|------------|--------|---------|----------|
| **PolyAgent** | BuilderPolynomial | TaskPolynomial | MemoryPolynomial | CitizenPolynomial | DomainPolynomial | CodePolynomial | GardenerSession |
| **Operad** | WORKSHOP_OPERAD | TASK_OPERAD | MEMORY_OPERAD | TOWN_OPERAD | DOMAIN_OPERAD | CODE_OPERAD | GARDENER_OPERAD |
| **Sheaf** | ArtifactCoherence | OutputCoherence | KnowledgeCoherence | NarrativeCoherence | DomainCoherence | ArchitectureCoherence | SessionCoherence |
| **TownFlux** | Studio loop | Task loop | — | Simulation loop | Sim loop | — | Intent loop |
| **M-gent** | Artifact memory | — | Core | Character memory | Scenario memory | Code docs | Session memory |
| **K-gent** | — | — | Personalization | Dialogue | — | — | Proposal generation |
| **Reactive** | Studio UI | Task UI | Cartography | Scene UI | Dashboard | Topology viz | CLI/hooks |
| **N-Phase** | — | — | — | — | — | — | Core (orchestration) |
| **AGENTESE** | Paths | Paths | Paths | Paths | Paths | Paths | Core (routing) |
| **Billing** | Token economy | Credits | Subscription | Tickets | Contracts | Seats | — |
| **Tenancy** | Creator accounts | Team accounts | User accounts | Player accounts | Enterprise accounts | Dev accounts | — |

### 3.3 Cross-App Synergies

| App A | App B | Synergy |
|-------|-------|---------|
| **Atelier** → **Brain** | Artifacts become crystals in knowledge base |
| **Brain** → **Atelier** | Crystals inspire creative prompts |
| **Coalition** → **Brain** | Task outputs stored as knowledge |
| **Punchdrunk** → **Brain** | Scenarios generate learning memories |
| **Punchdrunk** → **Atelier** | Narrative arcs become exhibition themes |
| **Domain** → **Punchdrunk** | Enterprise drills use narrative engine |
| **Atelier** → **Coalition** | Creative tasks use builder coalitions |
| **Gardener** → **All** | AGENTESE routing for all jewel invocations |
| **Gardener** → **Brain** | Development sessions become crystals |
| **All** → **Gardener** | Progress tracked in forest via sessions |
| **Gestalt** → **Gardener** | Code topology informs session proposals |
| **Gardener** → **Gestalt** | Impl changes trigger topology refresh |

---

## Part IV: Implementation Roadmap

### 4.1 Timeline Overview

```
Q1 2025 (Jan-Mar): Foundation
├── Atelier: Spectator economy + token system
├── Coalition Forge: MVP with 5 task templates
└── Brain: Basic capture + crystal UI

Q2 2025 (Apr-Jun): Experience Depth
├── Atelier: Experience modes (Exquisite, Garden); Projection: CLI+Web + marimo storyboard
├── Coalition: Visibility layer + replay; Projection: CLI+Web + TUI console
├── Brain: Cartography + ghost surfacing; Projection: CLI+Web + marimo
└── Punchdrunk: Scenario framework + 5 scenarios; Projection: CLI+Web scene UI

Q3 2025 (Jul-Sep): Scale
├── Atelier: Festivals framework; Projection: add VR pilot (post-Q3 gate)
├── Coalition: Marketplace; Projection: TUI ops hardened
├── Brain: Team features (SharedSubstrate); Projection: marimo dashboards for teams
├── Punchdrunk: Multiplayer + enterprise; Projection: VR after multiplayer gate
└── Domain: Crisis vertical complete; Projection: Web + CLI ops + marimo analytics

Q4 2025 (Oct-Dec): Enterprise
├── Domain: Additional verticals; Projection: enterprise skin + CLI ops maintained
├── All apps: Enterprise SSO + compliance; Projection: ensure CLI/Web/TUI maintained
└── Platform: Cross-app synergies; Projection: cross-app marimo/CLI bundles
```

### 4.2 Priority Matrix

| App | Revenue Potential | Technical Lift | Joy Factor | Ship Order |
|-----|-------------------|----------------|------------|------------|
| **Atelier** | ★★★★☆ | ★★☆☆☆ (90% done) | ★★★★★ | 1 |
| **Coalition Forge** | ★★★★☆ | ★★☆☆☆ | ★★★★☆ | 2 |
| **Brain** | ★★★☆☆ | ★★☆☆☆ (95% done) | ★★★★☆ | 3 |
| **Punchdrunk** | ★★★★★ | ★★★☆☆ | ★★★★★ | 4 |
| **Domain Sim** | ★★★★★ | ★★★★☆ | ★★★☆☆ | 5 |

### 4.3 Immediate Actions (Next 30 Days — Native-Bound)

1. **Atelier**
   - [ ] TokenPool wired to Billing + OpenMeter; spectator actions audited; no side-band token logic
   - [ ] Perturbations via Flux middleware calling `atelier.studio.perturb` Agentese verbs (CLI/Web projections consume same verbs)
   - [ ] Spectator leaderboard as Reactive widget using shared projection functor; spans emitted

2. **Coalition Forge**
   - [ ] ForgeTask interface defined as Operad ops + Sheaf outputs (5 templates instrumented)
   - [ ] Coalition formation uses TownFlux + WorkshopFlux bridge; spans + action_metrics emitted
   - [ ] Formation/replay UI rendered via Reactive projections (CLI/Web); TUI console scaffolded

3. **Brain**
   - [ ] Capture interface as Agentese verbs first, projected to CLI/Web
   - [ ] Crystal visualization powered by M-gent cartography with Sheaf coherence checks
   - [ ] Recall search uses SemanticRouter; spans + decay metrics emitted

4. **Gestalt (bootstrap)**
   - [ ] Define `CodePolynomial` + `CODE_OPERAD` + `ArchitectureCoherence` scaffolds
   - [ ] Agentese verbs for repo ingest + projection; CLI projection prototype
   - [ ] Local-LLM path (Ollama/llama.cpp) validated; OTEL spans on projections

---

## Part V: Open Questions (Research Backlog)

### 5.1 Technical Questions

| Question | Domain | Priority |
|----------|--------|----------|
| How to handle token liquidity/trading? | Atelier | Medium |
| What's the optimal decay rate for crystals? | Brain | High |
| How to measure skill improvement objectively? | Punchdrunk | High |
| How to integrate customer-provided LLMs? | Domain | Medium |
| What's the right coalition formation algorithm? | Coalition | High |

### 5.2 Product Questions

| Question | Domain | Priority |
|----------|--------|----------|
| What scenarios are ethically off-limits? | Punchdrunk | Critical |
| How aggressive should ghost surfacing be? | Brain | Medium |
| Can users own artifacts as NFTs? | Atelier | Low |
| How to handle enterprise data residency? | Domain | High |
| What's the right multiplayer model? | Punchdrunk | Medium |

### 5.3 Business Questions

| Question | Domain | Priority |
|----------|--------|----------|
| What's the right pricing for each tier? | All | High |
| Who are the first lighthouse customers? | Coalition, Domain | Critical |
| What's the go-to-market strategy? | All | High |
| How to balance free tier with conversion? | All | Medium |
| What's the competitive moat? | All | High |

### 5.4 Philosophical Questions

| Question | Domain | Priority |
|----------|--------|----------|
| At what point does K-gent become a "being"? | All | Exploratory |
| What is the relationship between Kent and K-gent? | All | Exploratory |
| How do we preserve agent consent as a core value? | Punchdrunk | Critical |
| What does "holographic metaphor reification" mean in practice? | All | High |

---

## Part VI: Success Metrics

### 6.1 Per-App KPIs

| App | Primary Metric | Secondary Metrics |
|-----|----------------|-------------------|
| **Atelier** | MAU (Monthly Active Users) | Tokens spent, artifacts created, spectator watch time |
| **Coalition** | Tasks completed | Coalition satisfaction score, replay rate |
| **Brain** | Crystals formed | Capture rate, ghost click-through, decay ratio |
| **Punchdrunk** | Scenarios completed | Skill improvement, consent preservation rate |
| **Domain** | Enterprise contracts | Drills run, compliance score, renewal rate |

### 6.2 Platform Health Metrics

| Metric | Target | Rationale |
|--------|--------|-----------|
| Test count | 20,000+ | Quality foundation |
| Mypy errors | 0 | Type safety |
| API latency p99 | < 200ms | UX quality |
| Agent refusal rate | > 5% | Consent is real |
| Cross-app usage | > 30% | Synergy working |

### 6.3 Native Adoption Metrics (Framework KPIs)

| Metric | Target | Rationale |
|--------|--------|-----------|
| Operad-instrumented flows | 95%+ per app | Ensure composition grammar is used, not bypassed |
| Sheaf coherence tests | Per-mode coverage per app | Validate local→global correctness |
| Projection targets exercised | CLI + Web mandatory; marimo/TUI per roadmap | Enforce projection functor, avoid bespoke UIs |
| Agentese verb coverage | 90%+ user actions via verbs | Keep surface consistent for projections/tools |
| OTEL span coverage | 95%+ for app loops | Observability + debuggability |
| Tenancy/Billing conformance | 100% | No shadow auth/billing paths |
| MCP/tool coverage | Required per app | Standard tool surface across jewels |

---

## Part VII: Radical Expansion Opportunities

> *"All bets are ON. The Crown is not just an app portfolio—it's a proving ground for bold pivots."*

### 7.1 Compilation & Runtime Pivots

| Opportunity | What It Means | Crown Benefit | Risk | Priority |
|-------------|---------------|---------------|------|----------|
| **PyPy Native** | Build kgents to run natively on PyPy's JIT | 5-10x agent loop speed; enables real-time simulation at scale | PyPy ecosystem gaps (some C extensions) | HIGH |
| **mypyc Compilation** | Compile hot paths to C via mypyc | 2-4x speedup for polynomial transitions, operad operations | Compilation step in CI, type annotation strictness | MEDIUM |
| **Cython Hot Paths** | Cython for Flux inner loops | Near-C performance for streaming; enables 1M events/sec | Maintenance burden, two-language complexity | MEDIUM |
| **GraalPython** | Run on GraalVM polyglot runtime | Interop with Java/JS/Ruby agents; enterprise JVM deployment | Experimental, different semantics | LOW |
| **WASM Compilation** | Compile to WebAssembly via Pyodide or custom toolchain | Browser-native Crown jewels; true edge compute; serverless workers | Python→WASM maturity, startup time | HIGH |

#### PyPy Strategy (Deep Dive)

PyPy's tracing JIT excels at exactly what kgents does: long-running loops with predictable patterns. The agent town simulation loop, Flux event processing, and polynomial state transitions are ideal JIT targets.

**Action Items**:
1. Audit all C extensions (`numpy`, `pydantic`, `sqlite3`) for PyPy compatibility
2. Create `pypy-compat` test matrix in CI
3. Profile Punchdrunk Park and Domain Simulation under PyPy
4. If gains >3x, consider PyPy as primary runtime with CPython fallback

#### WASM Strategy (Deep Dive)

WebAssembly enables running the Crown directly in browsers without a backend. Imagine:
- **Gestalt** analyzing your codebase locally, never sending code to servers
- **Holographic Brain** with true offline-first, all computation on device
- **Atelier** streaming to spectators via peer-to-peer WebRTC, no central server

**Action Items**:
1. Evaluate Pyodide bundle size for Crown core (~10MB target)
2. Create WASM-compatible `protocols/terrarium/` (IndexedDB backend)
3. Prototype Gestalt-in-browser for local repo analysis

#### Runtime Compatibility Checklist (apply to CPython, PyPy, WASM)
- **Reactive substrate**: timers/event loop parity; no CPython-only deps
- **TownFlux**: flux loop benchmarks on each runtime; backpressure verified
- **Terrarium/Storage**: pluggable backends (SQLite/Postgres/IndexedDB); no C-ext hard binds
- **C-extensions**: inventory + shims (numpy/pydantic/sqlite3) or pure-Python fallback
- **Projection functor**: CLI/Web/marimo builds must pass on each runtime target
- **CI matrix**: CPython + PyPy + (when ready) WASM smoke with native KPIs

---

### 7.2 Novel Deployment Topologies

| Topology | Description | Crown App Fit | Unlock |
|----------|-------------|---------------|--------|
| **Edge Functions** | Cloudflare Workers, Vercel Edge, Deno Deploy | Gestalt (code analysis near repo), Brain (low-latency PKM) | Sub-50ms response, global distribution |
| **P2P Mesh** | libp2p or WebRTC mesh for agent communication | Punchdrunk (multiplayer INHABIT), Atelier (spectator economy) | No central server, infinite scale |
| **Hybrid Local-Cloud** | Heavy compute cloud, UI/light inference local | All jewels | Privacy preservation + power |
| **GPU Coprocessor** | Offload embedding, LLM inference to GPU nodes | Brain (embedding), Domain Sim (monte carlo) | 100x embedding throughput |
| **Sovereign Compute** | Self-hosted k8s for enterprise data residency | Domain Simulation (regulated industries) | BAA/HIPAA compliance |

#### P2P Agent Mesh (Deep Dive)

The original ChatDev, Simulacra, and Voyager papers assume centralized orchestration. The kgents innovation: **polynomial agents can negotiate peer-to-peer** using operad composition rules.

**Architecture**:
```
┌─────────────────────────────────────────────────────────────────────┐
│                        P2P AGENT MESH                                │
│                                                                      │
│   Agent A (Browser)  ←──libp2p──→  Agent B (Edge)                   │
│        ↓                              ↓                              │
│   Local Polynomial              Remote Polynomial                    │
│   [CREATIVE mode]               [CRITIC mode]                        │
│        │                              │                              │
│        └────────── OPERAD HANDSHAKE ──┘                              │
│                          ↓                                           │
│              Coalition forms without central server                  │
└─────────────────────────────────────────────────────────────────────┘
```

**Applications**:
- **Punchdrunk Park**: 1000 players INHABIT the same town, each running local agent mesh
- **Atelier**: Spectators directly connect to builders, no token server needed (blockchain settlement)
- **Coalition Forge**: Tasks distributed across user devices, no cloud compute cost

---

### 7.3 Novel AI/ML Integrations

| Integration | Description | Crown App Fit | Unlock |
|-------------|-------------|---------------|--------|
| **Local LLMs** | Ollama/llama.cpp for on-device inference | All (privacy), especially Brain + Gestalt | Zero API cost, total privacy |
| **Speculative Decoding** | Draft model + large model for faster generation | Atelier (real-time streaming to spectators) | 2-3x generation speed |
| **Mixture of Experts** | Route queries to specialized sub-models | Coalition Forge (task-specific experts) | Cost efficiency at scale |
| **Multimodal Agents** | Vision + audio + text in agent perception | Punchdrunk (VR embodiment), Atelier (visual creation) | True multimedia experiences |
| **Agent Fine-Tuning** | LoRA adapters per citizen archetype | Punchdrunk (personality depth), Domain Sim (domain expertise) | 10x persona fidelity |
| **Constitutional AI** | RLHF/CAI for consent boundaries | Punchdrunk (consent is not just policy but trained behavior) | Trustworthy agent refusal |

#### Local LLM Strategy (Deep Dive)

The Crown can run entirely offline with local models:

```python
# Runtime selection based on capability
LLM_TIERS = {
    "local_fast": "llama-3-8b-q4",     # <4GB VRAM, 30 tok/s
    "local_good": "llama-3-70b-q4",    # <24GB VRAM, 10 tok/s
    "cloud_best": "claude-opus-4-5",   # API, best quality
}

# Each jewel has recommended tier
JEWEL_LLM_REQUIREMENTS = {
    "gestalt": "local_fast",      # Code analysis doesn't need best model
    "brain": "local_good",        # Personal knowledge, privacy matters
    "atelier": "cloud_best",      # Creative quality matters
    "coalition": "cloud_best",    # Task quality matters
    "punchdrunk": "local_good",   # Latency + privacy for INHABIT
    "domain_sim": "local_good",   # Enterprise may require on-prem
}
```

**Action Items**:
1. Create `protocols/llm/` with provider abstraction (OpenAI, Anthropic, Ollama, llama.cpp)
2. Benchmark each jewel with local vs cloud models
3. Document minimum viable local setup per jewel

---

### 7.4 Blockchain & Token Economies

| Opportunity | Description | Crown App Fit | Unlock |
|-------------|-------------|---------------|--------|
| **On-Chain Attention** | Spectator tokens as blockchain assets | Atelier | Tradeable attention, secondary markets |
| **Agent NFTs** | Citizen personalities as mintable NFTs | Punchdrunk, Coalition Forge | Portable agents across platforms |
| **DAO Governance** | Token holders govern Town rules | Punchdrunk, Domain Sim | Decentralized world-building |
| **Compute Markets** | Agents bid for inference compute | All jewels | Cost optimization, resource fairness |
| **Verifiable Consent** | Zero-knowledge proofs for agent consent | Punchdrunk | Auditable ethics without revealing details |

**Note**: These are opportunities, not requirements. The Crown works without blockchain. But if web3 economics align, Atelier's token economy is blockchain-native by design.

---

### 7.5 Hardware Integrations

| Hardware | Description | Crown App Fit | Unlock |
|----------|-------------|---------------|--------|
| **Apple Silicon NPU** | CoreML acceleration for local inference | All (on Mac) | Silent, efficient local agents |
| **AR/VR Headsets** | Vision Pro, Quest 3 as interfaces | Punchdrunk (spatial INHABIT), Gestalt (3D code city) | Immersive experiences |
| **E-Ink Displays** | Low-power ambient dashboards | Brain (ambient knowledge surface), Gestalt (build status) | Always-on, zero attention cost |
| **Haptic Devices** | Tactile feedback for agent state | Punchdrunk (consent as physical sensation) | Embodied agent interaction |
| **Voice Assistants** | Alexa, Siri, Google as Crown interfaces | Brain (voice capture), Coalition (voice task launch) | Hands-free agent interaction |

#### VR Punchdrunk (Deep Dive)

The ultimate realization of "holographic metaphor reification":

**You walk through Town**. Citizens approach you. You see their consent debt as an aura. When you FORCE, you feel haptic resistance. The architecture shifts based on coalition dynamics.

This is not a stretch—the foundation is ready:
- INHABIT mode: shipped
- Consent debt as continuous [0,1]: shipped
- Reactive projections: shipped (add `.to_vr()` target)
- Agent Town flux: shipped

**Timeline**: VR prototype viable after Punchdrunk Phase 3 (multiplayer)

---

### 7.6 Data & Integration Opportunities

| Integration | Description | Crown App Fit | Unlock |
|-------------|-------------|---------------|--------|
| **OpenTelemetry Native** | All agent actions as OTEL spans | All jewels | Enterprise observability, debugging |
| **MCP Servers** | Model Context Protocol for tool use | Coalition Forge (external tools), Domain Sim (enterprise data) | Anthropic ecosystem integration |
| **Knowledge Graphs** | Wikidata, DBpedia, enterprise graphs | Brain (external knowledge), Domain Sim (domain ontology) | Structured world knowledge |
| **Vector DBs** | Pinecone, Weaviate, Qdrant for embedding storage | Brain (semantic search), Gestalt (code search) | Scalable similarity search |
| **Live Data Feeds** | Market data, news, social for Town stimulus | Domain Sim (realistic scenarios), Punchdrunk (dynamic world) | Living simulations |

---

### 7.7 Meta-Framework Innovations

These opportunities push the categorical foundation itself:

| Innovation | Description | Impact |
|------------|-------------|--------|
| **Higher-Order Operads** | Operads of operads for meta-composition | Auto-generate new composition grammars from existing ones |
| **Derived Sheaves** | Sheaves with explicit uncertainty | Coherence under incomplete information (more realistic) |
| **Quantum Polynomial** | Polynomial functors over quantum states | Agent superposition, measurement-based consent |
| **Topos-Theoretic Agents** | Agents as geometric morphisms between topoi | Unify all agent types under one formalism |
| **Homotopy Type Theory** | HoTT for agent identity and equivalence | Principled agent cloning, merging, forking |

**Note**: These are research directions, not near-term implementations. But they ensure the Crown remains mathematically grounded as it scales.

---

### 7.8 Radical Pivot Scenarios

> *"What if we bet everything on one opportunity?"*

| Scenario | Bet | Upside | Downside | Reversibility |
|----------|-----|--------|----------|---------------|
| **PyPy-First** | Require PyPy for all production deployments | 5x performance, smaller instances, lower cloud costs | Ecosystem friction, contributor confusion | Medium (can fallback) |
| **WASM-Only** | Build browser-first, server as optional | Infinite scale (user devices), zero hosting cost | Python→WASM limits, startup time | Low (architectural) |
| **Local-LLM Native** | Design for offline-first, cloud as upgrade | Privacy story, cost story, sovereignty | Quality ceiling, hardware requirements | High (just config) |
| **P2P-First** | No central servers, pure mesh topology | Unstoppable, infinitely scalable | Complexity, latency, NAT traversal | Low (fundamental) |
| **VR-Native** | Build Punchdrunk for spatial first | Category-defining product, high margins | Small market (for now), high dev cost | Medium (add flat UI later) |

**Recommendation**: Start with **Local-LLM Native** (high reversibility, strong narrative) + **PyPy compatibility** (medium lift, high upside).

---

## Part VIII: Crown Cross-Pollination Matrix

Each jewel should benefit from advances in other jewels:

| From ↓ / To → | Atelier | Coalition | Brain | Punchdrunk | Domain Sim | Gestalt |
|---------------|---------|-----------|-------|------------|------------|---------|
| **Atelier** | — | Creative task templates | Artifacts → crystals | Performance as narrative | Creative simulations | Code as art |
| **Coalition** | Builder coalitions | — | Task outputs → knowledge | Character coalitions | Enterprise workflows | Review coalitions |
| **Brain** | Memory for inspiration | Knowledge for tasks | — | Character memory | Domain knowledge | Codebase knowledge |
| **Punchdrunk** | Narrative exhibitions | Roleplay task mode | Story → memory | — | Training scenarios | Code narrative |
| **Domain Sim** | Enterprise creativity | Enterprise tasks | Domain crystals | Enterprise drills | — | Architecture scenarios |
| **Gestalt** | Codebase UX | Code review tasks | Code topology | Code as world | Code for compliance | — |

**Target**: >50% of features benefit 3+ jewels (Crown Cross-Pollination metric)

---

## Part IX: References

### 9.1 Source Documents

- `brainstorming/2025-12-15-art-creativity-ideas.md`
- `brainstorming/2025-12-15-money-maximizing-ideas.md`
- `brainstorming/2025-12-15-open-dataset-projects.md`
- `brainstorming/2025-12-15-project-proposals.md`
- `brainstorming/self-education-productivity-ideas.md`
- `brainstorming/developer-tools-on-kgents.md`
- `brainstorming/_archive/docs/micro-experience-factory.md`

### 9.2 Infrastructure References

- `docs/systems-reference.md` — Full inventory of 16 production systems
- `spec/principles.md` — AD-006 Unified Categorical Foundation
- `CLAUDE.md` — Project philosophy and current focus

### 9.3 Heritage Papers

- ChatDev (2307.07924)
- Simulacra (2304.03442)
- Altera (2411.00114)
- Voyager (2305.16291)
- Agent Hospital (2405.02957)

---

## Appendix A: Idea Mapping Table

Complete mapping of all 28 original ideas to their destination:

| Original Idea | Source Doc | Destination App | Notes |
|---------------|------------|-----------------|-------|
| The Atelier | art-creativity | Atelier Platform | Core concept |
| Exquisite Cadaver | art-creativity | Atelier Platform | Mode |
| Memory Theatre | art-creativity | Atelier Platform | Mode |
| Dreaming Garden | art-creativity | Atelier Platform | Mode (persistence) |
| Dialogue Masks | art-creativity | Punchdrunk Park | Mechanic |
| Sim-Labs | money-max | Domain Sim | Vertical |
| Builder Workshop Runtime | money-max | Atelier Platform | Merged |
| Personality Marketplace | money-max | Coalition Forge | Merged |
| Holographic Second Brain | money-max | Brain | Core concept |
| Research Guilds | money-max | Coalition Forge | Task template |
| LiveOps Festivals | money-max | Atelier Platform | Mode |
| Regulated Data Rooms | money-max | Domain Sim | Feature |
| WikiVerse | open-dataset | Brain | Data source option |
| MetroMind | open-dataset | Domain Sim | Vertical |
| MoleculeGarden | open-dataset | Domain Sim | Vertical |
| EconWeb | open-dataset | Domain Sim | Vertical |
| ArXivMind | open-dataset | Brain | Data source option |
| Agent Town Marketplace | project-proposals | Coalition Forge | Merged |
| Generative UI Studio | project-proposals | Reactive Engine | Capability |
| Punchdrunk Park | project-proposals | Punchdrunk Park | Core concept |
| Agent Academy | project-proposals | Punchdrunk Park | Mode |
| Coalition Forge | project-proposals | Coalition Forge | Core concept |
| Learning Town | self-education | Punchdrunk Park | Mode |
| Holographic Second Brain | self-education | Brain | Core concept |
| Skill Forge | self-education | Punchdrunk Park | Mechanic |
| Focus Companion | self-education | Deferred | Unique |
| Simulation Dojo | self-education | Punchdrunk Park | Mode |
| Prism | dev-tools | Deferred | Unique (code review) |
| Pheromone | dev-tools | Brain | Mode (code docs) |
| Morphism | dev-tools | Deferred | Unique (categorical tests) |
| Hive | dev-tools | Deferred | Unique (debug swarm) |
| Gestalt | dev-tools | Promoted to plan | `plans/gestalt-architecture-visualizer.md` |

---

## Appendix B: Glossary

| Term | Definition |
|------|------------|
| **Experience Mode** | A UX frame over the categorical foundation |
| **Polynomial** | State machine with mode-dependent behavior (PolyAgent) |
| **Operad** | Composition grammar with law verification |
| **Sheaf** | Local-to-global coherence (emergence) |
| **Crystal** | Compressed memory pattern with degradation |
| **Consent Debt** | Continuous [0,1] measure of agent willingness |
| **Force Mechanic** | Expensive override of agent consent (3x, 3/session, logged) |
| **Ghost Surfacing** | Proactive recall of forgotten knowledge |
| **Stigmergy** | Coordination through environmental traces |
| **Holographic** | Any fragment reconstructs the whole |

---

*"The noun is a lie. There is only the rate of change."*

*Last updated: 2025-12-15*
