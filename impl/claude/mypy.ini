# mypy configuration
# Strict mode with targeted relaxations for external deps and test files
#
# Performance optimizations (2025-01-10):
#   - Incremental mode: Only recheck changed files (~30-40% faster on re-runs)
#   - Fixed-format cache: Up to 2x faster incremental builds (mypy 1.18+)
#   - SQLAlchemy plugin: Properly type ORM models (DEPRECATED in SQLAlchemy 2.1)
#
# For even faster checks, use the mypy daemon:
#   dmypy run -- --strict --explicit-package-bases agents/ bootstrap/ runtime/
#
# Configuration Philosophy (2025-01-10):
#   - strict = True globally, relax per-module as needed
#   - Test files get relaxed checking (fixtures, mocks, dynamic typing)
#   - External libs: prefer installing types-* packages over ignore_missing_imports
#   - Use specific error codes in type: ignore comments (enable_error_code = ignore-without-code)

[mypy]
strict = True
explicit_package_bases = True

# =============================================================================
# PERFORMANCE: Incremental checking (cache between runs)
# =============================================================================
# Dramatically speeds up re-runs by only checking changed files
incremental = True
# Fixed-format cache for faster incremental builds (stable in mypy 1.18+)
# Note: Will become default in mypy 1.20+
# fixed_format_cache = True  # Enable after upgrading to mypy 1.18+

# =============================================================================
# ERROR REPORTING: Better diagnostics
# =============================================================================
# Always show error codes for targeted type: ignore comments
show_error_codes = True
# Require specific error codes in type: ignore comments (enabled Phase 3, 2025-01-10)
# This prevents blanket ignores that hide new errors. Use: # type: ignore[error-code]
enable_error_code = ignore-without-code

# =============================================================================
# PLUGINS: ORM and framework support
# =============================================================================
# NOTE: SQLAlchemy mypy plugin is DEPRECATED and will be removed in SQLAlchemy 2.1
# Migration path: Use SQLAlchemy 2.0's native mapped_column() and PEP 484 typing
# See: https://docs.sqlalchemy.org/en/20/orm/extensions/mypy.html
plugins = sqlalchemy.ext.mypy.plugin

# Exclude archived directories, generated code, scripts, test files, and examples
# NOTE: Test files MUST be excluded via regex because mypy glob patterns don't
# support test_*.py naming (patterns like [mypy-test_*] are invalid).
# The previous per-module overrides for test files were SILENTLY IGNORED!
exclude = (?x)(
    ^activate/
    | ^_archive/
    | .*-archived.*
    | .*/_archived/.*
    | .*/_generated/.*
    | ^terrarium-archived/
    | ^scripts/
    | /test_[^/]*\.py$
    | ^test_[^/]*\.py$
    | /_tests/
    | /tests/
    | example[^/]*\.py$
    | /examples/
    | verify_[^/]*\.py$
  )

# =============================================================================
# EXTERNAL LIBRARIES (no type stubs)
# =============================================================================
# Using glob patterns to reduce repetition

# [mypy-redis.*] - REMOVED: types-redis installed (2025-01-10)

[mypy-fakeredis.*]
ignore_missing_imports = True

[mypy-asyncpg.*]
ignore_missing_imports = True

[mypy-lark.*]
ignore_missing_imports = True

[mypy-sentence_transformers.*]
ignore_missing_imports = True

[mypy-openai.*]
ignore_missing_imports = True

[mypy-chromadb.*]
ignore_missing_imports = True

[mypy-faiss.*]
ignore_missing_imports = True

[mypy-dspy.*]
ignore_missing_imports = True

[mypy-uvicorn.*]
ignore_missing_imports = True

[mypy-fastapi.*]
ignore_missing_imports = True

[mypy-textual.*]
ignore_missing_imports = True

[mypy-rich.*]
ignore_missing_imports = True

[mypy-grpc.*]
ignore_missing_imports = True

[mypy-grpcio.*]
ignore_missing_imports = True

[mypy-grpcio_tools.*]
ignore_missing_imports = True

[mypy-kopf.*]
ignore_missing_imports = True

[mypy-kubernetes.*]
ignore_missing_imports = True

[mypy-kubernetes_asyncio.*]
ignore_missing_imports = True

[mypy-yaml.*]
ignore_missing_imports = True

[mypy-hypothesis.*]
ignore_missing_imports = True

[mypy-prometheus_client.*]
ignore_missing_imports = True

[mypy-google.*]
ignore_missing_imports = True

[mypy-pgvector.*]
ignore_missing_imports = True

[mypy-qdrant_client.*]
ignore_missing_imports = True

[mypy-watchdog.*]
ignore_missing_imports = True

[mypy-opentelemetry.*]
ignore_missing_imports = True

[mypy-websockets.*]
ignore_missing_imports = True

# [mypy-stripe.*] - Stubs installed but stripe package not a runtime dependency
# The billing module has optional imports that work at runtime
[mypy-protocols.billing.*]
disable_error_code = attr-defined
warn_unused_ignores = False

[mypy-marimo.*]
ignore_missing_imports = True

[mypy-alembic.*]
ignore_missing_imports = True

[mypy-nats.*]
ignore_missing_imports = True

[mypy-anywidget.*]
ignore_missing_imports = True

[mypy-traitlets.*]
ignore_missing_imports = True

[mypy-IPython.*]
ignore_missing_imports = True

# Additional libraries without stubs (2025-01-10)
[mypy-bert_score.*]
ignore_missing_imports = True

[mypy-transformers.*]
ignore_missing_imports = True

# =============================================================================
# EXAMPLE/DEMO FILES (relaxed strictness - prototypes, not production)
# =============================================================================
# NOTE (2025-01-10): Example files now excluded via regex above.
# Patterns like [mypy-*.*example*] were INVALID (star must match whole segment).
# Valid patterns for examples/ directories are kept:

[mypy-*.examples.*]
disallow_untyped_defs = False
disallow_untyped_calls = False
warn_unused_ignores = False
disable_error_code = no-untyped-def, no-untyped-call, var-annotated, arg-type

[mypy-*.*.examples.*]
disallow_untyped_defs = False
disallow_untyped_calls = False
warn_unused_ignores = False
disable_error_code = no-untyped-def, no-untyped-call, var-annotated, arg-type

# =============================================================================
# MODULES WITH UNTYPED EXTERNAL DECORATORS
# =============================================================================
# FastAPI and kopf decorators are untyped, so we relax decorator strictness

[mypy-agents.w.server]
disallow_untyped_decorators = False
warn_unused_ignores = False

[mypy-protocols.terrarium.gateway]
disallow_untyped_decorators = False
warn_unused_ignores = False

# K8s operators - REMOVED (2025-01-10): infra/k8s/operators/ directory does not exist
# These configs were for kopf decorators which have complex type signatures

[mypy-protocols.agentese.jit]
warn_unused_ignores = False

# =============================================================================
# GENERATED CODE (skip entirely)
# =============================================================================

[mypy-protocols.proto.generated.*]
ignore_errors = True

# =============================================================================
# INTERNAL WIP MODULES
# =============================================================================

[mypy-impl.*]
ignore_missing_imports = True

[mypy-shared]
ignore_errors = True

[mypy-shared.*]
ignore_missing_imports = True

[mypy-agents.d.transform_agent]
ignore_missing_imports = True

[mypy-agents.d.bicameral]
ignore_missing_imports = True

[mypy-agents.d.modal_scope]
ignore_missing_imports = True

[mypy-agents.e.parser.p_integration]
ignore_missing_imports = True

[mypy-agents.m.compaction]
ignore_missing_imports = True

[mypy-agents.m.crystallization_integration]
ignore_missing_imports = True

[mypy-agents.town.ui.*]
ignore_missing_imports = True

[mypy-protocols.cli.companions]
ignore_missing_imports = True

[mypy-protocols.cli.igent_synergy]
ignore_missing_imports = True

[mypy-protocols.cli.scientific]
ignore_missing_imports = True

# CLI handlers/contexts with WIP/deleted module imports
# REMOVED (2025-01-10): protocols.cli.handlers.{tether,dev,prompt,daemon,flinch} - files don't exist
[mypy-protocols.cli.handlers.play]
ignore_errors = True

[mypy-protocols.cli.instance_db.*]
ignore_errors = True

[mypy-protocols.cli.contexts.concept]
ignore_errors = True

[mypy-protocols.cli.contexts.self_]
ignore_errors = True

[mypy-protocols.cli.contexts.time_]
ignore_errors = True

[mypy-protocols.cli.contexts.void]
ignore_errors = True

[mypy-protocols.cli.glass]
ignore_errors = True

[mypy-protocols.cli.repl]
ignore_errors = True

# REMOVED (2025-01-10): protocols/prompt/ directory does not exist
# Configs were: protocols.prompt.{compiler,cli,sources.*,rollback.*,soft_section,section_base,metrics.*}

# REMOVED (2025-01-10): agents.town._archive_ui.* - directory does not exist

[mypy-agents.town.server]
ignore_errors = True

[mypy-protocols.api.atelier]
ignore_missing_imports = True

[mypy-protocols.api.town]
ignore_missing_imports = True

[mypy-infra.k8s.*]
ignore_missing_imports = True

[mypy-__main__.*]
ignore_missing_imports = True

# Polynomial functors (WIP - experimental typing)
[mypy-agents.poly.*]
ignore_errors = True

[mypy-agents.operad.*]
ignore_errors = True

# =============================================================================
# TEST FILES (relaxed strictness)
# =============================================================================
# NOTE (2025-01-10): Test files are now EXCLUDED via regex in the exclude= setting
# because mypy module patterns don't support underscore prefixes like test_*.py
#
# Patterns like [mypy-test_*] and [mypy-*.test_*] were SILENTLY IGNORED!
# This was discovered when test_probes.py had 51 errors despite the config.
#
# The following patterns for test _directories_ (not files) still work:
#   - [mypy-*._tests.*] matches agents/t/_tests/test_foo.py as module agents.t._tests.test_foo
#   - [mypy-*.tests.*] matches agents/town/tests/test_foo.py
#
# But since test files are now excluded entirely, these patterns are just for
# documentation purposes if we ever want to re-enable strict checking on tests.
#
# REMOVED INVALID PATTERNS (2025-01-10):
#   [mypy-test_*] - star can't match underscore prefix
#   [mypy-*.test_*] - same issue at any depth
#   [mypy-*.*.test_*], [mypy-*.*.*.test_*], [mypy-*.*.*.*.test_*]

[mypy-conftest]
disallow_untyped_defs = False
disallow_untyped_calls = False
disallow_untyped_decorators = False
warn_unused_ignores = False
disable_error_code = no-untyped-def, arg-type, attr-defined, var-annotated, union-attr

# Top-level test modules
[mypy-testing]
disallow_untyped_defs = False
disallow_untyped_calls = False
disallow_untyped_decorators = False
warn_unused_ignores = False
disable_error_code = no-untyped-def, arg-type, attr-defined, var-annotated, union-attr

[mypy-testing.*]
disallow_untyped_defs = False
disallow_untyped_calls = False
disallow_untyped_decorators = False
warn_unused_ignores = False
disable_error_code = no-untyped-def, arg-type, attr-defined, var-annotated, union-attr

[mypy-qa]
disallow_untyped_defs = False
disallow_untyped_calls = False
disallow_untyped_decorators = False
warn_unused_ignores = False
disable_error_code = no-untyped-def, arg-type, attr-defined, var-annotated, union-attr

[mypy-qa.*]
disallow_untyped_defs = False
disallow_untyped_calls = False
disallow_untyped_decorators = False
warn_unused_ignores = False
disable_error_code = no-untyped-def, arg-type, attr-defined, var-annotated, union-attr, no-any-return, import-untyped

# _tests at depth 1: agents._tests, shared._tests, etc.
[mypy-*._tests]
disallow_untyped_defs = False
disallow_untyped_calls = False
disallow_untyped_decorators = False
warn_unused_ignores = False
disable_error_code = no-untyped-def, arg-type, attr-defined, var-annotated, union-attr, index, comparison-overlap, misc, operator, type-arg, assignment, return-value, no-any-return, call-arg

[mypy-*._tests.*]
disallow_untyped_defs = False
disallow_untyped_calls = False
disallow_untyped_decorators = False
warn_unused_ignores = False
disable_error_code = no-untyped-def, arg-type, attr-defined, var-annotated, union-attr, index, comparison-overlap, misc, operator, type-arg, assignment, return-value, no-any-return, call-arg

# _tests at depth 2: agents.a._tests, protocols.cli._tests, etc.
[mypy-*.*._tests]
disallow_untyped_defs = False
disallow_untyped_calls = False
disallow_untyped_decorators = False
warn_unused_ignores = False
disable_error_code = no-untyped-def, arg-type, attr-defined, var-annotated, union-attr, index, comparison-overlap, misc, operator, type-arg, assignment, return-value, no-any-return, call-arg

[mypy-*.*._tests.*]
disallow_untyped_defs = False
disallow_untyped_calls = False
disallow_untyped_decorators = False
warn_unused_ignores = False
disable_error_code = no-untyped-def, arg-type, attr-defined, var-annotated, union-attr, index, comparison-overlap, misc, operator, type-arg, assignment, return-value, no-any-return, call-arg

# _tests at depth 3: protocols.cli.flow._tests, infra.k8s.operators._tests, etc.
[mypy-*.*.*._tests]
disallow_untyped_defs = False
disallow_untyped_calls = False
disallow_untyped_decorators = False
warn_unused_ignores = False
disable_error_code = no-untyped-def, arg-type, attr-defined, var-annotated, union-attr, index, comparison-overlap, misc, operator, type-arg, assignment, return-value, no-any-return, call-arg

[mypy-*.*.*._tests.*]
disallow_untyped_defs = False
disallow_untyped_calls = False
disallow_untyped_decorators = False
warn_unused_ignores = False
disable_error_code = no-untyped-def, arg-type, attr-defined, var-annotated, union-attr, index, comparison-overlap, misc, operator, type-arg, assignment, return-value, no-any-return, call-arg

# _tests at depth 4: protocols.cli.instance_db._tests, etc.
[mypy-*.*.*.*._tests]
disallow_untyped_defs = False
disallow_untyped_calls = False
disallow_untyped_decorators = False
warn_unused_ignores = False
disable_error_code = no-untyped-def, arg-type, attr-defined, var-annotated, union-attr, index, comparison-overlap, misc, operator, type-arg, assignment, return-value, no-any-return, call-arg

[mypy-*.*.*.*._tests.*]
disallow_untyped_defs = False
disallow_untyped_calls = False
disallow_untyped_decorators = False
warn_unused_ignores = False
disable_error_code = no-untyped-def, arg-type, attr-defined, var-annotated, union-attr, index, comparison-overlap, misc, operator, type-arg, assignment, return-value, no-any-return, call-arg

# tests/ pattern (non-underscore prefix) for some modules
[mypy-*.tests.*]
disallow_untyped_defs = False
disallow_untyped_calls = False
disallow_untyped_decorators = False
warn_unused_ignores = False
disable_error_code = no-untyped-def, arg-type, attr-defined, var-annotated, union-attr, index, comparison-overlap, misc, operator, type-arg, assignment, return-value, no-any-return, call-arg

[mypy-*.*.tests.*]
disallow_untyped_defs = False
disallow_untyped_calls = False
disallow_untyped_decorators = False
warn_unused_ignores = False
disable_error_code = no-untyped-def, arg-type, attr-defined, var-annotated, union-attr, index, comparison-overlap, misc, operator, type-arg, assignment, return-value, no-any-return, call-arg

[mypy-*.*.*.tests.*]
disallow_untyped_defs = False
disallow_untyped_calls = False
disallow_untyped_decorators = False
warn_unused_ignores = False
disable_error_code = no-untyped-def, arg-type, attr-defined, var-annotated, union-attr, index, comparison-overlap, misc, operator, type-arg, assignment, return-value, no-any-return, call-arg

# =============================================================================
# HIGH-ERROR PRODUCTION MODULES (pragmatic relaxations)
# =============================================================================
# These modules have consistent patterns of typing issues that are low-value
# to fix individually. Relaxed checking allows them to continue working.

# Forge node has ~49 BasicRendering arg-type issues - intentional pattern
[mypy-services.forge.node]
disable_error_code = arg-type, assignment, override, union-attr

# Forge soul_node - same pattern as forge.node (Observer vs Umwelt override)
[mypy-services.forge.soul_node]
disable_error_code = arg-type, override

# Gallery pilots - UI prototypes with heavy JSON parsing
[mypy-protocols.projection.gallery.pilots]
disable_error_code = no-any-return, arg-type, attr-defined, index

# Memory allocation - complex type inference
[mypy-agents.k.memory_allocation]
disable_error_code = no-any-return, attr-defined, call-arg

# Infrastructure API - optional FastAPI fallbacks
[mypy-protocols.api.infrastructure]
disable_error_code = arg-type, assignment, no-untyped-call, no-untyped-def, misc, no-redef
warn_unused_ignores = False

# Gestalt API - optional FastAPI fallbacks
[mypy-protocols.api.gestalt]
disable_error_code = arg-type, assignment, call-arg, no-untyped-def, no-untyped-call, misc, no-redef
warn_unused_ignores = False

# CLI gardener handler - complex routing
[mypy-protocols.cli.handlers.gardener]
disable_error_code = arg-type, attr-defined, no-any-return, index

# Kubernetes collector - optional k8s imports and async complexity
[mypy-agents.infra.collectors.kubernetes]
disable_error_code = attr-defined, no-any-return, union-attr, type-arg, override, no-untyped-def, no-redef

# Example collaboration modality - demo/prototype code
[mypy-agents.f.modalities.example_collaboration]
disable_error_code = no-any-return, arg-type, no-untyped-def, no-untyped-call, var-annotated

# Vector DB - optional imports for multiple backends
[mypy-agents.l.vector_db]
disable_error_code = attr-defined, assignment, misc, call-arg, union-attr, import-untyped, arg-type, unused-ignore
warn_unused_ignores = False

# Gardener session - complex state machine
[mypy-agents.gardener.session]
disable_error_code = no-any-return, attr-defined, return-value

# Providers - DI container with dynamic types, helper functions
[mypy-services.providers]
disable_error_code = no-any-return, attr-defined, name-defined, no-untyped-def

# =============================================================================
# ADDITIONAL PRODUCTION MODULES
# =============================================================================

# REMOVED (2025-01-10): protocols/prompt/habits/ directory does not exist

# I-gent screens - UI state machines
[mypy-agents.i.screens.*]
disable_error_code = attr-defined, type-arg, no-any-return, import-untyped

# I-gent data providers
[mypy-agents.i.data.*]
disable_error_code = attr-defined, type-arg

# Chat service modules
[mypy-services.chat.*]
disable_error_code = attr-defined, type-arg, no-any-return, arg-type

# CLI gestalt handler
[mypy-protocols.cli.handlers.gestalt]
disable_error_code = no-any-return, arg-type, attr-defined

# CLI analyze handler - heterogeneous report types in results dict
[mypy-protocols.cli.handlers.analyze]
disable_error_code = assignment, type-arg, no-untyped-def

# CLI evidence handler - services.evidence module attribute mismatches
[mypy-protocols.cli.handlers.evidence]
disable_error_code = attr-defined

# Evidence services - model attribute drift, untyped helpers
[mypy-services.evidence.*]
disable_error_code = attr-defined, no-untyped-def, arg-type, union-attr
warn_unused_ignores = False

# Park scenario - game state machine
[mypy-agents.park.scenario]
disable_error_code = no-any-return, assignment

# Gardener logos seasons - temporal logic
[mypy-protocols.gardener_logos.seasons]
disable_error_code = attr-defined, no-any-return, list-item, arg-type

# CLI chat commands
[mypy-protocols.cli.commands.chat.*]
disable_error_code = arg-type, attr-defined

# Infra collectors base
[mypy-agents.infra.collectors.base]
disable_error_code = attr-defined, no-any-return, type-arg, arg-type

# F-gent collaboration modality
[mypy-agents.f.modalities.collaboration]
disable_error_code = no-untyped-def, no-untyped-call, var-annotated, type-arg, assignment

# Town services
[mypy-services.town.*]
disable_error_code = attr-defined, no-any-return

# API gallery
[mypy-protocols.api.gallery]
disable_error_code = misc, no-untyped-def, assignment, attr-defined, union-attr
warn_unused_ignores = False

# AGENTESE contexts
[mypy-protocols.agentese.contexts.prompt]
disable_error_code = arg-type, no-any-return, operator, attr-defined

# Town agents
[mypy-agents.town.*]
disable_error_code = attr-defined, no-any-return

# Atelier modules
[mypy-agents.atelier.*]
disable_error_code = attr-defined, arg-type

# CLI brain handler
[mypy-protocols.cli.handlers.brain]
disable_error_code = no-any-return, arg-type, type-arg

# CLI park handler
[mypy-protocols.cli.handlers.park_thin]
disable_error_code = no-any-return, arg-type, assignment, return-value

# Morpheus service
[mypy-services.morpheus.*]
disable_error_code = attr-defined, no-any-return, no-untyped-def, no-untyped-call

# Studio LLM production - safe_to_dict helper calls
[mypy-services.studio.llm.production]
disable_error_code = no-untyped-def, no-untyped-call

# Studio core
[mypy-services.studio.core]
disable_error_code = no-any-return, attr-defined

# =============================================================================
# ADDITIONAL RELAXATIONS (2025-12-18)
# =============================================================================

# Services - gardener contracts
[mypy-services.gardener.contracts]
disable_error_code = type-arg

# Memory agent
[mypy-agents.m.memory]
disable_error_code = no-any-return

[mypy-agents.m.importers.markdown]
disable_error_code = typeddict-item, no-any-return

[mypy-agents.m.soul_memory]
disable_error_code = arg-type

# Infra models and health
[mypy-agents.infra.models]
disable_error_code = type-arg

[mypy-agents.infra.health]
disable_error_code = type-arg

# Note: Emergence polynomial config removed 2025-12-21 (Crown Jewel Cleanup)
# Note: protocols.prompt.habits.* configs removed 2025-01-10 (directory does not exist)

# Forge festival service
[mypy-services.forge.festival_service]
disable_error_code = assignment

# Gallery operad
[mypy-agents.gallery.operad]
disable_error_code = type-arg

# Zero-seed galois modules - property decorator stacking pattern (2025-01-10)
[mypy-services.zero_seed.galois.proof]
disable_error_code = prop-decorator

[mypy-services.zero_seed.galois.*]
warn_unused_ignores = False

# Zero-seed galois axiomatics - protocol variance, any-return
[mypy-services.zero_seed.galois.axiomatics]
disable_error_code = misc, no-any-return

# Zero-seed galois distance - optional embedding/LLM providers
[mypy-services.zero_seed.galois.distance]
disable_error_code = attr-defined, operator, no-any-return

# Zero-seed galois loss - dict type params
[mypy-services.zero_seed.galois.galois_loss]
disable_error_code = type-arg, no-any-return, assignment

# AGENTESE contexts - self_grow
[mypy-protocols.agentese.contexts.self_grow.*]
disable_error_code = arg-type, no-any-return, assignment

# Concept node - GaloisWitnessedProof constructor drift
[mypy-nodes.concept_node]
disable_error_code = call-arg

# DP core value agent - intentional override variance (DP-specific Constitution)
[mypy-dp.core.value_agent]
disable_error_code = override

# T-agent truth functor - generic type params at usage sites, property override
[mypy-agents.t.truth_functor]
disable_error_code = type-arg, override

# Differance operad
[mypy-agents.differance.operad]
disable_error_code = arg-type, return-value

# Park director
[mypy-agents.park.director]
disable_error_code = no-any-return

# Design generate
[mypy-agents.design.generate]
disable_error_code = attr-defined

# Gestalt reactive
[mypy-protocols.gestalt.reactive]
disable_error_code = return-value

# D-gent backends
[mypy-agents.d.backends.postgres]
disable_error_code = no-any-return

[mypy-agents.d.backends.jsonl]
disable_error_code = union-attr

# Migrations (already have alembic ignore, but add error ignore for env/versions)
[mypy-system.migrations.*]
ignore_errors = True

# D-gent adapters
[mypy-agents.d.adapters.table_adapter]
disable_error_code = no-any-return, redundant-cast

# Atelier economy
[mypy-agents.atelier.economy]
disable_error_code = return-value

[mypy-agents.f.modalities.chat]
disable_error_code = type-arg, assignment

# N-gent store
[mypy-agents.n.dgent_store]
disable_error_code = attr-defined

# SQLAlchemy models - __table_args__ type issues
[mypy-models.town]
disable_error_code = type-arg, assignment

[mypy-models.park]
disable_error_code = type-arg, assignment

[mypy-models.gestalt]
disable_error_code = type-arg, assignment

[mypy-models.gardener]
disable_error_code = assignment

# CLI modules
[mypy-protocols.cli.help_projector]
disable_error_code = attr-defined, no-any-return

[mypy-protocols.cli.chat_projection]
disable_error_code = arg-type

[mypy-protocols.cli.handlers.park]
disable_error_code = assignment

[mypy-protocols.cli.handlers.atelier]
disable_error_code = assignment

[mypy-protocols.cli.projection]
disable_error_code = attr-defined, no-any-return

[mypy-protocols.cli.handlers.gardener_thin]
disable_error_code = return-value

[mypy-protocols.cli.agentese_router]
disable_error_code = attr-defined

[mypy-protocols.cli.handlers.session]
disable_error_code = assignment

[mypy-protocols.cli.commands.chat.resume]
disable_error_code = arg-type, attr-defined, call-arg, var-annotated

# API modules
[mypy-protocols.api.gardener]
disable_error_code = attr-defined

# Services bootstrap
[mypy-services.bootstrap]
disable_error_code = arg-type

[mypy-services.categorical.__init__]
disable_error_code = import-untyped

# =============================================================================
# ADDITIONAL RELAXATIONS (2025-12-18 round 2)
# =============================================================================

# Models (SQLAlchemy __table_args__)
[mypy-models.brain]
disable_error_code = type-arg, assignment

[mypy-models.atelier]
disable_error_code = type-arg, assignment

# Dialogue service
[mypy-services.town.dialogue_service]
disable_error_code = assignment

# Projection widgets
[mypy-protocols.projection.widgets.graph]
ignore_missing_imports = True

# TUI base
[mypy-protocols.projection.tui.base]
disable_error_code = no-any-return

# State functor
[mypy-agents.s.state_functor]
disable_error_code = override, no-any-return

# Marimo adapters
[mypy-protocols.projection.marimo.adapters]
ignore_missing_imports = True

# Town demo marimo
[mypy-agents.town.demo_marimo]
disable_error_code = unused-ignore
warn_unused_ignores = False

# World gallery context
[mypy-protocols.agentese.contexts.world_gallery]
disable_error_code = var-annotated, arg-type, override

# Plotext
[mypy-plotext.*]
ignore_missing_imports = True

# Plotly
[mypy-plotly.*]
ignore_missing_imports = True

# API brain
[mypy-protocols.api.brain]
disable_error_code = arg-type, no-untyped-def, call-arg, misc

# Gestalt node
[mypy-services.gestalt.node]
disable_error_code = union-attr

# Park API
[mypy-protocols.api.park]
disable_error_code = arg-type, no-untyped-def, call-arg, misc

# Constitutional API - MarkResult vs Mark type mismatch, stale ignores
[mypy-protocols.api.constitutional]
disable_error_code = attr-defined, arg-type, unused-ignore
warn_unused_ignores = False

# Chat adapter
[mypy-services.chat.adapter]
disable_error_code = override

# Atelier synergy
[mypy-agents.atelier.synergy]
disable_error_code = no-untyped-def, no-untyped-call

# D-gent upgrader
[mypy-agents.d.upgrader]
disable_error_code = type-arg

# Town memory service
[mypy-services.town.memory_service]
disable_error_code = call-arg, assignment

# Park persistence
[mypy-services.park.persistence]
disable_error_code = arg-type

# Town persistent memory
[mypy-agents.town.persistent_memory]
disable_error_code = call-arg, assignment

# Brain node
[mypy-services.brain.node]
disable_error_code = assignment, attr-defined

# Code service node - heterogeneous result types reusing variable
[mypy-services.code.node]
disable_error_code = assignment, attr-defined, arg-type

# Witness persistence - SQLAlchemy 2.0 mapped_column + deprecated plugin
# The models use Mapped[] syntax but the deprecated plugin doesn't fully understand it
# This causes spurious "unexpected keyword argument" and "no attribute" errors
# TODO: Remove this relaxation when migrating off sqlalchemy.ext.mypy.plugin
[mypy-services.witness.persistence]
disable_error_code = call-arg, attr-defined, arg-type
warn_unused_ignores = False

# PTY bridge - intentionally overrides TextIOWrapper methods with different signatures
# This is a pseudo-tty implementation that wraps async streams as file-like objects
[mypy-services.kgentsd.pty_bridge]
disable_error_code = override, no-any-return, attr-defined

# L-gent init
[mypy-agents.l.__init__]
ignore_errors = True
disable_error_code = import-untyped

# D-gent - treat as partially typed internal package
# Some submodules don't have py.typed markers
[mypy-agents.d.*]
ignore_missing_imports = True
follow_imports = silent

# D-gent galois - callable with _model attribute, untyped helpers
[mypy-agents.d.galois]
disable_error_code = attr-defined, no-any-return, no-untyped-def

# =============================================================================
# ADDITIONAL RELAXATIONS (2025-12-18 round 3)
# =============================================================================

# Self-grow contexts
[mypy-protocols.agentese.contexts.self_grow.abuse]
disable_error_code = unused-ignore
warn_unused_ignores = False

[mypy-protocols.agentese.contexts.self_grow.rollback]
disable_error_code = unused-ignore
warn_unused_ignores = False

[mypy-protocols.agentese.contexts.self_grow.promote]
disable_error_code = unused-ignore
warn_unused_ignores = False

[mypy-protocols.agentese.contexts.self_grow.recognize]
disable_error_code = unused-ignore, var-annotated
warn_unused_ignores = False

[mypy-protocols.agentese.contexts.self_grow.duplication]
disable_error_code = unused-ignore
warn_unused_ignores = False

# Chat transformer
[mypy-services.chat.transformer]
disable_error_code = assignment

# Ghost collectors
[mypy-infra.ghost.collectors]
disable_error_code = attr-defined

# Synergy handlers
[mypy-protocols.synergy.handlers.gestalt_garden]
disable_error_code = attr-defined, no-any-return

# Self jewel flow context
[mypy-protocols.agentese.contexts.self_jewel_flow]
disable_error_code = attr-defined

# Self citizen context
[mypy-protocols.agentese.contexts.self_citizen]
disable_error_code = no-any-return

# L-gent vgent adapter
[mypy-agents.l.vgent_adapter]
disable_error_code = arg-type, unused-ignore
warn_unused_ignores = False

# CLI handlers dashboard
[mypy-protocols.cli.handlers.dashboard]
ignore_errors = True

# Ghost collectors (infra.ghost)
[mypy-infra.ghost.*]
disable_error_code = attr-defined

# Self_ context (import-untyped)
[mypy-protocols.agentese.contexts.self_]
disable_error_code = import-untyped

# =============================================================================
# FINAL RELAXATIONS (2025-12-18)
# =============================================================================

# Testcontainers (optional test dependency)
[mypy-testcontainers]
ignore_missing_imports = True

[mypy-testcontainers.*]
ignore_missing_imports = True

# System tests conftest (testcontainers)
[mypy-system._tests.conftest]
disable_error_code = import-not-found

# I-gent reactive tests (import-untyped for d.context_window)
[mypy-agents.i.reactive._tests.*]
disable_error_code = import-untyped

# =============================================================================
# ADDITIONAL RELAXATIONS (2025-12-18 round 4)
# =============================================================================

# Forge commission node - follows forge.node pattern
[mypy-services.forge.commission_node]
disable_error_code = arg-type, assignment, override, union-attr

# Forge commission
[mypy-services.forge.commission]
disable_error_code = arg-type

# Scripts (seed data, utilities)
[mypy-scripts.*]
ignore_errors = True

# World contexts - AGENTESE contexts with various patterns
[mypy-protocols.agentese.contexts.world_gestalt_live]
disable_error_code = misc

[mypy-protocols.agentese.contexts.world_atelier]
disable_error_code = import-untyped

[mypy-protocols.agentese.contexts.world_gallery_api]
disable_error_code = var-annotated, override

[mypy-protocols.agentese.contexts.world_workshop]
disable_error_code = var-annotated, override, misc

[mypy-protocols.agentese.contexts.world_gardener]
disable_error_code = arg-type, override

[mypy-protocols.agentese.contexts.self_system]
disable_error_code = unused-ignore, import-untyped
warn_unused_ignores = False

# Brain persistence - optional session_factory pattern
[mypy-services.brain.persistence]
disable_error_code = arg-type, assignment, return-value, union-attr, no-any-return

# CLI query handler
[mypy-protocols.cli.handlers.query]
disable_error_code = arg-type, import-untyped

# =============================================================================
# ADDITIONAL RELAXATIONS (2025-12-19 - CI compatibility)
# =============================================================================
# These modules have anywidget/traitlets typing that varies between envs

[mypy-agents.i.marimo.widgets.base]
disable_error_code = misc, unused-ignore
warn_unused_ignores = False

[mypy-agents.i.marimo.widgets.dialectic]
disable_error_code = unused-ignore, assignment
warn_unused_ignores = False

[mypy-agents.i.marimo.logos_bridge]
disable_error_code = no-redef

[mypy-agents.i.reactive.adapters.marimo_widget]
disable_error_code = misc, unused-ignore
warn_unused_ignores = False

[mypy-agents.town.telegram_notifier]
disable_error_code = import-not-found, unused-ignore
warn_unused_ignores = False

[mypy-agents.i.reactive.playground]
disable_error_code = no-untyped-call, unused-ignore
warn_unused_ignores = False

# Flux semaphore - internal submodule (added 2025-01-10)
[mypy-agents.flux.semaphore]
ignore_missing_imports = True

[mypy-agents.flux.semaphore.*]
ignore_missing_imports = True

# =============================================================================
# TESTS MODULE (top-level tests/ directory)
# =============================================================================

[mypy-tests.*]
disallow_untyped_defs = False
disallow_untyped_calls = False
disallow_untyped_decorators = False
warn_unused_ignores = False
disable_error_code = no-untyped-def, arg-type, attr-defined, var-annotated, union-attr
