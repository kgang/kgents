# mypy configuration
# Strict mode with targeted relaxations for external deps and test files

[mypy]
strict = True
explicit_package_bases = True
# Exclude archived directories and non-Python package dirs
exclude = (?x)(
    ^activate/
    | .*-archived.*
    | .*/_archived/.*
  )

# =============================================================================
# EXTERNAL LIBRARIES (no type stubs)
# =============================================================================
# Using glob patterns to reduce repetition

[mypy-redis.*]
ignore_missing_imports = True

[mypy-fakeredis.*]
ignore_missing_imports = True

[mypy-asyncpg.*]
ignore_missing_imports = True

[mypy-lark.*]
ignore_missing_imports = True

[mypy-sentence_transformers.*]
ignore_missing_imports = True

[mypy-openai.*]
ignore_missing_imports = True

[mypy-chromadb.*]
ignore_missing_imports = True

[mypy-faiss.*]
ignore_missing_imports = True

[mypy-dspy.*]
ignore_missing_imports = True

[mypy-uvicorn.*]
ignore_missing_imports = True

[mypy-fastapi.*]
ignore_missing_imports = True

[mypy-textual.*]
ignore_missing_imports = True

[mypy-rich.*]
ignore_missing_imports = True

[mypy-grpc.*]
ignore_missing_imports = True

[mypy-grpcio.*]
ignore_missing_imports = True

[mypy-grpcio_tools.*]
ignore_missing_imports = True

[mypy-kopf.*]
ignore_missing_imports = True

[mypy-kubernetes.*]
ignore_missing_imports = True

[mypy-kubernetes_asyncio.*]
ignore_missing_imports = True

[mypy-yaml.*]
ignore_missing_imports = True

[mypy-hypothesis.*]
ignore_missing_imports = True

[mypy-prometheus_client.*]
ignore_missing_imports = True

[mypy-google.*]
ignore_missing_imports = True

[mypy-qdrant_client.*]
ignore_missing_imports = True

[mypy-watchdog.*]
ignore_missing_imports = True

[mypy-opentelemetry.*]
ignore_missing_imports = True

[mypy-websockets.*]
ignore_missing_imports = True

[mypy-stripe.*]
ignore_missing_imports = True

[mypy-stripe.error]
ignore_missing_imports = True

[mypy-marimo.*]
ignore_missing_imports = True

[mypy-nats.*]
ignore_missing_imports = True

[mypy-anywidget.*]
ignore_missing_imports = True

[mypy-traitlets.*]
ignore_missing_imports = True

[mypy-IPython.*]
ignore_missing_imports = True

# =============================================================================
# MODULES WITH UNTYPED EXTERNAL DECORATORS
# =============================================================================
# FastAPI and kopf decorators are untyped, so we relax decorator strictness

[mypy-agents.w.server]
disallow_untyped_decorators = False
warn_unused_ignores = False

[mypy-protocols.terrarium.gateway]
disallow_untyped_decorators = False
warn_unused_ignores = False

# K8s operators use kopf decorators which have complex type signatures
# We ignore errors in these modules to allow flexibility in handler signatures
[mypy-infra.k8s.operators.agent_operator]
ignore_errors = True

[mypy-infra.k8s.operators.proposal_operator]
ignore_errors = True

[mypy-infra.k8s.operators.pheromone_operator]
ignore_errors = True

[mypy-protocols.agentese.jit]
warn_unused_ignores = False

# =============================================================================
# GENERATED CODE (skip entirely)
# =============================================================================

[mypy-protocols.proto.generated.*]
ignore_errors = True

# =============================================================================
# INTERNAL WIP MODULES
# =============================================================================

[mypy-impl.*]
ignore_missing_imports = True

[mypy-shared]
ignore_errors = True

[mypy-shared.*]
ignore_missing_imports = True

[mypy-agents.d.transform_agent]
ignore_missing_imports = True

[mypy-agents.d.bicameral]
ignore_missing_imports = True

[mypy-agents.d.modal_scope]
ignore_missing_imports = True

[mypy-agents.e.parser.p_integration]
ignore_missing_imports = True

[mypy-agents.m.compaction]
ignore_missing_imports = True

[mypy-agents.m.crystallization_integration]
ignore_missing_imports = True

[mypy-agents.town.ui.*]
ignore_missing_imports = True

[mypy-protocols.cli.companions]
ignore_missing_imports = True

[mypy-protocols.cli.igent_synergy]
ignore_missing_imports = True

[mypy-protocols.cli.scientific]
ignore_missing_imports = True

# CLI handlers/contexts with WIP/deleted module imports
[mypy-protocols.cli.handlers.tether]
ignore_errors = True

[mypy-protocols.cli.handlers.dev]
ignore_errors = True

[mypy-protocols.cli.handlers.prompt]
ignore_errors = True

[mypy-protocols.cli.handlers.daemon]
ignore_errors = True

[mypy-protocols.cli.handlers.flinch]
ignore_errors = True

[mypy-protocols.cli.handlers.play]
ignore_errors = True

[mypy-protocols.cli.instance_db.*]
ignore_errors = True

[mypy-protocols.cli.contexts.concept]
ignore_errors = True

[mypy-protocols.cli.contexts.self_]
ignore_errors = True

[mypy-protocols.cli.contexts.time_]
ignore_errors = True

[mypy-protocols.cli.contexts.void]
ignore_errors = True

[mypy-protocols.cli.glass]
ignore_errors = True

[mypy-protocols.cli.repl]
ignore_errors = True

[mypy-protocols.prompt.compiler]
ignore_missing_imports = True

[mypy-protocols.prompt.cli]
ignore_missing_imports = True

# Prompt modules referencing deleted compiler - transitional
[mypy-protocols.prompt.sources.*]
ignore_errors = True

[mypy-protocols.prompt.rollback.*]
ignore_errors = True

[mypy-protocols.prompt.soft_section]
ignore_errors = True

[mypy-protocols.prompt.section_base]
ignore_errors = True

[mypy-protocols.prompt.metrics.*]
ignore_errors = True

# Archived/WIP UI modules
[mypy-agents.town._archive_ui.*]
ignore_errors = True

[mypy-agents.town.server]
ignore_errors = True

[mypy-protocols.api.atelier]
ignore_missing_imports = True

[mypy-protocols.api.town]
ignore_missing_imports = True

[mypy-infra.k8s.*]
ignore_missing_imports = True

[mypy-__main__.*]
ignore_missing_imports = True

# Polynomial functors (WIP - experimental typing)
[mypy-agents.poly.*]
ignore_errors = True

[mypy-agents.operad.*]
ignore_errors = True

# =============================================================================
# TEST FILES (relaxed strictness)
# =============================================================================
# Mypy globs: * matches one level, so we need patterns for each depth
# Test files get relaxed checking for fixtures, decorators, and dynamic typing
# We disable common error codes that are low-value in test code:
#   - no-untyped-def: Test functions often don't need return types
#   - arg-type: Mock objects and fixtures often have flexible types
#   - attr-defined: Tests access internal/private attributes
#   - var-annotated: Test variables often inferred
#   - union-attr: Tests work with optional types liberally

[mypy-conftest]
disallow_untyped_defs = False
disallow_untyped_calls = False
disallow_untyped_decorators = False
warn_unused_ignores = False
disable_error_code = no-untyped-def, arg-type, attr-defined, var-annotated, union-attr

# Top-level test modules
[mypy-testing]
disallow_untyped_defs = False
disallow_untyped_calls = False
disallow_untyped_decorators = False
warn_unused_ignores = False
disable_error_code = no-untyped-def, arg-type, attr-defined, var-annotated, union-attr

[mypy-testing.*]
disallow_untyped_defs = False
disallow_untyped_calls = False
disallow_untyped_decorators = False
warn_unused_ignores = False
disable_error_code = no-untyped-def, arg-type, attr-defined, var-annotated, union-attr

[mypy-qa]
disallow_untyped_defs = False
disallow_untyped_calls = False
disallow_untyped_decorators = False
warn_unused_ignores = False
disable_error_code = no-untyped-def, arg-type, attr-defined, var-annotated, union-attr

[mypy-qa.*]
disallow_untyped_defs = False
disallow_untyped_calls = False
disallow_untyped_decorators = False
warn_unused_ignores = False
disable_error_code = no-untyped-def, arg-type, attr-defined, var-annotated, union-attr

# _tests at depth 1: agents._tests, shared._tests, etc.
[mypy-*._tests]
disallow_untyped_defs = False
disallow_untyped_calls = False
disallow_untyped_decorators = False
warn_unused_ignores = False
disable_error_code = no-untyped-def, arg-type, attr-defined, var-annotated, union-attr, index, comparison-overlap, misc, operator, type-arg

[mypy-*._tests.*]
disallow_untyped_defs = False
disallow_untyped_calls = False
disallow_untyped_decorators = False
warn_unused_ignores = False
disable_error_code = no-untyped-def, arg-type, attr-defined, var-annotated, union-attr, index, comparison-overlap, misc, operator, type-arg

# _tests at depth 2: agents.a._tests, protocols.cli._tests, etc.
[mypy-*.*._tests]
disallow_untyped_defs = False
disallow_untyped_calls = False
disallow_untyped_decorators = False
warn_unused_ignores = False
disable_error_code = no-untyped-def, arg-type, attr-defined, var-annotated, union-attr, index, comparison-overlap, misc, operator, type-arg

[mypy-*.*._tests.*]
disallow_untyped_defs = False
disallow_untyped_calls = False
disallow_untyped_decorators = False
warn_unused_ignores = False
disable_error_code = no-untyped-def, arg-type, attr-defined, var-annotated, union-attr, index, comparison-overlap, misc, operator, type-arg

# _tests at depth 3: protocols.cli.flow._tests, infra.k8s.operators._tests, etc.
[mypy-*.*.*._tests]
disallow_untyped_defs = False
disallow_untyped_calls = False
disallow_untyped_decorators = False
warn_unused_ignores = False
disable_error_code = no-untyped-def, arg-type, attr-defined, var-annotated, union-attr, index, comparison-overlap, misc, operator, type-arg

[mypy-*.*.*._tests.*]
disallow_untyped_defs = False
disallow_untyped_calls = False
disallow_untyped_decorators = False
warn_unused_ignores = False
disable_error_code = no-untyped-def, arg-type, attr-defined, var-annotated, union-attr, index, comparison-overlap, misc, operator, type-arg

# _tests at depth 4: protocols.cli.instance_db._tests, etc.
[mypy-*.*.*.*._tests]
disallow_untyped_defs = False
disallow_untyped_calls = False
disallow_untyped_decorators = False
warn_unused_ignores = False
disable_error_code = no-untyped-def, arg-type, attr-defined, var-annotated, union-attr, index, comparison-overlap, misc, operator, type-arg

[mypy-*.*.*.*._tests.*]
disallow_untyped_defs = False
disallow_untyped_calls = False
disallow_untyped_decorators = False
warn_unused_ignores = False
disable_error_code = no-untyped-def, arg-type, attr-defined, var-annotated, union-attr, index, comparison-overlap, misc, operator, type-arg

# tests/ pattern (non-underscore prefix) for some modules
[mypy-*.tests.*]
disallow_untyped_defs = False
disallow_untyped_calls = False
disallow_untyped_decorators = False
warn_unused_ignores = False
disable_error_code = no-untyped-def, arg-type, attr-defined, var-annotated, union-attr, index, comparison-overlap, misc, operator, type-arg

[mypy-*.*.tests.*]
disallow_untyped_defs = False
disallow_untyped_calls = False
disallow_untyped_decorators = False
warn_unused_ignores = False
disable_error_code = no-untyped-def, arg-type, attr-defined, var-annotated, union-attr, index, comparison-overlap, misc, operator, type-arg

[mypy-*.*.*.tests.*]
disallow_untyped_defs = False
disallow_untyped_calls = False
disallow_untyped_decorators = False
warn_unused_ignores = False
disable_error_code = no-untyped-def, arg-type, attr-defined, var-annotated, union-attr, index, comparison-overlap, misc, operator, type-arg

# =============================================================================
# HIGH-ERROR PRODUCTION MODULES (pragmatic relaxations)
# =============================================================================
# These modules have consistent patterns of typing issues that are low-value
# to fix individually. Relaxed checking allows them to continue working.

# Atelier node has ~49 BasicRendering arg-type issues - intentional pattern
[mypy-services.atelier.node]
disable_error_code = arg-type, assignment, override

# Gallery pilots - UI prototypes with heavy JSON parsing
[mypy-protocols.projection.gallery.pilots]
disable_error_code = no-any-return, arg-type, attr-defined, index

# Memory allocation - complex type inference
[mypy-agents.k.memory_allocation]
disable_error_code = no-any-return, attr-defined

# Infrastructure API - optional FastAPI fallbacks
[mypy-protocols.api.infrastructure]
disable_error_code = arg-type, assignment, no-untyped-call, no-untyped-def, misc, no-redef
warn_unused_ignores = False

# Gestalt API - optional FastAPI fallbacks
[mypy-protocols.api.gestalt]
disable_error_code = arg-type, assignment, call-arg, no-untyped-def, no-untyped-call, misc, no-redef
warn_unused_ignores = False

# CLI gardener handler - complex routing
[mypy-protocols.cli.handlers.gardener]
disable_error_code = arg-type, attr-defined, no-any-return, index

# Kubernetes collector - optional k8s imports and async complexity
[mypy-agents.infra.collectors.kubernetes]
disable_error_code = attr-defined, no-any-return, union-attr, type-arg, override, no-untyped-def, no-redef

# Example collaboration modality - demo/prototype code
[mypy-agents.f.modalities.example_collaboration]
disable_error_code = no-any-return, arg-type, no-untyped-def, no-untyped-call, var-annotated

# Vector DB - optional imports for multiple backends
[mypy-agents.l.vector_db]
disable_error_code = attr-defined, assignment

# Gardener session - complex state machine
[mypy-agents.gardener.session]
disable_error_code = no-any-return, attr-defined

# Providers - DI container with dynamic types
[mypy-services.providers]
disable_error_code = no-any-return, attr-defined

# =============================================================================
# ADDITIONAL PRODUCTION MODULES
# =============================================================================

# Prompt habits - session analysis with complex datetime logic
[mypy-protocols.prompt.habits.session_analyzer]
disable_error_code = arg-type, assignment, operator, list-item

# I-gent screens - UI state machines
[mypy-agents.i.screens.*]
disable_error_code = attr-defined, type-arg, no-any-return, import-untyped

# I-gent data providers
[mypy-agents.i.data.*]
disable_error_code = attr-defined, type-arg

# Chat service modules
[mypy-services.chat.*]
disable_error_code = attr-defined, type-arg, no-any-return, arg-type

# CLI gestalt handler
[mypy-protocols.cli.handlers.gestalt]
disable_error_code = no-any-return, arg-type, attr-defined

# Park scenario - game state machine
[mypy-agents.park.scenario]
disable_error_code = no-any-return, assignment

# Gardener logos seasons - temporal logic
[mypy-protocols.gardener_logos.seasons]
disable_error_code = attr-defined, no-any-return

# CLI chat commands
[mypy-protocols.cli.commands.chat.*]
disable_error_code = arg-type, attr-defined

# Infra collectors base
[mypy-agents.infra.collectors.base]
disable_error_code = attr-defined, no-any-return, type-arg

# F-gent collaboration modality
[mypy-agents.f.modalities.collaboration]
disable_error_code = no-untyped-def, no-untyped-call, var-annotated

# Town services
[mypy-services.town.*]
disable_error_code = attr-defined, no-any-return

# API gallery
[mypy-protocols.api.gallery]
disable_error_code = misc, no-untyped-def
warn_unused_ignores = False

# AGENTESE contexts
[mypy-protocols.agentese.contexts.prompt]
disable_error_code = arg-type, no-any-return

# Town agents
[mypy-agents.town.*]
disable_error_code = attr-defined, no-any-return

# Atelier modules
[mypy-agents.atelier.*]
disable_error_code = attr-defined, arg-type

# CLI brain handler
[mypy-protocols.cli.handlers.brain]
disable_error_code = no-any-return, arg-type

# CLI park handler
[mypy-protocols.cli.handlers.park_thin]
disable_error_code = no-any-return, arg-type

# Morpheus service
[mypy-services.morpheus.*]
disable_error_code = attr-defined, no-any-return
