# mypy configuration
# Strict mode with targeted relaxations for external deps and test files

[mypy]
strict = True
explicit_package_bases = True

# =============================================================================
# EXTERNAL LIBRARIES (no type stubs)
# =============================================================================
# Using glob patterns to reduce repetition

[mypy-redis.*]
ignore_missing_imports = True

[mypy-fakeredis.*]
ignore_missing_imports = True

[mypy-asyncpg.*]
ignore_missing_imports = True

[mypy-lark.*]
ignore_missing_imports = True

[mypy-sentence_transformers.*]
ignore_missing_imports = True

[mypy-openai.*]
ignore_missing_imports = True

[mypy-chromadb.*]
ignore_missing_imports = True

[mypy-faiss.*]
ignore_missing_imports = True

[mypy-dspy.*]
ignore_missing_imports = True

[mypy-uvicorn.*]
ignore_missing_imports = True

[mypy-fastapi.*]
ignore_missing_imports = True

[mypy-textual.*]
ignore_missing_imports = True

[mypy-rich.*]
ignore_missing_imports = True

[mypy-grpc.*]
ignore_missing_imports = True

[mypy-grpcio.*]
ignore_missing_imports = True

[mypy-grpcio_tools.*]
ignore_missing_imports = True

[mypy-kopf.*]
ignore_missing_imports = True

[mypy-kubernetes.*]
ignore_missing_imports = True

[mypy-kubernetes_asyncio.*]
ignore_missing_imports = True

[mypy-yaml.*]
ignore_missing_imports = True

[mypy-hypothesis.*]
ignore_missing_imports = True

[mypy-prometheus_client.*]
ignore_missing_imports = True

[mypy-google.*]
ignore_missing_imports = True

# =============================================================================
# MODULES WITH UNTYPED EXTERNAL DECORATORS
# =============================================================================
# FastAPI and kopf decorators are untyped, so we relax decorator strictness

[mypy-agents.w.server]
disallow_untyped_decorators = False
warn_unused_ignores = False

[mypy-protocols.terrarium.gateway]
disallow_untyped_decorators = False
warn_unused_ignores = False

# K8s operators use kopf decorators which have complex type signatures
# We ignore errors in these modules to allow flexibility in handler signatures
[mypy-infra.k8s.operators.agent_operator]
ignore_errors = True

[mypy-infra.k8s.operators.proposal_operator]
ignore_errors = True

[mypy-infra.k8s.operators.pheromone_operator]
ignore_errors = True

[mypy-protocols.agentese.jit]
warn_unused_ignores = False

# =============================================================================
# GENERATED CODE (skip entirely)
# =============================================================================

[mypy-protocols.proto.generated.*]
ignore_errors = True

# =============================================================================
# INTERNAL WIP MODULES
# =============================================================================

[mypy-impl.*]
ignore_missing_imports = True

[mypy-shared]
ignore_errors = True

[mypy-shared.*]
ignore_missing_imports = True

[mypy-agents.d.transform_agent]
ignore_missing_imports = True

[mypy-agents.e.parser.p_integration]
ignore_missing_imports = True

[mypy-protocols.cli.companions]
ignore_missing_imports = True

[mypy-protocols.cli.igent_synergy]
ignore_missing_imports = True

[mypy-protocols.cli.scientific]
ignore_missing_imports = True

[mypy-__main__.*]
ignore_missing_imports = True

# =============================================================================
# TEST FILES (relaxed strictness)
# =============================================================================
# Mypy globs: * matches one level, so we need patterns for each depth
# Test files get relaxed checking for fixtures, decorators, and dynamic typing

[mypy-conftest]
disallow_untyped_defs = False
disallow_untyped_calls = False
disallow_untyped_decorators = False
warn_unused_ignores = False

# Top-level test modules
[mypy-testing]
disallow_untyped_defs = False
disallow_untyped_calls = False
disallow_untyped_decorators = False
warn_unused_ignores = False

[mypy-testing.*]
disallow_untyped_defs = False
disallow_untyped_calls = False
disallow_untyped_decorators = False
warn_unused_ignores = False

[mypy-qa]
disallow_untyped_defs = False
disallow_untyped_calls = False
disallow_untyped_decorators = False
warn_unused_ignores = False

[mypy-qa.*]
disallow_untyped_defs = False
disallow_untyped_calls = False
disallow_untyped_decorators = False
warn_unused_ignores = False

# _tests at depth 1: agents._tests, shared._tests, etc.
[mypy-*._tests]
disallow_untyped_defs = False
disallow_untyped_calls = False
disallow_untyped_decorators = False
warn_unused_ignores = False

[mypy-*._tests.*]
disallow_untyped_defs = False
disallow_untyped_calls = False
disallow_untyped_decorators = False
warn_unused_ignores = False

# _tests at depth 2: agents.a._tests, protocols.cli._tests, etc.
[mypy-*.*._tests]
disallow_untyped_defs = False
disallow_untyped_calls = False
disallow_untyped_decorators = False
warn_unused_ignores = False

[mypy-*.*._tests.*]
disallow_untyped_defs = False
disallow_untyped_calls = False
disallow_untyped_decorators = False
warn_unused_ignores = False

# _tests at depth 3: protocols.cli.flow._tests, infra.k8s.operators._tests, etc.
[mypy-*.*.*._tests]
disallow_untyped_defs = False
disallow_untyped_calls = False
disallow_untyped_decorators = False
warn_unused_ignores = False

[mypy-*.*.*._tests.*]
disallow_untyped_defs = False
disallow_untyped_calls = False
disallow_untyped_decorators = False
warn_unused_ignores = False

# _tests at depth 4: protocols.cli.instance_db._tests, etc.
[mypy-*.*.*.*._tests]
disallow_untyped_defs = False
disallow_untyped_calls = False
disallow_untyped_decorators = False
warn_unused_ignores = False

[mypy-*.*.*.*._tests.*]
disallow_untyped_defs = False
disallow_untyped_calls = False
disallow_untyped_decorators = False
warn_unused_ignores = False
