# NATS JetStream Configuration
# Configures a 3-node NATS cluster with JetStream for kgents event streaming
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: nats-config
  namespace: kgents-agents
  labels:
    app.kubernetes.io/name: nats
    app.kubernetes.io/component: streaming
    app.kubernetes.io/part-of: kgents
data:
  nats.conf: |
    # NATS Server Configuration for kgents
    # https://docs.nats.io/running-a-nats-service/configuration

    # Server identification
    server_name: $POD_NAME

    # Client connections
    port: 4222
    http_port: 8222

    # Cluster configuration for HA
    cluster {
      name: kgents-nats
      port: 6222

      routes: [
        nats://nats-0.nats-headless.kgents-agents.svc.cluster.local:6222
        nats://nats-1.nats-headless.kgents-agents.svc.cluster.local:6222
        nats://nats-2.nats-headless.kgents-agents.svc.cluster.local:6222
      ]

      # Cluster TLS (disabled for internal cluster)
      # tls { ... }
    }

    # JetStream configuration
    jetstream {
      store_dir: /data/jetstream
      max_memory_store: 1Gi
      max_file_store: 10Gi
    }

    # Logging
    debug: false
    trace: false
    logtime: true

    # Limits
    max_payload: 1MB
    max_connections: 1000
    max_subscriptions: 10000

    # Monitoring
    http: 0.0.0.0:8222
