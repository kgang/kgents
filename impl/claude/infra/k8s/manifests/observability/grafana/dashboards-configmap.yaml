---
# Grafana Dashboards ConfigMap
# Contains the three core kgents dashboards:
# 1. Soul: K-gent Dialogue Visibility
# 2. Flux: Stream Topology
# 3. Cortex: System Health
apiVersion: v1
kind: ConfigMap
metadata:
  name: grafana-dashboards
  namespace: kgents-observability
  labels:
    app.kubernetes.io/name: grafana
    app.kubernetes.io/part-of: kgents
data:
  soul-dashboard.json: |
    {"annotations":{"list":[]},"description":"K-gent Soul Visibility: self.soul.* invocations, dialogue modes, token metabolism","editable":true,"fiscalYearStartMonth":0,"graphTooltip":0,"id":null,"links":[],"liveNow":false,"panels":[{"collapsed":false,"gridPos":{"h":1,"w":24,"x":0,"y":0},"id":100,"panels":[],"title":"The Soul at a Glance","type":"row"},{"datasource":{"type":"tempo","uid":"tempo"},"description":"Total soul invocations","fieldConfig":{"defaults":{"color":{"mode":"thresholds"},"thresholds":{"mode":"absolute","steps":[{"color":"blue","value":null},{"color":"green","value":10}]},"unit":"short"},"overrides":[]},"gridPos":{"h":4,"w":6,"x":0,"y":1},"id":1,"options":{"colorMode":"value","graphMode":"area","reduceOptions":{"calcs":["count"],"fields":"","values":false},"textMode":"auto"},"targets":[{"datasource":{"type":"tempo","uid":"tempo"},"queryType":"traceql","refId":"A","query":"{ resource.service.name = \"kgents-dev\" && name = \"agentese.invoke\" && span.agentese.holon = \"soul\" }"}],"title":"Dialogues","type":"stat"},{"datasource":{"type":"tempo","uid":"tempo"},"description":"Average dialogue duration","fieldConfig":{"defaults":{"color":{"mode":"thresholds"},"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null},{"color":"yellow","value":5000},{"color":"red","value":15000}]},"unit":"ms"},"overrides":[]},"gridPos":{"h":4,"w":6,"x":6,"y":1},"id":2,"options":{"colorMode":"value","graphMode":"area","reduceOptions":{"calcs":["mean"],"fields":"/^duration$/","values":false},"textMode":"auto"},"targets":[{"datasource":{"type":"tempo","uid":"tempo"},"queryType":"traceql","refId":"A","query":"{ resource.service.name = \"kgents-dev\" && name = \"agentese.invoke\" && span.agentese.holon = \"soul\" } | avg(duration)"}],"title":"Avg Duration","type":"stat"},{"datasource":{"type":"tempo","uid":"tempo"},"description":"Error rate","fieldConfig":{"defaults":{"color":{"mode":"thresholds"},"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null},{"color":"yellow","value":1},{"color":"red","value":5}]},"unit":"short"},"overrides":[]},"gridPos":{"h":4,"w":6,"x":12,"y":1},"id":3,"options":{"colorMode":"value","graphMode":"area","reduceOptions":{"calcs":["count"],"fields":"","values":false},"textMode":"auto"},"targets":[{"datasource":{"type":"tempo","uid":"tempo"},"queryType":"traceql","refId":"A","query":"{ resource.service.name = \"kgents-dev\" && name = \"agentese.invoke\" && span.agentese.holon = \"soul\" && status = error }"}],"title":"Errors","type":"stat"},{"datasource":{"type":"tempo","uid":"tempo"},"description":"Token metabolism","fieldConfig":{"defaults":{"color":{"mode":"continuous-GrYlRd"},"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null}]},"unit":"short"},"overrides":[]},"gridPos":{"h":4,"w":6,"x":18,"y":1},"id":4,"options":{"colorMode":"background","graphMode":"area","reduceOptions":{"calcs":["sum"],"fields":"","values":false},"textMode":"auto"},"targets":[{"datasource":{"type":"tempo","uid":"tempo"},"queryType":"traceql","refId":"A","query":"{ resource.service.name = \"kgents-dev\" && name = \"agentese.invoke\" && span.agentese.holon = \"soul\" } | sum(span.message_length)"}],"title":"Token Temp","type":"stat"},{"collapsed":false,"gridPos":{"h":1,"w":24,"x":0,"y":5},"id":101,"panels":[],"title":"Recent Traces","type":"row"},{"datasource":{"type":"tempo","uid":"tempo"},"description":"Recent soul dialogues - click to explore","fieldConfig":{"defaults":{"color":{"mode":"thresholds"},"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null}]}},"overrides":[]},"gridPos":{"h":10,"w":24,"x":0,"y":6},"id":10,"options":{"cellHeight":"sm","showHeader":true},"targets":[{"datasource":{"type":"tempo","uid":"tempo"},"queryType":"traceql","refId":"A","tableType":"traces","query":"{ resource.service.name = \"kgents-dev\" && name = \"agentese.invoke\" && span.agentese.holon = \"soul\" }"}],"title":"Recent Soul Dialogues","type":"table"}],"refresh":"30s","schemaVersion":38,"tags":["kgents","soul","k-gent"],"templating":{"list":[]},"time":{"from":"now-1h","to":"now"},"timepicker":{},"timezone":"browser","title":"Soul: K-gent Dialogue Visibility","uid":"kgents-soul","version":1}
  flux-dashboard.json: |
    {"annotations":{"list":[]},"description":"Flux Topology: Pressure, Flow, Turbulence, Temperature","editable":true,"fiscalYearStartMonth":0,"graphTooltip":0,"id":null,"links":[],"liveNow":false,"panels":[{"collapsed":false,"gridPos":{"h":1,"w":24,"x":0,"y":0},"id":100,"panels":[],"title":"Flux Topology","type":"row"},{"datasource":{"type":"prometheus","uid":"prometheus"},"description":"Queue depth (backlog)","fieldConfig":{"defaults":{"color":{"mode":"thresholds"},"max":100,"min":0,"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null},{"color":"yellow","value":20},{"color":"red","value":80}]},"unit":"short"},"overrides":[]},"gridPos":{"h":6,"w":6,"x":0,"y":1},"id":1,"options":{"orientation":"horizontal","reduceOptions":{"calcs":["lastNotNull"],"fields":"","values":false},"showThresholdLabels":false,"showThresholdMarkers":true},"targets":[{"datasource":{"type":"prometheus","uid":"prometheus"},"expr":"sum(otelcol_processor_batch_batch_size_trigger_send{processor=\"batch\"}) or vector(0)","legendFormat":"Queue Depth","refId":"A"}],"title":"PRESSURE","type":"gauge"},{"datasource":{"type":"prometheus","uid":"prometheus"},"description":"Throughput (events/second)","fieldConfig":{"defaults":{"color":{"mode":"thresholds"},"max":1000,"min":0,"thresholds":{"mode":"absolute","steps":[{"color":"blue","value":null},{"color":"green","value":10}]},"unit":"ops"},"overrides":[]},"gridPos":{"h":6,"w":6,"x":6,"y":1},"id":2,"options":{"orientation":"horizontal","reduceOptions":{"calcs":["lastNotNull"],"fields":"","values":false},"showThresholdLabels":false,"showThresholdMarkers":true},"targets":[{"datasource":{"type":"prometheus","uid":"prometheus"},"expr":"sum(rate(otelcol_receiver_accepted_spans{receiver=\"otlp\"}[5m])) or vector(0)","legendFormat":"Spans/sec","refId":"A"}],"title":"FLOW","type":"gauge"},{"datasource":{"type":"prometheus","uid":"prometheus"},"description":"Error rate","fieldConfig":{"defaults":{"color":{"mode":"thresholds"},"decimals":2,"max":1,"min":0,"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null},{"color":"yellow","value":0.01},{"color":"red","value":0.1}]},"unit":"percentunit"},"overrides":[]},"gridPos":{"h":6,"w":6,"x":12,"y":1},"id":3,"options":{"orientation":"horizontal","reduceOptions":{"calcs":["lastNotNull"],"fields":"","values":false},"showThresholdLabels":false,"showThresholdMarkers":true},"targets":[{"datasource":{"type":"prometheus","uid":"prometheus"},"expr":"sum(rate(otelcol_receiver_refused_spans{receiver=\"otlp\"}[5m])) / (sum(rate(otelcol_receiver_accepted_spans{receiver=\"otlp\"}[5m])) + 0.001) or vector(0)","legendFormat":"Error Rate","refId":"A"}],"title":"TURBULENCE","type":"gauge"},{"datasource":{"type":"tempo","uid":"tempo"},"description":"Token metabolism","fieldConfig":{"defaults":{"color":{"mode":"continuous-GrYlRd"},"max":10000,"min":0,"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null}]},"unit":"short"},"overrides":[]},"gridPos":{"h":6,"w":6,"x":18,"y":1},"id":4,"options":{"orientation":"horizontal","reduceOptions":{"calcs":["sum"],"fields":"","values":false},"showThresholdLabels":false,"showThresholdMarkers":true},"targets":[{"datasource":{"type":"tempo","uid":"tempo"},"queryType":"traceql","refId":"A","query":"{ resource.service.name = \"kgents-dev\" } | sum(span.agentese.tokens.total)"}],"title":"TEMPERATURE","type":"gauge"},{"collapsed":false,"gridPos":{"h":1,"w":24,"x":0,"y":7},"id":101,"panels":[],"title":"Stream Dynamics","type":"row"},{"datasource":{"type":"prometheus","uid":"prometheus"},"description":"Accepted vs refused spans","fieldConfig":{"defaults":{"color":{"mode":"palette-classic"},"custom":{"drawStyle":"line","fillOpacity":30,"lineWidth":2},"unit":"ops"},"overrides":[]},"gridPos":{"h":8,"w":24,"x":0,"y":8},"id":10,"options":{"legend":{"calcs":["mean","max"],"displayMode":"list","placement":"bottom","showLegend":true},"tooltip":{"mode":"multi","sort":"desc"}},"targets":[{"datasource":{"type":"prometheus","uid":"prometheus"},"expr":"sum(rate(otelcol_receiver_accepted_spans[5m]))","legendFormat":"Accepted","refId":"A"},{"datasource":{"type":"prometheus","uid":"prometheus"},"expr":"sum(rate(otelcol_receiver_refused_spans[5m]))","legendFormat":"Refused","refId":"B"}],"title":"Span Flow Rate","type":"timeseries"}],"refresh":"10s","schemaVersion":38,"tags":["kgents","flux","topology"],"templating":{"list":[]},"time":{"from":"now-15m","to":"now"},"timepicker":{},"timezone":"browser","title":"Flux: Stream Topology","uid":"kgents-flux","version":1}
  cortex-dashboard.json: |
    {"annotations":{"list":[]},"description":"Cortex Health: Cognitive infrastructure and transparent visibility","editable":true,"fiscalYearStartMonth":0,"graphTooltip":0,"id":null,"links":[],"liveNow":false,"panels":[{"collapsed":false,"gridPos":{"h":1,"w":24,"x":0,"y":0},"id":100,"panels":[],"title":"System Vital Signs","type":"row"},{"datasource":{"type":"tempo","uid":"tempo"},"description":"Total traces","fieldConfig":{"defaults":{"color":{"mode":"thresholds"},"thresholds":{"mode":"absolute","steps":[{"color":"blue","value":null},{"color":"green","value":10}]},"unit":"short"},"overrides":[]},"gridPos":{"h":4,"w":6,"x":0,"y":1},"id":1,"options":{"colorMode":"value","graphMode":"area","reduceOptions":{"calcs":["count"],"fields":"","values":false},"textMode":"auto"},"targets":[{"datasource":{"type":"tempo","uid":"tempo"},"queryType":"traceql","refId":"A","query":"{ resource.service.name = \"kgents-dev\" }"}],"title":"Total Traces","type":"stat"},{"datasource":{"type":"tempo","uid":"tempo"},"description":"AGENTESE invocations","fieldConfig":{"defaults":{"color":{"mode":"thresholds"},"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null}]},"unit":"short"},"overrides":[]},"gridPos":{"h":4,"w":6,"x":6,"y":1},"id":2,"options":{"colorMode":"value","graphMode":"area","reduceOptions":{"calcs":["count"],"fields":"","values":false},"textMode":"auto"},"targets":[{"datasource":{"type":"tempo","uid":"tempo"},"queryType":"traceql","refId":"A","query":"{ resource.service.name = \"kgents-dev\" && name = \"agentese.invoke\" }"}],"title":"AGENTESE Invokes","type":"stat"},{"datasource":{"type":"tempo","uid":"tempo"},"description":"Errors","fieldConfig":{"defaults":{"color":{"mode":"thresholds"},"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null},{"color":"yellow","value":1},{"color":"red","value":5}]},"unit":"short"},"overrides":[]},"gridPos":{"h":4,"w":6,"x":12,"y":1},"id":3,"options":{"colorMode":"value","graphMode":"area","reduceOptions":{"calcs":["count"],"fields":"","values":false},"textMode":"auto"},"targets":[{"datasource":{"type":"tempo","uid":"tempo"},"queryType":"traceql","refId":"A","query":"{ resource.service.name = \"kgents-dev\" && status = error }"}],"title":"Errors","type":"stat"},{"datasource":{"type":"prometheus","uid":"prometheus"},"description":"Uptime","fieldConfig":{"defaults":{"color":{"mode":"thresholds"},"thresholds":{"mode":"absolute","steps":[{"color":"red","value":null},{"color":"green","value":3600}]},"unit":"s"},"overrides":[]},"gridPos":{"h":4,"w":6,"x":18,"y":1},"id":4,"options":{"colorMode":"value","graphMode":"none","reduceOptions":{"calcs":["lastNotNull"],"fields":"","values":false},"textMode":"auto"},"targets":[{"datasource":{"type":"prometheus","uid":"prometheus"},"expr":"otelcol_process_uptime or vector(0)","legendFormat":"Uptime","refId":"A"}],"title":"Uptime","type":"stat"},{"collapsed":false,"gridPos":{"h":1,"w":24,"x":0,"y":5},"id":101,"panels":[],"title":"Pipeline","type":"row"},{"datasource":{"type":"prometheus","uid":"prometheus"},"description":"Pipeline throughput","fieldConfig":{"defaults":{"color":{"mode":"palette-classic"},"custom":{"drawStyle":"line","fillOpacity":30,"lineWidth":2},"unit":"ops"},"overrides":[]},"gridPos":{"h":8,"w":16,"x":0,"y":6},"id":10,"options":{"legend":{"calcs":["mean","sum"],"displayMode":"list","placement":"bottom","showLegend":true},"tooltip":{"mode":"multi","sort":"desc"}},"targets":[{"datasource":{"type":"prometheus","uid":"prometheus"},"expr":"sum(rate(otelcol_receiver_accepted_spans[5m])) or vector(0)","legendFormat":"Received","refId":"A"},{"datasource":{"type":"prometheus","uid":"prometheus"},"expr":"sum(rate(otelcol_exporter_sent_spans[5m])) or vector(0)","legendFormat":"Exported","refId":"B"}],"title":"Pipeline Throughput","type":"timeseries"},{"gridPos":{"h":8,"w":8,"x":16,"y":6},"id":11,"options":{"code":{"language":"plaintext","showLineNumbers":false,"showMiniMap":false},"content":"## Transparent Infrastructure\n\n*The user should never wonder what is happening.*\n\n- **First run**: Tell where data lives\n- **Degraded mode**: Warn clearly\n- **Normal**: Stay quiet\n- **Errors**: Explain sympathetically\n\n*From spec/principles.md*","mode":"markdown"},"title":"Philosophy","type":"text"},{"collapsed":false,"gridPos":{"h":1,"w":24,"x":0,"y":14},"id":102,"panels":[],"title":"Recent Activity","type":"row"},{"datasource":{"type":"tempo","uid":"tempo"},"description":"Recent traces","fieldConfig":{"defaults":{"color":{"mode":"thresholds"},"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null}]}},"overrides":[]},"gridPos":{"h":8,"w":24,"x":0,"y":15},"id":20,"options":{"cellHeight":"sm","showHeader":true},"targets":[{"datasource":{"type":"tempo","uid":"tempo"},"queryType":"traceql","refId":"A","tableType":"traces","query":"{ resource.service.name = \"kgents-dev\" }"}],"title":"Recent System Traces","type":"table"}],"refresh":"30s","schemaVersion":38,"tags":["kgents","cortex","health"],"templating":{"list":[]},"time":{"from":"now-1h","to":"now"},"timepicker":{},"timezone":"browser","title":"Cortex: System Health","uid":"kgents-cortex","version":1}
