# Velero Daily Backup Schedule
#
# Creates daily cluster state backups for kgents namespaces.
# Backups stored in S3/GCS with 30-day retention.
#
# Part of Phase 11: External Backup foundation.
#
# AGENTESE: world.gateway.velero.schedule
---
apiVersion: velero.io/v1
kind: Schedule
metadata:
  name: daily-kgents-backup
  namespace: velero
  labels:
    app.kubernetes.io/name: velero
    app.kubernetes.io/component: schedule
    app.kubernetes.io/part-of: kgents
spec:
  # Daily at 3 AM UTC (1 hour after NATS backup)
  schedule: "0 3 * * *"
  # 30 days retention
  template:
    # Include both kgents namespaces
    includedNamespaces:
      - kgents-triad
      - kgents-agents
    # Exclude certain resources that shouldn't be backed up
    excludedResources:
      - events
      - events.events.k8s.io
    # Include PVC data
    snapshotVolumes: true
    # Retain for 30 days
    ttl: 720h0m0s
    # Storage location (must match BackupStorageLocation name)
    storageLocation: default
    # Volume snapshot location
    volumeSnapshotLocations:
      - default
    # Labels to add to backup
    metadata:
      labels:
        backup-type: scheduled
        environment: production
---
# Backup storage location configuration
apiVersion: velero.io/v1
kind: BackupStorageLocation
metadata:
  name: default
  namespace: velero
  labels:
    app.kubernetes.io/name: velero
    app.kubernetes.io/component: storage
    app.kubernetes.io/part-of: kgents
spec:
  provider: aws
  objectStorage:
    bucket: kgents-dr-backups
    prefix: velero
  config:
    region: us-west-2
    s3ForcePathStyle: "false"
  credential:
    name: velero-credentials
    key: cloud
---
# Volume snapshot location configuration
apiVersion: velero.io/v1
kind: VolumeSnapshotLocation
metadata:
  name: default
  namespace: velero
  labels:
    app.kubernetes.io/name: velero
    app.kubernetes.io/component: snapshot
    app.kubernetes.io/part-of: kgents
spec:
  provider: aws
  config:
    region: us-west-2
