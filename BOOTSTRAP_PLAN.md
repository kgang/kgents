# Bootstrap Implementation Plan

Using kgents to implement kgents.

---

## Ground: Current State

```
Bootstrap = {Id, Compose, Judge, Ground, Contradict, Sublate, Fix}  ✅ Available
C-gents = {Maybe, Either, parallel, race, branch, switch}          ✅ Available
H-gents = {HegelAgent, JungAgent, LacanAgent}                      ✅ Available
Runtime = {LLMAgent, ClaudeCLIRuntime, ClaudeRuntime, OpenRouterRuntime}  ✅ Available
A-gents = {AbstractSkeleton, AgentMeta, CreativityCoach}           ✅ Available
B-gents = {HypothesisEngine, Robin}                                ✅ Available
K-gent  = {Persona, Query, Evolution}                              ✅ Available

To Implement:
  {Your agents here}
```

---

## The Autopoiesis Metric

Before implementing, understand the target:

> **Autopoiesis Score** = (lines generated by kgents agents) / (total lines)
>
> Target: >50%

This means: use K-gent, CreativityCoach, HypothesisEngine, and Claude Code to GENERATE more code than you manually type.

---

## Contradict: Tensions to Watch

### Tension 1: Bootstrap Paradox
**Thesis**: We need agents to build agents.
**Antithesis**: The first agent has no agents to help build it.

**Resolution**: The bootstrap kernel (`impl/claude-openrouter/`) already exists. Use it.

### Tension 2: Spec vs. Exploration
**Thesis**: Spec should be written before implementation.
**Antithesis**: Sometimes you need to explore to know what to specify.

**Resolution**: Use CreativityCoach and HypothesisEngine to explore, THEN write spec, THEN implement.

### Tension 3: Manual vs. Generated
**Thesis**: LLM-generated code may have errors.
**Antithesis**: Manual code is slow and also has errors.

**Resolution**: Use Judge (tests, review) to validate. Track autopoiesis score.

---

## Judge: Implementation Order Criteria

Applying the 7 principles to determine order:

1. **Composable** → Implement what enables composition first
2. **Generative** → Implement what can bootstrap other agents
3. **Tasteful** → One complete agent > three partial agents

---

## The Plan: Fix(implementation_step)

### Phase 0: Setup (Always First)

```python
# Instantiate runtime BEFORE any implementation
from runtime import ClaudeCLIRuntime
from agents.k import kgent, DialogueInput, DialogueMode
from agents.a import creativity_coach, CreativityInput, CreativityMode
from agents.b import hypothesis_engine, HypothesisInput

runtime = ClaudeCLIRuntime()
```

### Phase 1: Explore Design Space

```python
# Use CreativityCoach to explore
design = await runtime.execute(creativity_coach(), CreativityInput(
    seed="the problem domain",
    mode=CreativityMode.EXPAND
))

# Use HypothesisEngine to validate approach
hypotheses = await runtime.execute(hypothesis_engine(), HypothesisInput(
    observations=["what I know about the problem"],
    domain="the domain",
    question="What approach should I take?"
))
```

### Phase 2: Write Spec

Create `spec/{letter}-gents/README.md`:
- What agents belong to this genus?
- What is the type signature of each?
- How do they compose with other agents?

### Phase 3: Implement

For each agent:
1. Read spec
2. Use K-gent to name things
3. Use LLM to generate boilerplate
4. Apply required patterns (see below)
5. Write tests

### Phase 4: Validate

```python
assert Judge(impl, Principles).verdict == "accept"
assert Contradict(impl, spec) is None
assert autopoiesis_score() > 0.5
```

---

## Required Patterns

### Pattern: Fix Needs Memory

```python
# WRONG: Stateless iteration
def step(input) -> Result:
    return Result(value=compute(input))

# RIGHT: Stateful iteration
def step(input, previous: Result) -> Result:
    if converged(input, previous):
        return previous
    return Result(value=compute(input, previous))
```

### Pattern: Ground Includes Environment

```python
# WRONG: Bash-specific
command = "read -p 'prompt' var"

# RIGHT: POSIX-compatible
command = "printf 'prompt ' && read var"
```

```python
# WRONG: sys.path hacks
import sys; sys.path.insert(0, "../..")

# RIGHT: pyproject.toml dependencies
[project]
dependencies = ["kgents-runtime"]
```

### Pattern: Sublate, Don't Overwrite

```python
# WRONG: Overwrites defaults
config = data.get("config", {})

# RIGHT: Merges with defaults
config = {**defaults, **data.get("config", {})}
```

### Pattern: Events are Sublate Traces

```python
# WRONG: Silent state change
del self._items[id]

# RIGHT: State change emits event
del self._items[id]
await self._emit_event(ItemRemoved(item_id=id))
```

### Pattern: Conflicts are Data

```python
# WRONG: Silent exception swallowing
except Exception:
    pass

# RIGHT: Log conflicts
except Exception as e:
    self.log.warning(f"Conflict detected: {e}")
```

### Pattern: Composable Layouts

```python
# WRONG: Rigid percentages
height: 30%

# RIGHT: Flexible with constraints
height: 1fr
min-height: 8
```

---

## Fix: Termination Conditions

Implementation is complete when:

```python
def bootstrap_complete():
    # Spec exists
    assert exists(f"spec/{letter}-gents/")

    # Implementation exists
    assert exists(f"impl/claude-openrouter/agents/{letter}/")

    # All agents pass Judge
    for agent in agents:
        assert Judge(agent, Principles).verdict == "accept"

    # No contradictions with spec
    assert Contradict(impl, spec) is None

    # Autopoiesis achieved
    assert autopoiesis_score() > 0.5

    # Human approval
    assert kent_approves()
```

---

## Compose: The Full Picture

```
Bootstrap Kernel (exists)
    │
    ├─► Use K-gent for naming
    ├─► Use CreativityCoach for design
    ├─► Use HypothesisEngine for validation
    │
    └─► New Agents
            │
            └─► Which enable more agents...
```

---

## Next Action

1. Read `AUTONOMOUS_BOOTSTRAP_PROTOCOL.md`
2. Instantiate `ClaudeCLIRuntime`
3. Use CreativityCoach to explore your target domain
4. Write spec
5. Implement with >50% autopoiesis
