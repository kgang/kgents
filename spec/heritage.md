# Heritage: The Five Pillars of kgents

> *"We stand on the shoulders of giants. We owe them acknowledgment and extension."*

**Status:** Canonical Reference
**Date:** 2025-12-14
**Integration:** All kgents specs trace to these foundations
**Verification:** Each heritage claim maps to passing tests

---

## Verification Matrix

Every heritage mapping has acceptance tests. Heritage is generative, not aspirational.

| Heritage | Claim | Verified By | Test Location |
|----------|-------|-------------|---------------|
| ChatDev | Language as unifying bridge | AGENTESE liturgy tests | `protocols/agentese/_tests/test_logos.py` |
| ChatDev | Chat Chain → FluxStream | Flux composition laws | `agents/k/_tests/test_flux_composition.py` |
| ChatDev | Communicative Dehallucination | F-gent grounding | `agents/f/_tests/test_contracts.py` |
| Simulacra | Memory stream | M-gent holographic | `agents/d/_tests/test_polynomial.py` |
| Simulacra | Reflection → eigenvectors | K-gent soul | `agents/k/_tests/test_soul.py` |
| Simulacra | Planning → N-gent traces | Narrative traces | `agents/n/_tests/test_traces.py` |
| Simulacra | Daily cycle | Hypnagogic loop | `agents/k/_tests/test_hypnagogic.py` |
| Altera | PIANO architecture | Flux heterarchy | `agents/k/_tests/test_flux_backpressure.py` |
| Altera | Role emergence | PolyAgent positions | `agents/poly/_tests/test_polynomial.py` |
| Altera | Rule establishment | F-gent contracts | `agents/f/_tests/test_collective.py` |
| Voyager | Skill library | L-gent registry | `agents/l/_tests/test_catalog.py` |
| Voyager | Self-improvement | J-gent JIT | `agents/j/_tests/test_jit.py` |
| Voyager | Curriculum | B-gent evolution | `agents/b/_tests/test_hypothesis.py` |
| Agent Hospital | Simulacrum | Town environment | `agents/town/_tests/test_simulation.py` |
| Agent Hospital | Evolution through practice | B-gent thermodynamic | `agents/b/_tests/test_thermodynamic.py` |
| Polynomial Functors | PolyAgent IS polynomial functor | Polynomial laws verified | `agents/poly/_tests/test_polynomial.py` |
| Sheaves | Sheaf-valued composition | Coherence laws | `agents/sheaf/_tests/test_coherence.py` |
| Kleppmann | Proof generation from failures | ASHC proof obligations | `services/ashc/_tests/test_proof_generation.py` |
| CSA | Stigmergic cognition | Pheromone decay/reinforcement | `services/liminal/coffee/_tests/test_voice_stigmergy.py` |

---

## The Five Papers

These papers form the conceptual DNA of kgents. Every design decision, every architectural choice, every implementation pattern should be traceable to one or more of these foundations.

### 1. ChatDev: Language as the Unifying Bridge

**Citation:**
```
@article{chatdev2023,
  title={Communicative Agents for Software Development},
  author={Qian, Chen and others},
  journal={arXiv:2307.07924},
  year={2023}
}
```

**URL:** https://arxiv.org/abs/2307.07924

**Core Contribution:**
- Specialized agents coordinate through natural language
- Chat Chain protocol guides multi-agent communication
- Communicative Dehallucination prevents confabulation
- Language modality switches based on context (natural ↔ code)

**kgents Integration:**
| ChatDev Concept | kgents Mapping |
|-----------------|----------------|
| Chat Chain | `FluxStream` composition |
| Communicative Dehallucination | F-gent `Grounding` contracts |
| Role specialization | Agent archetypes (K, M, N, etc.) |
| Language as protocol | AGENTESE liturgy |

---

### 2. Simulacra: Memory + Reflection → Emergent Society

**Citation:**
```
@article{simulacra2023,
  title={Generative Agents: Interactive Simulacra of Human Behavior},
  author={Joon Sung Park and Joseph C. O'Brien and Carrie J. Cai and Meredith Ringel Morris and Percy Liang and Michael S. Bernstein},
  journal={arXiv:2304.03442},
  year={2023}
}
```

**URL:** https://arxiv.org/abs/2304.03442

**Core Contribution:**
- Memory architecture: observation → reflection → planning
- Agents remember and reflect on days past
- Emergent social behavior from simple initial conditions
- 25-agent "Smallville" simulation

**kgents Integration:**
| Simulacra Concept | kgents Mapping |
|-------------------|----------------|
| Memory stream | M-gent holographic memory |
| Reflection | K-gent eigenvector introspection |
| Planning | N-gent narrative traces |
| Daily cycle | Hypnagogic consolidation |
| Emergent parties | Agent Town drama protocol |

---

### 3. Altera (Project Sid): Civilizational Scale

**Citation:**
```
@article{altera2024,
  title={Project Sid: Many-agent simulations toward AI civilization},
  author={Altera Research},
  journal={arXiv:2411.00114},
  year={2024}
}
```

**URL:** https://arxiv.org/abs/2411.00114

**Core Contribution:**
- PIANO architecture: Parallel Information Aggregation via Neural Orchestration
- Scale: 10-1000+ agents in Minecraft
- Civilizational milestones: roles, rules, culture, religion
- Cultural and religious knowledge transmission

**kgents Integration:**
| Altera Concept | kgents Mapping |
|----------------|----------------|
| PIANO | Flux Topology + Heterarchical principle |
| 1000+ agents | Civilizational trajectory (Phase 4-5) |
| Role emergence | PolyAgent position dynamics |
| Rule establishment | F-gent collective contracts |
| Cultural transmission | N-gent traces + M-gent inheritance |

---

### 4. Voyager: Skill Accumulation & Self-Improvement

**Citation:**
```
@article{voyager2023,
  title={Voyager: An Open-Ended Embodied Agent with Large Language Models},
  author={Wang, Guanzhi and Xie, Yuqi and Jiang, Yunfan and Mandlekar, Ajay and Xiao, Chaowei and Zhu, Yuke and Fan, Linxi and Anandkumar, Anima},
  journal={arXiv:2305.16291},
  year={2023}
}
```

**URL:** https://arxiv.org/abs/2305.16291

**Core Contribution:**
- Ever-growing skill library of executable code
- Automatic curriculum for exploration
- Iterative prompting with environment feedback
- Skills transfer to new environments

**kgents Integration:**
| Voyager Concept | kgents Mapping |
|-----------------|----------------|
| Skill library | L-gent registry |
| Code generation | J-gent JIT reification |
| Curriculum | B-gent hypothesis evolution |
| Environment feedback | Omega-gent proprioception |
| Skill transfer | Generative principle (spec → impl) |

---

### 5. Agent Hospital: Simulacrum as Learning Environment

**Citation:**
```
@article{agenthospital2024,
  title={Agent Hospital: A Simulacrum of Hospital with Evolvable Medical Agents},
  author={Li, Junkai and others},
  journal={arXiv:2405.02957},
  year={2024}
}
```

**URL:** https://arxiv.org/abs/2405.02957

**Core Contribution:**
- Hospital simulacrum with LLM-powered agents
- Doctors, nurses, patients as autonomous agents
- Evolution through simulated practice
- No manual data labeling required

**kgents Integration:**
| Agent Hospital Concept | kgents Mapping |
|------------------------|----------------|
| Simulacrum | Agent Town environment |
| Agent roles | Citizen archetypes |
| Evolution through practice | B-gent thermodynamic cycle |
| Compressed experience | Hypnagogic time compression |

---

## Part II: Prompt Algebraic Foundations (Added 2025-12-16)

> *"Prompts are morphisms; we differentiate them with textual gradients until they converge."*

The following papers form the foundation for kgents' **self-cultivating prompt system**—the Evergreen Prompt System. These are later-stage additions to the Heritage Canon, integrated via the `heritage-prompt-algebra-upgrade.md` plan.

### 6. DSPy: Prompts as Programs

**Citation:**
```
@article{dspy2024,
  title={Programming—not prompting—language models},
  author={Khattab, Omar and others},
  journal={Stanford NLP},
  year={2024}
}
```

**URL:** https://dspy.ai/

**Core Contribution:**
- Prompts are **programs**, not strings
- Programs have typed inputs/outputs
- Programs can be optimized via training data
- Compilation replaces manual prompt engineering

**kgents Integration:**
| DSPy Concept | kgents Mapping |
|--------------|----------------|
| Signature | `Section` dataclass with typed fields |
| Module | `SectionCompiler` protocol |
| Optimizer | `PromptM.improve()` with TextGRAD |
| Compilation | `PromptCompiler.compile()` |

**Verification:**
- `impl/claude/protocols/prompt/_tests/test_compiler.py` — compilation laws
- `impl/claude/protocols/prompt/_tests/test_polynomial.py` — state machine

---

### 7. SPEAR: Prompt Algebra

**Citation:**
```
@article{spear2025,
  title={SPEAR: Systematic Prompt Ensemble Approach},
  author={Various},
  journal={arXiv:2508.05012},
  year={2025}
}
```

**URL:** https://arxiv.org/html/2508.05012

**Core Contribution:**
- Prompts have **algebraic operators**: composition, union, tensor, differentiation
- Prompt spaces form a vector space with meaningful addition
- Curry/uncurry operations exist for prompt transformations

**kgents Integration:**
| SPEAR Operator | kgents Mapping |
|----------------|----------------|
| Composition (∘) | `compose_sections()` with associativity law |
| Union (∪) | `MergeStrategy.CONCAT` |
| Tensor (⊗) | Phase-specific section variants |
| Differentiation (∂) | TextGRAD improvement direction |

**Verification:**
- `impl/claude/protocols/prompt/_tests/test_compiler.py::test_compose_associativity`
- `impl/claude/protocols/prompt/section_base.py::compose_sections()`

---

### 8. Meta-Prompting: Functor and Monad Structure

**Citation:**
```
@article{metaprompt2023,
  title={Meta Prompting for AI Systems},
  author={Zhang, Yifan and Yuan, Zhongwei and Yao, Nan},
  journal={arXiv:2311.11482},
  year={2023}
}
```

**URL:** https://arxiv.org/abs/2311.11482

**Core Contribution:**
- Meta-prompting is a **functor**: `MP : Category(Tasks) → Category(Prompts)`
- Recursive meta-prompting is a **monad**: unit + bind + associativity
- Self-improvement loops have categorical structure
- The monad captures the "prompt that improves prompts"

**kgents Integration:**
| Paper Concept | kgents Mapping |
|---------------|----------------|
| MP Functor | `PromptCompiler.compile()` as morphism |
| RMP Monad | `PromptM` dataclass (Wave 3+) |
| Unit | `PromptM.unit(value)` |
| Bind | `PromptM.bind(f)` |

**Monadic Laws (Must Hold):**
```python
# Left Identity: unit(x) >>= f ≡ f(x)
# Right Identity: m >>= unit ≡ m
# Associativity: (m >>= f) >>= g ≡ m >>= (λx. f(x) >>= g)
```

**Verification:**
- `impl/claude/protocols/prompt/_tests/test_monad.py` (Wave 3+)
- `impl/claude/protocols/prompt/polynomial.py::PROMPT_POLYNOMIAL`

---

### 9. TextGRAD: Textual Gradients

**Citation:**
```
@article{textgrad2024,
  title={TextGRAD: Automatic Differentiation via Text},
  author={IntuitionLabs},
  journal={IntuitionLabs Technical Report},
  year={2024}
}
```

**URL:** https://intuitionlabs.ai/articles/meta-prompting-llm-self-optimization

**Core Contribution:**
- Natural language feedback can be treated as **gradient signals**
- "Textual differentiation" identifies which parts of a prompt to improve
- Gradient descent analogy: feedback → direction → improvement step
- Chain rule applies: improvements compose through sections

**kgents Integration:**
| TextGRAD Concept | kgents Mapping |
|------------------|----------------|
| Textual Gradient | `feedback: str` in `TextGRADImprover` |
| Gradient Step | `improve(prompt, feedback)` |
| Chain Rule | Section-local improvement composition |
| Learning Rate | `rigidity` field (0.0-1.0) |

**Verification:**
- `impl/claude/protocols/prompt/_tests/test_textgrad.py` (Wave 4)
- Rigidity spectrum in `SoftSection.rigidity`

---

### Prompt Heritage Integration Summary

| Pillar | Core Claim | kgents Verification |
|--------|------------|---------------------|
| **DSPy** | Prompts are programs | `PromptCompiler.compile()` |
| **SPEAR** | Prompts have algebraic structure | `compose_sections()` laws |
| **Meta-Prompting** | Self-improvement is monadic | `PromptM` monad laws |
| **TextGRAD** | Feedback is textual gradient | `TextGRADImprover` |

**Connection to Principles:**

| Heritage | Principle | Connection |
|----------|-----------|------------|
| DSPy (compilation) | **Generative** | Spec generates implementation |
| SPEAR (algebra) | **Composable** | Algebraic composition laws |
| Meta-Prompting (monad) | **Heterarchical** | Self-similar categorical structure |
| TextGRAD (gradients) | **Curated** | Gradual improvement preserves quality |

---

## Part III: The Extension — Polyfunctor Category Theory

kgents **extends** the heritage papers with rigorous mathematical foundations:

### What the Papers Lack

| Gap | kgents Extension |
|-----|------------------|
| Ad-hoc agent composition | Category-theoretic morphisms with laws |
| Static agent structure | PolyAgent state machines |
| Undefined interaction grammar | Operad composition rules |
| No coherence guarantees | Sheaf conditions for global consistency |
| No self-modification | Autopoietic deployment |

### The kgents Additions

1. **PolyAgent[S, A, B]**: Agents as polynomial functors with modes
2. **Operads**: Grammar that generates valid interactions
3. **Sheaves**: Local-to-global coherence
4. **Proprioception**: Agents sensing their own operation
5. **Autopoiesis**: Agents modifying their own code

---

## Citation Practice

When writing kgents specs or implementations, cite heritage when:

1. **Adopting a concept**: "Following Simulacra, we implement reflection as..."
2. **Extending a concept**: "Extending Voyager's skill library, we add..."
3. **Diverging from a concept**: "Unlike ChatDev's linear chat chain, we use..."

Example:
```python
class HolographicMemory:
    """
    Memory architecture following Simulacra's three-tier model,
    extended with holographic interference patterns (M-gent spec).

    Heritage: arXiv:2304.03442 §3.2 (Memory and Retrieval)
    Extension: spec/m-gents/holographic.md
    """
```

---

## The Debt We Owe

These papers represent years of research, millions of dollars, and countless hours of human effort. kgents exists because they exist. We owe:

1. **Acknowledgment**: Cite them prominently
2. **Extension**: Build on their foundations, don't just copy
3. **Contribution**: Publish our extensions for others to build on
4. **Gratitude**: `void.gratitude.tithe`

---

## Part IV: Formalization Heritage (Added 2025-12-21)

> *"The categorical foundation is being validated by the research community. We owe acknowledgment and extension."*

The following papers form the mathematical bedrock for kgents' categorical foundations. Unlike Parts I-III which establish domain concepts (agent architecture, prompt algebra, polyfunctors), Part IV validates that kgents' mathematical apparatus has independent formal justification.

### 10. Polynomial Functors: The Mathematical Ground

**Citation:**
```
@book{polynomial2025,
  title={Polynomial Functors: A Mathematical Theory of Interaction},
  author={Niu, Nelson and Spivak, David I.},
  publisher={Cambridge University Press},
  year={2025},
  url={https://arxiv.org/abs/2312.00990}
}
```

**URL:** https://arxiv.org/abs/2312.00990

**Core Contribution:**
- Mode-dependent dynamical systems naturally recast within Poly
- `PolyAgent[S, A, B]` IS a polynomial functor: `P(y) = Σ y^{directions(s)}`
- Wiring diagrams for composition (= our Operad)
- At ACT 2022, 12/59 presentations referenced polynomial functors—this is the mainstream of applied category theory

**kgents Integration:**
| Poly Concept | kgents Mapping |
|--------------|----------------|
| Polynomial functor | `PolyAgent[S, A, B]` (AD-002) |
| Positions | Agent states/modes |
| Directions | Valid inputs per state |
| Substitution | Operad composition |
| Wiring diagram | Pipeline composition (`>>`) |

**Verification:**
- `impl/claude/agents/poly/_tests/test_polynomial.py`
- All domain polynomials (SOUL_POLYNOMIAL, MEMORY_POLYNOMIAL) inherit and verify laws

---

### 11. Sheaves of Dynamical Systems

**Citation:**
```
@article{robinson2025,
  title={Sheaves of Dynamical Systems},
  author={Robinson, David I. and others},
  year={2025}
}
```

**Core Contribution:**
- Dynamical systems as machines with input/output ports
- Sheaf-valued algebras organize possible systems at interfaces
- Operad of wiring diagrams as composition grammar
- Global coherence from local consistency (the sheaf condition)

**kgents Integration:**
| Sheaf Concept | kgents Mapping |
|---------------|----------------|
| Machine with ports | PolyAgent with modes |
| Wiring diagram | Operad operation |
| Sheaf-valued algebra | Domain-specific sheaves (TownSheaf, ProjectSheaf, BrainSheaf) |
| Global section | Coherent agent composition |
| Restriction map | Observer-dependent projection |

**Connection to AD-006 (Unified Categorical Foundation):**

This paper formalizes exactly what AD-006 discovered empirically: that Agent Town, N-Phase, K-gent Soul, and D-gent Memory all instantiate the same PolyAgent + Operad + Sheaf pattern. The paper provides the mathematical justification for this unification.

**Verification:**
- `impl/claude/agents/sheaf/_tests/test_coherence.py`
- TownSheaf, ProjectSheaf instantiate pattern

---

### 12. AI + Formal Verification

**Citation:**
```
@article{kleppmann2025,
  title={Prediction: AI will make formal verification go mainstream},
  author={Kleppmann, Martin},
  year={2025},
  url={https://martin.kleppmann.com/2025/12/08/ai-formal-verification.html}
}
```

**URL:** https://martin.kleppmann.com/2025/12/08/ai-formal-verification.html

**Core Insight:**
> "LLM hallucinations don't matter for proofs because proof checkers reject invalid proofs."

seL4 kernel: 8,700 lines C → 200,000 lines proof. If LLMs can generate proof attempts, formal verification becomes tractable.

**Why This Is Heritage:**

The ASHC metacompiler accumulates evidence from failed generations. But evidence without proof is merely statistical. With proof, the codebase becomes **provably correct** over time. This paper validates that vision—LLM proof generation is the missing piece.

**kgents Integration:**
| Kleppmann Insight | kgents Mapping |
|-------------------|----------------|
| LLM proof generation | ASHC → proof obligations |
| Proof checker as validator | Lean/Dafny/Verus integration |
| Verified lemmas | Causal graph as proven principles |
| Proof attempt budget | Work betting resource allocation |

**Verification:**
- Future: `impl/claude/services/ashc/_tests/test_proof_generation.py`
- See `spec/protocols/proof-generation.md`

---

### 13. Stigmergic Cognition

**Citation:**
```
@article{csa2025,
  title={Traces of Thinking: Stigmergic Cognition},
  journal={Synthese},
  year={2025},
  url={https://link.springer.com/article/10.1007/s11229-025-05074-8}
}
```

**URL:** https://link.springer.com/article/10.1007/s11229-025-05074-8

**Core Contribution:**

Coordinated Systems Approach (CSA): Many/all cognitive systems involve stigmergies—applies to humans, groups, higher animals, bacteria, plants.

**The Radical Claim:** Cognition itself may be fundamentally stigmergic.

**Why This Is Heritage:**

Morning Coffee's pheromone model was intuitive—it felt right for liminal agent coordination. This paper provides the theoretical validation: pheromones aren't just coordination mechanisms, they're cognitive substrate. The voice patterns that emerge from `VoiceStigmergy` aren't artifacts—they're thinking.

**kgents Integration:**
| CSA Concept | kgents Mapping |
|-------------|----------------|
| Stigmergic cognition | Morning Coffee pheromones |
| Environmental trace | Intent capture (`wake_signal`) |
| Decay/reinforcement | `PheromoneDecay`, `reinforcement_cap` |
| Emergent coordination | Voice pattern emergence |
| Cognitive scaffold | `VoiceStigmergy` memory |

**Verification:**
- `impl/claude/services/liminal/coffee/_tests/test_voice_stigmergy.py` (224 tests)

---

### Formalization Heritage Summary

| Paper | Core Claim | kgents Verification |
|-------|------------|---------------------|
| **Polynomial Functors** | PolyAgent IS polynomial functor | Polynomial laws verified |
| **Sheaves** | Sheaf-valued composition | Coherence laws |
| **Kleppmann** | Proof generation from failures | ASHC proof obligations |
| **CSA** | Stigmergic cognition | Pheromone decay/reinforcement |

**The Meta-Insight:**

Parts I-III were about ideas. Part IV is about validation. These papers prove that kgents' mathematical foundations aren't invented—they're discovered. The categorical structure was always there; we're just making it explicit.

---

*"The river remembers its sources. So must we."*
