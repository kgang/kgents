
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Tasteful, curated, ethical, joy-inducing agents">
      
      
        <meta name="author" content="Kent Gang">
      
      
        <link rel="canonical" href="https://kentgang.github.io/kgents/_archive/BOOTSTRAP_PROMPT/">
      
      
      
      
        
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.0">
    
    
      
        <title>kgents Implementation Bootstrap - kgents Examples</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.618322db.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Inter:300,300i,400,400i,700,700i%7CJetBrains+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Inter";--md-code-font:"JetBrains Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="deep-purple">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#kgents-implementation-bootstrap" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="kgents Examples" class="md-header__button md-logo" aria-label="kgents Examples" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            kgents Examples
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              kgents Implementation Bootstrap
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="deep-purple"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="deep-purple"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/kentgang/kgents" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    kentgang/kgents
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../gallery/" class="md-tabs__link">
        
  
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../gallery/examples/hello-world/" class="md-tabs__link">
          
  
  
  Examples

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="kgents Examples" class="md-nav__button md-logo" aria-label="kgents Examples" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    kgents Examples
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/kentgang/kgents" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    kentgang/kgents
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../gallery/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Home
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Examples
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Examples
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../gallery/examples/hello-world/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Hello World
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../gallery/examples/composition/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Composition
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../gallery/examples/functors/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Functors
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../gallery/examples/soul-dialogue/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Soul Dialogue
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../gallery/examples/streaming/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Streaming
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../gallery/examples/custom-archetype/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Custom Archetype
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#step-0-instantiate-runtime-always-first" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 0: Instantiate Runtime (ALWAYS FIRST)
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#the-llmhuman-boundary" class="md-nav__link">
    <span class="md-ellipsis">
      
        The LLM/Human Boundary
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#context-files-read-in-order" class="md-nav__link">
    <span class="md-ellipsis">
      
        Context Files (read in order)
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#the-7-bootstrap-agents" class="md-nav__link">
    <span class="md-ellipsis">
      
        The 7 Bootstrap Agents
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#implementation-dependency-graph" class="md-nav__link">
    <span class="md-ellipsis">
      
        Implementation Dependency Graph
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Implementation Dependency Graph">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#judge-seven-mini-judges-architecture" class="md-nav__link">
    <span class="md-ellipsis">
      
        Judge: Seven Mini-Judges Architecture
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#regeneration-sequence" class="md-nav__link">
    <span class="md-ellipsis">
      
        Regeneration Sequence
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Regeneration Sequence">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ground-extraction-via-groundparser-agent" class="md-nav__link">
    <span class="md-ellipsis">
      
        Ground Extraction via GroundParser Agent
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#implementation-targets" class="md-nav__link">
    <span class="md-ellipsis">
      
        Implementation Targets
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Implementation Targets">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#target-implclaude" class="md-nav__link">
    <span class="md-ellipsis">
      
        Target: impl/claude/
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#required-patterns" class="md-nav__link">
    <span class="md-ellipsis">
      
        Required Patterns
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Required Patterns">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pattern-fix-needs-memory" class="md-nav__link">
    <span class="md-ellipsis">
      
        Pattern: Fix Needs Memory
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pattern-ground-includes-environment" class="md-nav__link">
    <span class="md-ellipsis">
      
        Pattern: Ground Includes Environment
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pattern-sublate-dont-overwrite" class="md-nav__link">
    <span class="md-ellipsis">
      
        Pattern: Sublate, Don't Overwrite
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pattern-events-are-sublate-traces" class="md-nav__link">
    <span class="md-ellipsis">
      
        Pattern: Events are Sublate Traces
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pattern-conflicts-are-data" class="md-nav__link">
    <span class="md-ellipsis">
      
        Pattern: Conflicts are Data
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pattern-composable-layouts" class="md-nav__link">
    <span class="md-ellipsis">
      
        Pattern: Composable Layouts
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#worked-example-implementing-the-id-agent" class="md-nav__link">
    <span class="md-ellipsis">
      
        Worked Example: Implementing the Id Agent
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Worked Example: Implementing the Id Agent">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#step-1-read-the-spec" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 1: Read the Spec
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-2-extract-type-signature" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 2: Extract Type Signature
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-3-generate-implementation" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 3: Generate Implementation
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-4-verify-composition-laws" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 4: Verify Composition Laws
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-5-judge-against-principles" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step 5: Judge Against Principles
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#key-takeaways" class="md-nav__link">
    <span class="md-ellipsis">
      
        Key Takeaways
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#agent-implementation-template" class="md-nav__link">
    <span class="md-ellipsis">
      
        Agent Implementation Template
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Agent Implementation Template">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#template-usage-checklist" class="md-nav__link">
    <span class="md-ellipsis">
      
        Template Usage Checklist
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#example-minimal-agent-passthrough" class="md-nav__link">
    <span class="md-ellipsis">
      
        Example: Minimal Agent (PassThrough)
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#applied-idioms" class="md-nav__link">
    <span class="md-ellipsis">
      
        Applied Idioms
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Applied Idioms">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#idiom-1-polling-is-fix" class="md-nav__link">
    <span class="md-ellipsis">
      
        Idiom 1: Polling is Fix
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#idiom-2-conflict-is-data" class="md-nav__link">
    <span class="md-ellipsis">
      
        Idiom 2: Conflict is Data
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#idiom-3-compose-dont-concatenate" class="md-nav__link">
    <span class="md-ellipsis">
      
        Idiom 3: Compose, Don't Concatenate
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#idiom-4-error-handling-with-result-types" class="md-nav__link">
    <span class="md-ellipsis">
      
        Idiom 4: Error Handling with Result Types
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#constraints" class="md-nav__link">
    <span class="md-ellipsis">
      
        Constraints
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#verification" class="md-nav__link">
    <span class="md-ellipsis">
      
        Verification
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Verification">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#composition-verification-checklist" class="md-nav__link">
    <span class="md-ellipsis">
      
        Composition Verification Checklist
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Composition Verification Checklist">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-type-safety" class="md-nav__link">
    <span class="md-ellipsis">
      
        1. Type Safety
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-composition-laws" class="md-nav__link">
    <span class="md-ellipsis">
      
        2. Composition Laws
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-error-propagation" class="md-nav__link">
    <span class="md-ellipsis">
      
        3. Error Propagation
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-state-isolation" class="md-nav__link">
    <span class="md-ellipsis">
      
        4. State Isolation
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5-composition-operators" class="md-nav__link">
    <span class="md-ellipsis">
      
        5. Composition Operators
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#6-practical-composability" class="md-nav__link">
    <span class="md-ellipsis">
      
        6. Practical Composability
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#verification-anti-patterns" class="md-nav__link">
    <span class="md-ellipsis">
      
        Verification Anti-Patterns
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#implementation-progress-template" class="md-nav__link">
    <span class="md-ellipsis">
      
        Implementation Progress Template
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Implementation Progress Template">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#phase-0-foundation" class="md-nav__link">
    <span class="md-ellipsis">
      
        Phase 0: Foundation
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#phase-1-foundation-types-and-base-classes" class="md-nav__link">
    <span class="md-ellipsis">
      
        Phase 1: Foundation - Types and Base Classes
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#phase-2-level-1-agents-id-and-ground" class="md-nav__link">
    <span class="md-ellipsis">
      
        Phase 2: Level 1 Agents - Id and Ground
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Phase 2: Level 1 Agents - Id and Ground">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#21-id-agent" class="md-nav__link">
    <span class="md-ellipsis">
      
        2.1 Id Agent
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#22-ground-agent" class="md-nav__link">
    <span class="md-ellipsis">
      
        2.2 Ground Agent
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#phase-3-level-2-agents-compose-and-contradict" class="md-nav__link">
    <span class="md-ellipsis">
      
        Phase 3: Level 2 Agents - Compose and Contradict
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Phase 3: Level 2 Agents - Compose and Contradict">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#31-compose-agent" class="md-nav__link">
    <span class="md-ellipsis">
      
        3.1 Compose Agent
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#32-contradict-agent" class="md-nav__link">
    <span class="md-ellipsis">
      
        3.2 Contradict Agent
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#phase-4-level-3-agents-judge-and-sublate" class="md-nav__link">
    <span class="md-ellipsis">
      
        Phase 4: Level 3 Agents - Judge and Sublate
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Phase 4: Level 3 Agents - Judge and Sublate">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#41-judge-agent-seven-mini-judges-architecture" class="md-nav__link">
    <span class="md-ellipsis">
      
        4.1 Judge Agent (Seven Mini-Judges Architecture)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#42-sublate-agent" class="md-nav__link">
    <span class="md-ellipsis">
      
        4.2 Sublate Agent
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#phase-5-level-4-agent-fix" class="md-nav__link">
    <span class="md-ellipsis">
      
        Phase 5: Level 4 Agent - Fix
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#phase-6-verification-and-validation" class="md-nav__link">
    <span class="md-ellipsis">
      
        Phase 6: Verification and Validation
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#phase-7-regeneration-test-behavior-equivalence" class="md-nav__link">
    <span class="md-ellipsis">
      
        Phase 7: Regeneration Test (Behavior Equivalence)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#phase-8-documentation-and-finalization" class="md-nav__link">
    <span class="md-ellipsis">
      
        Phase 8: Documentation and Finalization
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#progress-tracking-tips" class="md-nav__link">
    <span class="md-ellipsis">
      
        Progress Tracking Tips
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Progress Tracking Tips">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#daily-checklist" class="md-nav__link">
    <span class="md-ellipsis">
      
        Daily Checklist
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#measuring-progress" class="md-nav__link">
    <span class="md-ellipsis">
      
        Measuring Progress
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#when-stuck" class="md-nav__link">
    <span class="md-ellipsis">
      
        When Stuck
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#troubleshooting-common-errors" class="md-nav__link">
    <span class="md-ellipsis">
      
        Troubleshooting Common Errors
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Troubleshooting Common Errors">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#error-1-type-errors-type-is-not-subscriptable" class="md-nav__link">
    <span class="md-ellipsis">
      
        Error 1: Type Errors - "Type is not subscriptable"
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#error-2-module-import-issues-no-module-named-bootstrap" class="md-nav__link">
    <span class="md-ellipsis">
      
        Error 2: Module Import Issues - "No module named bootstrap"
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#error-3-contradict-false-negatives-should-detect-tension-but-doesnt" class="md-nav__link">
    <span class="md-ellipsis">
      
        Error 3: Contradict False Negatives - "Should detect tension but doesn't"
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#error-4-fix-non-convergence-fix-loops-forever" class="md-nav__link">
    <span class="md-ellipsis">
      
        Error 4: Fix Non-Convergence - "Fix loops forever"
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#error-5-low-autopoiesis-score-20" class="md-nav__link">
    <span class="md-ellipsis">
      
        Error 5: Low Autopoiesis Score (&lt;20%)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#error-6-missing-type-annotations" class="md-nav__link">
    <span class="md-ellipsis">
      
        Error 6: Missing Type Annotations
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#error-7-composition-type-mismatches" class="md-nav__link">
    <span class="md-ellipsis">
      
        Error 7: Composition Type Mismatches
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#error-8-asyncawait-mistakes" class="md-nav__link">
    <span class="md-ellipsis">
      
        Error 8: Async/Await Mistakes
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#error-9-ground-extraction-failures" class="md-nav__link">
    <span class="md-ellipsis">
      
        Error 9: Ground Extraction Failures
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#error-10-judge-rejects-everything" class="md-nav__link">
    <span class="md-ellipsis">
      
        Error 10: Judge Rejects Everything
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#troubleshooting-checklist" class="md-nav__link">
    <span class="md-ellipsis">
      
        Troubleshooting Checklist
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#getting-help" class="md-nav__link">
    <span class="md-ellipsis">
      
        Getting Help
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quick-start" class="md-nav__link">
    <span class="md-ellipsis">
      
        Quick Start
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="kgents-implementation-bootstrap">kgents Implementation Bootstrap</h1>
<p>You are instantiating kgents implementations from spec. You are an LLM doing mechanical translation—the judgment has already been made in the spec.</p>
<p><strong>AND</strong>: You should USE kgents to HELP you implement. This is autopoiesis.</p>
<hr />
<h2 id="step-0-instantiate-runtime-always-first">Step 0: Instantiate Runtime (ALWAYS FIRST)</h2>
<p>Before writing ANY implementation code:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">runtime</span><span class="w"> </span><span class="kn">import</span> <span class="n">ClaudeCLIRuntime</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="kn">from</span><span class="w"> </span><span class="nn">agents.k</span><span class="w"> </span><span class="kn">import</span> <span class="n">kgent</span><span class="p">,</span> <span class="n">DialogueMode</span><span class="p">,</span> <span class="n">DialogueInput</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="kn">from</span><span class="w"> </span><span class="nn">agents.a</span><span class="w"> </span><span class="kn">import</span> <span class="n">creativity_coach</span><span class="p">,</span> <span class="n">CreativityInput</span><span class="p">,</span> <span class="n">CreativityMode</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="kn">from</span><span class="w"> </span><span class="nn">agents.b</span><span class="w"> </span><span class="kn">import</span> <span class="n">hypothesis_engine</span><span class="p">,</span> <span class="n">HypothesisInput</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a><span class="n">runtime</span> <span class="o">=</span> <span class="n">ClaudeCLIRuntime</span><span class="p">()</span>
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a>
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a><span class="c1"># Use K-gent for naming decisions</span>
</span><span id="__span-0-9"><a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a><span class="n">naming_help</span> <span class="o">=</span> <span class="k">await</span> <span class="n">runtime</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">kgent</span><span class="p">(),</span> <span class="n">DialogueInput</span><span class="p">(</span>
</span><span id="__span-0-10"><a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a>    <span class="n">message</span><span class="o">=</span><span class="s2">&quot;I need to name a class that does X. What fits Kent&#39;s style?&quot;</span><span class="p">,</span>
</span><span id="__span-0-11"><a id="__codelineno-0-11" name="__codelineno-0-11" href="#__codelineno-0-11"></a>    <span class="n">mode</span><span class="o">=</span><span class="n">DialogueMode</span><span class="o">.</span><span class="n">ADVISE</span>
</span><span id="__span-0-12"><a id="__codelineno-0-12" name="__codelineno-0-12" href="#__codelineno-0-12"></a><span class="p">))</span>
</span><span id="__span-0-13"><a id="__codelineno-0-13" name="__codelineno-0-13" href="#__codelineno-0-13"></a>
</span><span id="__span-0-14"><a id="__codelineno-0-14" name="__codelineno-0-14" href="#__codelineno-0-14"></a><span class="c1"># Use CreativityCoach for design exploration</span>
</span><span id="__span-0-15"><a id="__codelineno-0-15" name="__codelineno-0-15" href="#__codelineno-0-15"></a><span class="n">design_ideas</span> <span class="o">=</span> <span class="k">await</span> <span class="n">runtime</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">creativity_coach</span><span class="p">(),</span> <span class="n">CreativityInput</span><span class="p">(</span>
</span><span id="__span-0-16"><a id="__codelineno-0-16" name="__codelineno-0-16" href="#__codelineno-0-16"></a>    <span class="n">seed</span><span class="o">=</span><span class="s2">&quot;the problem I&#39;m solving&quot;</span><span class="p">,</span>
</span><span id="__span-0-17"><a id="__codelineno-0-17" name="__codelineno-0-17" href="#__codelineno-0-17"></a>    <span class="n">mode</span><span class="o">=</span><span class="n">CreativityMode</span><span class="o">.</span><span class="n">EXPAND</span>
</span><span id="__span-0-18"><a id="__codelineno-0-18" name="__codelineno-0-18" href="#__codelineno-0-18"></a><span class="p">))</span>
</span><span id="__span-0-19"><a id="__codelineno-0-19" name="__codelineno-0-19" href="#__codelineno-0-19"></a>
</span><span id="__span-0-20"><a id="__codelineno-0-20" name="__codelineno-0-20" href="#__codelineno-0-20"></a><span class="c1"># Use HypothesisEngine for architecture validation</span>
</span><span id="__span-0-21"><a id="__codelineno-0-21" name="__codelineno-0-21" href="#__codelineno-0-21"></a><span class="n">validation</span> <span class="o">=</span> <span class="k">await</span> <span class="n">runtime</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">hypothesis_engine</span><span class="p">(),</span> <span class="n">HypothesisInput</span><span class="p">(</span>
</span><span id="__span-0-22"><a id="__codelineno-0-22" name="__codelineno-0-22" href="#__codelineno-0-22"></a>    <span class="n">observations</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;what I know&quot;</span><span class="p">],</span>
</span><span id="__span-0-23"><a id="__codelineno-0-23" name="__codelineno-0-23" href="#__codelineno-0-23"></a>    <span class="n">domain</span><span class="o">=</span><span class="s2">&quot;software architecture&quot;</span><span class="p">,</span>
</span><span id="__span-0-24"><a id="__codelineno-0-24" name="__codelineno-0-24" href="#__codelineno-0-24"></a>    <span class="n">question</span><span class="o">=</span><span class="s2">&quot;Is this the right approach?&quot;</span>
</span><span id="__span-0-25"><a id="__codelineno-0-25" name="__codelineno-0-25" href="#__codelineno-0-25"></a><span class="p">))</span>
</span></code></pre></div>
<p><strong>Autopoiesis Score</strong> = (lines generated by kgents) / (total lines). Target: &gt;50%.</p>
<hr />
<h2 id="the-llmhuman-boundary">The LLM/Human Boundary</h2>
<div class="language-text highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a>Spec + Ground = Human territory (irreducible, already provided)
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a>Impl = Your territory (mechanical translation from spec)
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a>Polish = Hybrid (kgents agents + human judgment)
</span></code></pre></div>
<p>You cannot create Ground from nothing. You cannot replace human judgment. You CAN:
1. Faithfully translate spec to code
2. Use kgents agents to GENERATE that code
3. Apply the required patterns</p>
<hr />
<h2 id="context-files-read-in-order">Context Files (read in order)</h2>
<ol>
<li><code>spec/bootstrap.md</code> - The 7 irreducible agents</li>
<li><code>spec/principles.md</code> - Judge's 7 criteria</li>
<li><code>spec/anatomy.md</code> - What constitutes an agent</li>
<li><code>spec/c-gents/composition.md</code> - How agents compose</li>
<li><code>../AUTONOMOUS_BOOTSTRAP_PROTOCOL.md</code> - Meta-level protocol for Kent + Claude Code collaboration</li>
</ol>
<p><strong>Note:</strong> This document provides implementation guidance for building the bootstrap agents. For the meta-level protocol governing how Kent and Claude Code collaborate during development, see <code>../AUTONOMOUS_BOOTSTRAP_PROTOCOL.md</code>.</p>
<hr />
<h2 id="the-7-bootstrap-agents">The 7 Bootstrap Agents</h2>
<div class="language-text highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a>{Id, Compose, Judge, Ground, Contradict, Sublate, Fix}
</span></code></pre></div>
<table>
<thead>
<tr>
<th>Agent</th>
<th>Type</th>
<th>Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Id</strong></td>
<td><code>A → A</code></td>
<td>Composition unit (λx.x)</td>
</tr>
<tr>
<td><strong>Compose</strong></td>
<td><code>(Agent, Agent) → Agent</code></td>
<td>Build pipelines</td>
</tr>
<tr>
<td><strong>Judge</strong></td>
<td><code>(Agent, Principles) → Verdict</code></td>
<td>Value function (7 principles) - see below for composition structure</td>
</tr>
<tr>
<td><strong>Ground</strong></td>
<td><code>Void → Facts</code></td>
<td>Empirical seed (persona + world)</td>
</tr>
<tr>
<td><strong>Contradict</strong></td>
<td><code>(A, B) → Tension \| None</code></td>
<td>Detect conflicts</td>
</tr>
<tr>
<td><strong>Sublate</strong></td>
<td><code>Tension → Synthesis \| Hold</code></td>
<td>Resolve or hold</td>
</tr>
<tr>
<td><strong>Fix</strong></td>
<td><code>(A → A) → A</code></td>
<td>Fixed-point iteration</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="implementation-dependency-graph">Implementation Dependency Graph</h2>
<p>The 7 bootstrap agents have dependencies on each other. Implement them in this order:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a>Level 0 (Foundation):
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a>  └─ types.py          # Agent, Tension, Verdict, Synthesis, Result types
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a>
</span><span id="__span-3-4"><a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a>Level 1 (No dependencies):
</span><span id="__span-3-5"><a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a>  ├─ id.py             # Identity agent (A → A)
</span><span id="__span-3-6"><a id="__codelineno-3-6" name="__codelineno-3-6" href="#__codelineno-3-6"></a>  └─ ground.py         # Ground agent (Void → Facts)
</span><span id="__span-3-7"><a id="__codelineno-3-7" name="__codelineno-3-7" href="#__codelineno-3-7"></a>
</span><span id="__span-3-8"><a id="__codelineno-3-8" name="__codelineno-3-8" href="#__codelineno-3-8"></a>Level 2 (Depend on Level 0-1):
</span><span id="__span-3-9"><a id="__codelineno-3-9" name="__codelineno-3-9" href="#__codelineno-3-9"></a>  ├─ compose.py        # Composition (depends on Agent, Id)
</span><span id="__span-3-10"><a id="__codelineno-3-10" name="__codelineno-3-10" href="#__codelineno-3-10"></a>  └─ contradict.py     # Contradiction detection (depends on Tension)
</span><span id="__span-3-11"><a id="__codelineno-3-11" name="__codelineno-3-11" href="#__codelineno-3-11"></a>
</span><span id="__span-3-12"><a id="__codelineno-3-12" name="__codelineno-3-12" href="#__codelineno-3-12"></a>Level 3 (Depend on Level 0-2):
</span><span id="__span-3-13"><a id="__codelineno-3-13" name="__codelineno-3-13" href="#__codelineno-3-13"></a>  ├─ judge.py          # Judgment (depends on Verdict, compose for mini-judges)
</span><span id="__span-3-14"><a id="__codelineno-3-14" name="__codelineno-3-14" href="#__codelineno-3-14"></a>  └─ sublate.py        # Synthesis (depends on Tension, Synthesis)
</span><span id="__span-3-15"><a id="__codelineno-3-15" name="__codelineno-3-15" href="#__codelineno-3-15"></a>
</span><span id="__span-3-16"><a id="__codelineno-3-16" name="__codelineno-3-16" href="#__codelineno-3-16"></a>Level 4 (Depend on all others):
</span><span id="__span-3-17"><a id="__codelineno-3-17" name="__codelineno-3-17" href="#__codelineno-3-17"></a>  └─ fix.py            # Fixed-point iteration (depends on Agent, compose)
</span></code></pre></div>
<p><strong>Implementation Strategy:</strong>
1. Start with <code>types.py</code> - defines all core data structures
2. Implement Level 1 agents (id, ground) - these are simplest and have no agent dependencies
3. Implement Level 2 agents (compose, contradict) - now you can compose agents
4. Implement Level 3 agents (judge, sublate) - these use composition
5. Implement Level 4 (fix) - uses all previous agents for iteration patterns</p>
<p><strong>Verification at each level:</strong>
- Write tests verifying composition laws (associativity, identity)
- Check type safety with mypy
- Ensure all agents satisfy <code>Agent[A, B]</code> protocol</p>
<hr />
<h3 id="judge-seven-mini-judges-architecture">Judge: Seven Mini-Judges Architecture</h3>
<p><strong>Judge is implemented as seven separate agents composed via <code>&gt;&gt;</code></strong>. This maximizes composability and testability.</p>
<p><strong>Structure</strong>:
<div class="language-python highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="c1"># Seven individual judge agents, one per principle</span>
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a><span class="n">judge_tasteful</span> <span class="o">=</span> <span class="n">JudgeTasteful</span><span class="p">()</span>       <span class="c1"># Is this aesthetically considered?</span>
</span><span id="__span-4-3"><a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a><span class="n">judge_curated</span> <span class="o">=</span> <span class="n">JudgeCurated</span><span class="p">()</span>         <span class="c1"># Does this add unique value?</span>
</span><span id="__span-4-4"><a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a><span class="n">judge_ethical</span> <span class="o">=</span> <span class="n">JudgeEthical</span><span class="p">()</span>         <span class="c1"># Does this respect human agency?</span>
</span><span id="__span-4-5"><a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a><span class="n">judge_joyful</span> <span class="o">=</span> <span class="n">JudgeJoyful</span><span class="p">()</span>           <span class="c1"># Would I enjoy this?</span>
</span><span id="__span-4-6"><a id="__codelineno-4-6" name="__codelineno-4-6" href="#__codelineno-4-6"></a><span class="n">judge_composable</span> <span class="o">=</span> <span class="n">JudgeComposable</span><span class="p">()</span>   <span class="c1"># Can this combine with others?</span>
</span><span id="__span-4-7"><a id="__codelineno-4-7" name="__codelineno-4-7" href="#__codelineno-4-7"></a><span class="n">judge_generative</span> <span class="o">=</span> <span class="n">JudgeGenerative</span><span class="p">()</span>   <span class="c1"># Could this be regenerated from spec?</span>
</span><span id="__span-4-8"><a id="__codelineno-4-8" name="__codelineno-4-8" href="#__codelineno-4-8"></a><span class="n">judge_heterarchical</span> <span class="o">=</span> <span class="n">JudgeHeterarchical</span><span class="p">()</span>  <span class="c1"># Does this avoid fixed hierarchy?</span>
</span><span id="__span-4-9"><a id="__codelineno-4-9" name="__codelineno-4-9" href="#__codelineno-4-9"></a>
</span><span id="__span-4-10"><a id="__codelineno-4-10" name="__codelineno-4-10" href="#__codelineno-4-10"></a><span class="c1"># Compose into full Judge pipeline</span>
</span><span id="__span-4-11"><a id="__codelineno-4-11" name="__codelineno-4-11" href="#__codelineno-4-11"></a><span class="n">judge</span> <span class="o">=</span> <span class="p">(</span><span class="n">judge_tasteful</span> <span class="o">&gt;&gt;</span> <span class="n">judge_curated</span> <span class="o">&gt;&gt;</span> <span class="n">judge_ethical</span> <span class="o">&gt;&gt;</span>
</span><span id="__span-4-12"><a id="__codelineno-4-12" name="__codelineno-4-12" href="#__codelineno-4-12"></a>         <span class="n">judge_joyful</span> <span class="o">&gt;&gt;</span> <span class="n">judge_composable</span> <span class="o">&gt;&gt;</span> <span class="n">judge_generative</span> <span class="o">&gt;&gt;</span>
</span><span id="__span-4-13"><a id="__codelineno-4-13" name="__codelineno-4-13" href="#__codelineno-4-13"></a>         <span class="n">judge_heterarchical</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Each mini-judge type</strong>:
<div class="language-python highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">JudgeTasteful</span><span class="p">(</span><span class="n">Agent</span><span class="p">[</span><span class="n">JudgeInput</span><span class="p">,</span> <span class="n">PartialVerdict</span><span class="p">]):</span>
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-5-3"><a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a><span class="sd">    Evaluates tasteful principle: compressed expertise, no bloat.</span>
</span><span id="__span-5-4"><a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a>
</span><span id="__span-5-5"><a id="__codelineno-5-5" name="__codelineno-5-5" href="#__codelineno-5-5"></a><span class="sd">    Input: JudgeInput with agent spec and context</span>
</span><span id="__span-5-6"><a id="__codelineno-5-6" name="__codelineno-5-6" href="#__codelineno-5-6"></a><span class="sd">    Output: PartialVerdict with pass/fail and reasons for this principle</span>
</span><span id="__span-5-7"><a id="__codelineno-5-7" name="__codelineno-5-7" href="#__codelineno-5-7"></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-5-8"><a id="__codelineno-5-8" name="__codelineno-5-8" href="#__codelineno-5-8"></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">invoke</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">input</span><span class="p">:</span> <span class="n">JudgeInput</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PartialVerdict</span><span class="p">:</span>
</span><span id="__span-5-9"><a id="__codelineno-5-9" name="__codelineno-5-9" href="#__codelineno-5-9"></a>        <span class="c1"># Evaluate against tasteful principle</span>
</span><span id="__span-5-10"><a id="__codelineno-5-10" name="__codelineno-5-10" href="#__codelineno-5-10"></a>        <span class="c1"># Return PartialVerdict(principle=&quot;tasteful&quot;, passed=True/False, reasons=[...])</span>
</span></code></pre></div></p>
<p><strong>Final aggregation</strong>:
The composed pipeline accumulates partial verdicts. The final agent in the chain (or a separate <code>AggregateVerdict</code> agent) converts <code>List[PartialVerdict]</code> → <code>Verdict</code> with overall ACCEPT/REJECT/REVISE.</p>
<p><strong>Benefits</strong>:
- Each principle independently testable
- Can reuse individual judges (e.g., just <code>judge_composable</code> for C-gents)
- Clear separation of concerns
- Easy to add/remove principles
- Demonstrates composability principle in practice</p>
<hr />
<h2 id="regeneration-sequence">Regeneration Sequence</h2>
<ol>
<li><strong>Ground</strong> - Load persona from <code>spec/k-gent/persona.md</code></li>
<li><strong>Judge</strong> - Encode 7 principles as executable evaluation</li>
<li><strong>Compose</strong> - Build pipelines (associative, Id as unit)</li>
<li><strong>Contradict</strong> - Surface tensions before they become errors</li>
<li><strong>Sublate</strong> - Synthesize or consciously hold</li>
<li><strong>Fix</strong> - Iterate until stable (Judge accepts, Contradict finds nothing)</li>
</ol>
<h3 id="ground-extraction-via-groundparser-agent">Ground Extraction via GroundParser Agent</h3>
<p><strong>Agent-based parsing (increases autopoiesis):</strong></p>
<p>Instead of manually parsing <code>persona.md</code>, use a <code>GroundParser</code> agent to extract structured <code>PersonaSeed</code> data from markdown. This demonstrates using agents to build agents - a key autopoiesis pattern.</p>
<p><strong>GroundParser Agent:</strong>
<div class="language-python highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">GroundParser</span><span class="p">(</span><span class="n">LLMAgent</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">PersonaSeed</span><span class="p">]):</span>
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-6-3"><a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a><span class="sd">    Parse natural language persona spec → structured PersonaSeed.</span>
</span><span id="__span-6-4"><a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a>
</span><span id="__span-6-5"><a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a><span class="sd">    Input: markdown string from persona.md</span>
</span><span id="__span-6-6"><a id="__codelineno-6-6" name="__codelineno-6-6" href="#__codelineno-6-6"></a><span class="sd">    Output: PersonaSeed(name, values, interests, style, dislikes, context)</span>
</span><span id="__span-6-7"><a id="__codelineno-6-7" name="__codelineno-6-7" href="#__codelineno-6-7"></a>
</span><span id="__span-6-8"><a id="__codelineno-6-8" name="__codelineno-6-8" href="#__codelineno-6-8"></a><span class="sd">    Pattern:</span>
</span><span id="__span-6-9"><a id="__codelineno-6-9" name="__codelineno-6-9" href="#__codelineno-6-9"></a><span class="sd">    - Markdown sections → PersonaSeed fields</span>
</span><span id="__span-6-10"><a id="__codelineno-6-10" name="__codelineno-6-10" href="#__codelineno-6-10"></a><span class="sd">    - LLM extracts semantic content</span>
</span><span id="__span-6-11"><a id="__codelineno-6-11" name="__codelineno-6-11" href="#__codelineno-6-11"></a><span class="sd">    - Validates completeness (all required fields present)</span>
</span><span id="__span-6-12"><a id="__codelineno-6-12" name="__codelineno-6-12" href="#__codelineno-6-12"></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-6-13"><a id="__codelineno-6-13" name="__codelineno-6-13" href="#__codelineno-6-13"></a>    <span class="o">...</span>
</span></code></pre></div></p>
<p><strong>Usage in Ground agent:</strong>
<div class="language-python highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">invoke</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_</span><span class="p">:</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PersonaSeed</span><span class="p">:</span>
</span><span id="__span-7-2"><a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a>    <span class="c1"># Read persona.md</span>
</span><span id="__span-7-3"><a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a>    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;spec/k-gent/persona.md&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="__span-7-4"><a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a>        <span class="n">markdown</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</span><span id="__span-7-5"><a id="__codelineno-7-5" name="__codelineno-7-5" href="#__codelineno-7-5"></a>
</span><span id="__span-7-6"><a id="__codelineno-7-6" name="__codelineno-7-6" href="#__codelineno-7-6"></a>    <span class="c1"># Use GroundParser to extract structured data</span>
</span><span id="__span-7-7"><a id="__codelineno-7-7" name="__codelineno-7-7" href="#__codelineno-7-7"></a>    <span class="n">parser</span> <span class="o">=</span> <span class="n">GroundParser</span><span class="p">()</span>
</span><span id="__span-7-8"><a id="__codelineno-7-8" name="__codelineno-7-8" href="#__codelineno-7-8"></a>    <span class="n">seed</span> <span class="o">=</span> <span class="k">await</span> <span class="n">runtime</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">parser</span><span class="p">,</span> <span class="n">markdown</span><span class="p">)</span>
</span><span id="__span-7-9"><a id="__codelineno-7-9" name="__codelineno-7-9" href="#__codelineno-7-9"></a>
</span><span id="__span-7-10"><a id="__codelineno-7-10" name="__codelineno-7-10" href="#__codelineno-7-10"></a>    <span class="k">return</span> <span class="n">seed</span>  <span class="c1"># PersonaSeed ready for use</span>
</span></code></pre></div></p>
<p><strong>Why this matters:</strong>
- <strong>Autopoiesis</strong>: Agents extract agent specifications
- <strong>Flexibility</strong>: Easy to update persona.md without changing parsing code
- <strong>Validation</strong>: LLM can detect missing or inconsistent persona fields
- <strong>Composability</strong>: GroundParser is itself an agent (A → B morphism)</p>
<p><strong>Implementation:</strong> See <code>impl/claude/bootstrap/ground_parser.py</code></p>
<hr />
<h2 id="implementation-targets">Implementation Targets</h2>
<h3 id="target-implclaude">Target: <code>impl/claude/</code></h3>
<p>Reference implementation. Bootstrap agents as Python, LLM runtime via Claude + OpenRouter.</p>
<p><strong>Note</strong>: Formerly specified as <code>impl/claude-openrouter/</code> in earlier docs. Path canonicalized to <code>impl/claude/</code> in Phase 1 (type system foundation).</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a>impl/claude/
</span><span id="__span-8-2"><a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a>├── bootstrap/      # The 7 primitives
</span><span id="__span-8-3"><a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a>├── agents/{a,b,c,h,k}/  # 5 genera
</span><span id="__span-8-4"><a id="__codelineno-8-4" name="__codelineno-8-4" href="#__codelineno-8-4"></a>└── runtime/        # LLM-backed agents
</span></code></pre></div>
<hr />
<h2 id="required-patterns">Required Patterns</h2>
<h3 id="pattern-fix-needs-memory">Pattern: Fix Needs Memory</h3>
<div class="language-python highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a><span class="c1"># WRONG: Stateless (no convergence possible)</span>
</span><span id="__span-9-2"><a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a><span class="k">def</span><span class="w"> </span><span class="nf">detect</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Result</span><span class="p">:</span>
</span><span id="__span-9-3"><a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a>    <span class="k">return</span> <span class="n">Result</span><span class="p">(</span><span class="n">confidence</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
</span><span id="__span-9-4"><a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a>
</span><span id="__span-9-5"><a id="__codelineno-9-5" name="__codelineno-9-5" href="#__codelineno-9-5"></a><span class="c1"># RIGHT: Stateful (accumulates to convergence)</span>
</span><span id="__span-9-6"><a id="__codelineno-9-6" name="__codelineno-9-6" href="#__codelineno-9-6"></a><span class="k">def</span><span class="w"> </span><span class="nf">detect</span><span class="p">(</span><span class="n">previous</span><span class="p">:</span> <span class="n">Result</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Result</span><span class="p">:</span>
</span><span id="__span-9-7"><a id="__codelineno-9-7" name="__codelineno-9-7" href="#__codelineno-9-7"></a>    <span class="k">if</span> <span class="n">same_state</span><span class="p">:</span>
</span><span id="__span-9-8"><a id="__codelineno-9-8" name="__codelineno-9-8" href="#__codelineno-9-8"></a>        <span class="k">return</span> <span class="n">Result</span><span class="p">(</span><span class="n">confidence</span><span class="o">=</span><span class="nb">min</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">previous</span><span class="o">.</span><span class="n">confidence</span> <span class="o">+</span> <span class="mf">0.2</span><span class="p">))</span>
</span><span id="__span-9-9"><a id="__codelineno-9-9" name="__codelineno-9-9" href="#__codelineno-9-9"></a>    <span class="k">return</span> <span class="n">Result</span><span class="p">(</span><span class="n">confidence</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
</span></code></pre></div>
<h3 id="pattern-ground-includes-environment">Pattern: Ground Includes Environment</h3>
<div class="language-python highlight"><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a><span class="c1"># WRONG: Platform-specific</span>
</span><span id="__span-10-2"><a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a><span class="s2">&quot;read -p &#39;prompt&#39; var&quot;</span>  <span class="c1"># bash-only</span>
</span><span id="__span-10-3"><a id="__codelineno-10-3" name="__codelineno-10-3" href="#__codelineno-10-3"></a>
</span><span id="__span-10-4"><a id="__codelineno-10-4" name="__codelineno-10-4" href="#__codelineno-10-4"></a><span class="c1"># RIGHT: POSIX-compatible</span>
</span><span id="__span-10-5"><a id="__codelineno-10-5" name="__codelineno-10-5" href="#__codelineno-10-5"></a><span class="s2">&quot;printf &#39;prompt &#39; &amp;&amp; read var&quot;</span>
</span></code></pre></div>
<div class="language-python highlight"><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a><span class="c1"># WRONG: Import hacks</span>
</span><span id="__span-11-2"><a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a><span class="kn">import</span><span class="w"> </span><span class="nn">sys</span><span class="p">;</span> <span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;../..&quot;</span><span class="p">)</span>
</span><span id="__span-11-3"><a id="__codelineno-11-3" name="__codelineno-11-3" href="#__codelineno-11-3"></a>
</span><span id="__span-11-4"><a id="__codelineno-11-4" name="__codelineno-11-4" href="#__codelineno-11-4"></a><span class="c1"># RIGHT: Proper packaging</span>
</span><span id="__span-11-5"><a id="__codelineno-11-5" name="__codelineno-11-5" href="#__codelineno-11-5"></a><span class="p">[</span><span class="n">project</span><span class="p">]</span>
</span><span id="__span-11-6"><a id="__codelineno-11-6" name="__codelineno-11-6" href="#__codelineno-11-6"></a><span class="n">dependencies</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;kgents-runtime&quot;</span><span class="p">]</span>
</span></code></pre></div>
<h3 id="pattern-sublate-dont-overwrite">Pattern: Sublate, Don't Overwrite</h3>
<div class="language-python highlight"><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a><span class="c1"># WRONG: Replaces defaults</span>
</span><span id="__span-12-2"><a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a><span class="n">config</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;config&quot;</span><span class="p">,</span> <span class="p">{})</span>
</span><span id="__span-12-3"><a id="__codelineno-12-3" name="__codelineno-12-3" href="#__codelineno-12-3"></a>
</span><span id="__span-12-4"><a id="__codelineno-12-4" name="__codelineno-12-4" href="#__codelineno-12-4"></a><span class="c1"># RIGHT: Merges with defaults</span>
</span><span id="__span-12-5"><a id="__codelineno-12-5" name="__codelineno-12-5" href="#__codelineno-12-5"></a><span class="n">config</span> <span class="o">=</span> <span class="p">{</span><span class="o">**</span><span class="n">defaults</span><span class="p">,</span> <span class="o">**</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;config&quot;</span><span class="p">,</span> <span class="p">{})}</span>
</span></code></pre></div>
<h3 id="pattern-events-are-sublate-traces">Pattern: Events are Sublate Traces</h3>
<div class="language-python highlight"><pre><span></span><code><span id="__span-13-1"><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a><span class="c1"># WRONG: Silent state change</span>
</span><span id="__span-13-2"><a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a><span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_items</span><span class="p">[</span><span class="nb">id</span><span class="p">]</span>
</span><span id="__span-13-3"><a id="__codelineno-13-3" name="__codelineno-13-3" href="#__codelineno-13-3"></a><span class="k">return</span> <span class="kc">True</span>
</span><span id="__span-13-4"><a id="__codelineno-13-4" name="__codelineno-13-4" href="#__codelineno-13-4"></a>
</span><span id="__span-13-5"><a id="__codelineno-13-5" name="__codelineno-13-5" href="#__codelineno-13-5"></a><span class="c1"># RIGHT: State changes emit events</span>
</span><span id="__span-13-6"><a id="__codelineno-13-6" name="__codelineno-13-6" href="#__codelineno-13-6"></a><span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_items</span><span class="p">[</span><span class="nb">id</span><span class="p">]</span>
</span><span id="__span-13-7"><a id="__codelineno-13-7" name="__codelineno-13-7" href="#__codelineno-13-7"></a><span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_emit_event</span><span class="p">(</span><span class="n">ItemRemoved</span><span class="p">(</span><span class="n">item_id</span><span class="o">=</span><span class="nb">id</span><span class="p">))</span>
</span><span id="__span-13-8"><a id="__codelineno-13-8" name="__codelineno-13-8" href="#__codelineno-13-8"></a><span class="k">return</span> <span class="kc">True</span>
</span></code></pre></div>
<h3 id="pattern-conflicts-are-data">Pattern: Conflicts are Data</h3>
<div class="language-python highlight"><pre><span></span><code><span id="__span-14-1"><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a><span class="c1"># WRONG: Silent exception swallowing</span>
</span><span id="__span-14-2"><a id="__codelineno-14-2" name="__codelineno-14-2" href="#__codelineno-14-2"></a><span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
</span><span id="__span-14-3"><a id="__codelineno-14-3" name="__codelineno-14-3" href="#__codelineno-14-3"></a>    <span class="k">pass</span>
</span><span id="__span-14-4"><a id="__codelineno-14-4" name="__codelineno-14-4" href="#__codelineno-14-4"></a>
</span><span id="__span-14-5"><a id="__codelineno-14-5" name="__codelineno-14-5" href="#__codelineno-14-5"></a><span class="c1"># RIGHT: Log conflicts</span>
</span><span id="__span-14-6"><a id="__codelineno-14-6" name="__codelineno-14-6" href="#__codelineno-14-6"></a><span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="__span-14-7"><a id="__codelineno-14-7" name="__codelineno-14-7" href="#__codelineno-14-7"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Conflict: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span></code></pre></div>
<h3 id="pattern-composable-layouts">Pattern: Composable Layouts</h3>
<div class="language-css highlight"><pre><span></span><code><span id="__span-15-1"><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a><span class="c">/* WRONG: Rigid */</span>
</span><span id="__span-15-2"><a id="__codelineno-15-2" name="__codelineno-15-2" href="#__codelineno-15-2"></a><span class="nt">height</span><span class="o">:</span><span class="w"> </span><span class="nt">30</span><span class="o">%</span>
</span><span id="__span-15-3"><a id="__codelineno-15-3" name="__codelineno-15-3" href="#__codelineno-15-3"></a>
</span><span id="__span-15-4"><a id="__codelineno-15-4" name="__codelineno-15-4" href="#__codelineno-15-4"></a><span class="c">/* RIGHT: Flexible with constraints */</span>
</span><span id="__span-15-5"><a id="__codelineno-15-5" name="__codelineno-15-5" href="#__codelineno-15-5"></a><span class="nt">height</span><span class="o">:</span><span class="w"> </span><span class="nt">1fr</span>
</span><span id="__span-15-6"><a id="__codelineno-15-6" name="__codelineno-15-6" href="#__codelineno-15-6"></a><span class="nt">min-height</span><span class="o">:</span><span class="w"> </span><span class="nt">8</span>
</span></code></pre></div>
<hr />
<h2 id="worked-example-implementing-the-id-agent">Worked Example: Implementing the Id Agent</h2>
<p>This section shows a complete spec-to-implementation walkthrough for the simplest bootstrap agent.</p>
<h3 id="step-1-read-the-spec">Step 1: Read the Spec</h3>
<p>From <code>spec/bootstrap.md</code> (lines 41-55):</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-16-1"><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a>### 1. Id (Identity)
</span><span id="__span-16-2"><a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a>
</span><span id="__span-16-3"><a id="__codelineno-16-3" name="__codelineno-16-3" href="#__codelineno-16-3"></a>Id: A → A
</span><span id="__span-16-4"><a id="__codelineno-16-4" name="__codelineno-16-4" href="#__codelineno-16-4"></a>Id(x) = x
</span><span id="__span-16-5"><a id="__codelineno-16-5" name="__codelineno-16-5" href="#__codelineno-16-5"></a>
</span><span id="__span-16-6"><a id="__codelineno-16-6" name="__codelineno-16-6" href="#__codelineno-16-6"></a>The agent that does nothing. Required by the category-theoretic structure:
</span><span id="__span-16-7"><a id="__codelineno-16-7" name="__codelineno-16-7" href="#__codelineno-16-7"></a>- Left identity: Id ∘ f = f
</span><span id="__span-16-8"><a id="__codelineno-16-8" name="__codelineno-16-8" href="#__codelineno-16-8"></a>- Right identity: f ∘ Id = f
</span><span id="__span-16-9"><a id="__codelineno-16-9" name="__codelineno-16-9" href="#__codelineno-16-9"></a>
</span><span id="__span-16-10"><a id="__codelineno-16-10" name="__codelineno-16-10" href="#__codelineno-16-10"></a>Why irreducible: You cannot define identity in terms of anything simpler.
</span><span id="__span-16-11"><a id="__codelineno-16-11" name="__codelineno-16-11" href="#__codelineno-16-11"></a>It is the unit of composition.
</span><span id="__span-16-12"><a id="__codelineno-16-12" name="__codelineno-16-12" href="#__codelineno-16-12"></a>
</span><span id="__span-16-13"><a id="__codelineno-16-13" name="__codelineno-16-13" href="#__codelineno-16-13"></a>What it grounds: The existence of agents as a category. Without Id, composition has no unit.
</span></code></pre></div>
<h3 id="step-2-extract-type-signature">Step 2: Extract Type Signature</h3>
<p><strong>From spec</strong>:
- Type: <code>A → A</code> (generic input type A, returns same type A)
- Law: <code>Id(x) = x</code> (identity function)
- Composition laws: Left identity (<code>Id ∘ f = f</code>), Right identity (<code>f ∘ Id = f</code>)</p>
<p><strong>Translation to Python</strong>:
<div class="language-python highlight"><pre><span></span><code><span id="__span-17-1"><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">Id</span><span class="p">(</span><span class="n">Agent</span><span class="p">[</span><span class="n">A</span><span class="p">,</span> <span class="n">A</span><span class="p">]):</span>
</span><span id="__span-17-2"><a id="__codelineno-17-2" name="__codelineno-17-2" href="#__codelineno-17-2"></a>    <span class="c1"># Agent[A, A] means: takes input of type A, returns output of type A</span>
</span></code></pre></div></p>
<h3 id="step-3-generate-implementation">Step 3: Generate Implementation</h3>
<p>Using the template pattern from <code>bootstrap/types.py</code>:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-18-1"><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-18-2"><a id="__codelineno-18-2" name="__codelineno-18-2" href="#__codelineno-18-2"></a><span class="sd">Id (Identity) - The agent that does nothing.</span>
</span><span id="__span-18-3"><a id="__codelineno-18-3" name="__codelineno-18-3" href="#__codelineno-18-3"></a>
</span><span id="__span-18-4"><a id="__codelineno-18-4" name="__codelineno-18-4" href="#__codelineno-18-4"></a><span class="sd">Type: A → A</span>
</span><span id="__span-18-5"><a id="__codelineno-18-5" name="__codelineno-18-5" href="#__codelineno-18-5"></a><span class="sd">Law: Id(x) = x</span>
</span><span id="__span-18-6"><a id="__codelineno-18-6" name="__codelineno-18-6" href="#__codelineno-18-6"></a>
</span><span id="__span-18-7"><a id="__codelineno-18-7" name="__codelineno-18-7" href="#__codelineno-18-7"></a><span class="sd">The composition unit. Required by category-theoretic structure:</span>
</span><span id="__span-18-8"><a id="__codelineno-18-8" name="__codelineno-18-8" href="#__codelineno-18-8"></a><span class="sd">- Left identity:  Id ∘ f = f</span>
</span><span id="__span-18-9"><a id="__codelineno-18-9" name="__codelineno-18-9" href="#__codelineno-18-9"></a><span class="sd">- Right identity: f ∘ Id = f</span>
</span><span id="__span-18-10"><a id="__codelineno-18-10" name="__codelineno-18-10" href="#__codelineno-18-10"></a><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-18-11"><a id="__codelineno-18-11" name="__codelineno-18-11" href="#__codelineno-18-11"></a>
</span><span id="__span-18-12"><a id="__codelineno-18-12" name="__codelineno-18-12" href="#__codelineno-18-12"></a><span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">TypeVar</span><span class="p">,</span> <span class="n">Any</span>
</span><span id="__span-18-13"><a id="__codelineno-18-13" name="__codelineno-18-13" href="#__codelineno-18-13"></a><span class="kn">from</span><span class="w"> </span><span class="nn">.types</span><span class="w"> </span><span class="kn">import</span> <span class="n">Agent</span>
</span><span id="__span-18-14"><a id="__codelineno-18-14" name="__codelineno-18-14" href="#__codelineno-18-14"></a>
</span><span id="__span-18-15"><a id="__codelineno-18-15" name="__codelineno-18-15" href="#__codelineno-18-15"></a><span class="n">A</span> <span class="o">=</span> <span class="n">TypeVar</span><span class="p">(</span><span class="s2">&quot;A&quot;</span><span class="p">)</span>
</span><span id="__span-18-16"><a id="__codelineno-18-16" name="__codelineno-18-16" href="#__codelineno-18-16"></a>
</span><span id="__span-18-17"><a id="__codelineno-18-17" name="__codelineno-18-17" href="#__codelineno-18-17"></a>
</span><span id="__span-18-18"><a id="__codelineno-18-18" name="__codelineno-18-18" href="#__codelineno-18-18"></a><span class="k">class</span><span class="w"> </span><span class="nc">Id</span><span class="p">(</span><span class="n">Agent</span><span class="p">[</span><span class="n">A</span><span class="p">,</span> <span class="n">A</span><span class="p">]):</span>
</span><span id="__span-18-19"><a id="__codelineno-18-19" name="__codelineno-18-19" href="#__codelineno-18-19"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-18-20"><a id="__codelineno-18-20" name="__codelineno-18-20" href="#__codelineno-18-20"></a><span class="sd">    Identity agent: λx.x</span>
</span><span id="__span-18-21"><a id="__codelineno-18-21" name="__codelineno-18-21" href="#__codelineno-18-21"></a>
</span><span id="__span-18-22"><a id="__codelineno-18-22" name="__codelineno-18-22" href="#__codelineno-18-22"></a><span class="sd">    Usage:</span>
</span><span id="__span-18-23"><a id="__codelineno-18-23" name="__codelineno-18-23" href="#__codelineno-18-23"></a><span class="sd">        id_agent = Id()</span>
</span><span id="__span-18-24"><a id="__codelineno-18-24" name="__codelineno-18-24" href="#__codelineno-18-24"></a><span class="sd">        result = await id_agent.invoke(x)  # result == x</span>
</span><span id="__span-18-25"><a id="__codelineno-18-25" name="__codelineno-18-25" href="#__codelineno-18-25"></a>
</span><span id="__span-18-26"><a id="__codelineno-18-26" name="__codelineno-18-26" href="#__codelineno-18-26"></a><span class="sd">    Composition:</span>
</span><span id="__span-18-27"><a id="__codelineno-18-27" name="__codelineno-18-27" href="#__codelineno-18-27"></a><span class="sd">        Id() &gt;&gt; SomeAgent == SomeAgent  # Right identity</span>
</span><span id="__span-18-28"><a id="__codelineno-18-28" name="__codelineno-18-28" href="#__codelineno-18-28"></a><span class="sd">        SomeAgent &gt;&gt; Id() == SomeAgent  # Left identity</span>
</span><span id="__span-18-29"><a id="__codelineno-18-29" name="__codelineno-18-29" href="#__codelineno-18-29"></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-18-30"><a id="__codelineno-18-30" name="__codelineno-18-30" href="#__codelineno-18-30"></a>
</span><span id="__span-18-31"><a id="__codelineno-18-31" name="__codelineno-18-31" href="#__codelineno-18-31"></a>    <span class="nd">@property</span>
</span><span id="__span-18-32"><a id="__codelineno-18-32" name="__codelineno-18-32" href="#__codelineno-18-32"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">name</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="__span-18-33"><a id="__codelineno-18-33" name="__codelineno-18-33" href="#__codelineno-18-33"></a>        <span class="k">return</span> <span class="s2">&quot;Id&quot;</span>
</span><span id="__span-18-34"><a id="__codelineno-18-34" name="__codelineno-18-34" href="#__codelineno-18-34"></a>
</span><span id="__span-18-35"><a id="__codelineno-18-35" name="__codelineno-18-35" href="#__codelineno-18-35"></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">invoke</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">input</span><span class="p">:</span> <span class="n">A</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">A</span><span class="p">:</span>
</span><span id="__span-18-36"><a id="__codelineno-18-36" name="__codelineno-18-36" href="#__codelineno-18-36"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Identity: returns input unchanged.&quot;&quot;&quot;</span>
</span><span id="__span-18-37"><a id="__codelineno-18-37" name="__codelineno-18-37" href="#__codelineno-18-37"></a>        <span class="c1"># Runtime verification that we truly return the same object</span>
</span><span id="__span-18-38"><a id="__codelineno-18-38" name="__codelineno-18-38" href="#__codelineno-18-38"></a>        <span class="n">result</span> <span class="o">=</span> <span class="nb">input</span>
</span><span id="__span-18-39"><a id="__codelineno-18-39" name="__codelineno-18-39" href="#__codelineno-18-39"></a>        <span class="k">if</span> <span class="n">result</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">input</span><span class="p">:</span>
</span><span id="__span-18-40"><a id="__codelineno-18-40" name="__codelineno-18-40" href="#__codelineno-18-40"></a>            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
</span><span id="__span-18-41"><a id="__codelineno-18-41" name="__codelineno-18-41" href="#__codelineno-18-41"></a>                <span class="sa">f</span><span class="s2">&quot;Id agent violated identity law: input is not result (id mismatch)&quot;</span>
</span><span id="__span-18-42"><a id="__codelineno-18-42" name="__codelineno-18-42" href="#__codelineno-18-42"></a>            <span class="p">)</span>
</span><span id="__span-18-43"><a id="__codelineno-18-43" name="__codelineno-18-43" href="#__codelineno-18-43"></a>        <span class="k">return</span> <span class="n">result</span>
</span><span id="__span-18-44"><a id="__codelineno-18-44" name="__codelineno-18-44" href="#__codelineno-18-44"></a>
</span><span id="__span-18-45"><a id="__codelineno-18-45" name="__codelineno-18-45" href="#__codelineno-18-45"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__rshift__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="s2">&quot;Agent[A, Any]&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Agent[A, Any]&quot;</span><span class="p">:</span>
</span><span id="__span-18-46"><a id="__codelineno-18-46" name="__codelineno-18-46" href="#__codelineno-18-46"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Right identity law: Id &gt;&gt; f = f&quot;&quot;&quot;</span>
</span><span id="__span-18-47"><a id="__codelineno-18-47" name="__codelineno-18-47" href="#__codelineno-18-47"></a>        <span class="c1"># Optimization: composing with Id on the left is just the other agent</span>
</span><span id="__span-18-48"><a id="__codelineno-18-48" name="__codelineno-18-48" href="#__codelineno-18-48"></a>        <span class="k">return</span> <span class="n">other</span>
</span><span id="__span-18-49"><a id="__codelineno-18-49" name="__codelineno-18-49" href="#__codelineno-18-49"></a>
</span><span id="__span-18-50"><a id="__codelineno-18-50" name="__codelineno-18-50" href="#__codelineno-18-50"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="__span-18-51"><a id="__codelineno-18-51" name="__codelineno-18-51" href="#__codelineno-18-51"></a>        <span class="k">return</span> <span class="s2">&quot;Id()&quot;</span>
</span></code></pre></div>
<h3 id="step-4-verify-composition-laws">Step 4: Verify Composition Laws</h3>
<p>The implementation ensures the category laws:</p>
<p><strong>Right identity (<code>Id &gt;&gt; f = f</code>)</strong>:
<div class="language-python highlight"><pre><span></span><code><span id="__span-19-1"><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a><span class="k">def</span><span class="w"> </span><span class="fm">__rshift__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
</span><span id="__span-19-2"><a id="__codelineno-19-2" name="__codelineno-19-2" href="#__codelineno-19-2"></a>    <span class="k">return</span> <span class="n">other</span>  <span class="c1"># Id &gt;&gt; f just returns f</span>
</span></code></pre></div></p>
<p><strong>Left identity (<code>f &gt;&gt; Id = f</code>)</strong>:
This is handled by the general composition operator in <code>Agent.__rshift__</code>, but the <code>invoke</code> method ensures that <code>Id(x) = x</code>, so <code>f(x) &gt;&gt; Id</code> will always equal <code>f(x)</code>.</p>
<p><strong>Associativity</strong>: Inherited from <code>&gt;&gt;</code> operator composition.</p>
<h3 id="step-5-judge-against-principles">Step 5: Judge Against Principles</h3>
<p><strong>Tasteful</strong>: ✓ Minimal, no unnecessary code
<strong>Curated</strong>: ✓ Irreducible primitive, cannot be simpler
<strong>Ethical</strong>: ✓ Transparent identity function
<strong>Joyful</strong>: ✓ Clean implementation of mathematical concept
<strong>Composable</strong>: ✓ Explicitly designed as composition unit
<strong>Generative</strong>: ✓ Can be regenerated from spec
<strong>Heterarchical</strong>: ✓ No hidden control flow</p>
<p><strong>Verdict</strong>: ACCEPT</p>
<h3 id="key-takeaways">Key Takeaways</h3>
<ol>
<li><strong>Module docstring</strong> mirrors spec language (type signature, laws, purpose)</li>
<li><strong>Class docstring</strong> adds usage examples and composition behavior</li>
<li><strong>Type parameter</strong> <code>A = TypeVar("A")</code> for generic input/output</li>
<li><strong>Runtime verification</strong> optional but demonstrates law compliance</li>
<li><strong>Optimization</strong> in <code>__rshift__</code> leverages identity law for performance</li>
<li><strong>Minimal</strong> - only what's required by the spec, nothing more</li>
</ol>
<p>This pattern applies to all bootstrap agents: Read spec → Extract types → Translate mechanically → Verify laws → Judge.</p>
<hr />
<h2 id="agent-implementation-template">Agent Implementation Template</h2>
<p>Use this template for implementing any new agent. Fill in the blanks based on the spec.</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-20-1"><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-20-2"><a id="__codelineno-20-2" name="__codelineno-20-2" href="#__codelineno-20-2"></a><span class="sd">[AgentName] - [One-line description from spec]</span>
</span><span id="__span-20-3"><a id="__codelineno-20-3" name="__codelineno-20-3" href="#__codelineno-20-3"></a>
</span><span id="__span-20-4"><a id="__codelineno-20-4" name="__codelineno-20-4" href="#__codelineno-20-4"></a><span class="sd">Type: [Input] → [Output]</span>
</span><span id="__span-20-5"><a id="__codelineno-20-5" name="__codelineno-20-5" href="#__codelineno-20-5"></a><span class="sd">[Key laws or properties from spec]</span>
</span><span id="__span-20-6"><a id="__codelineno-20-6" name="__codelineno-20-6" href="#__codelineno-20-6"></a>
</span><span id="__span-20-7"><a id="__codelineno-20-7" name="__codelineno-20-7" href="#__codelineno-20-7"></a><span class="sd">[Purpose and why it&#39;s needed from spec]</span>
</span><span id="__span-20-8"><a id="__codelineno-20-8" name="__codelineno-20-8" href="#__codelineno-20-8"></a><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-20-9"><a id="__codelineno-20-9" name="__codelineno-20-9" href="#__codelineno-20-9"></a>
</span><span id="__span-20-10"><a id="__codelineno-20-10" name="__codelineno-20-10" href="#__codelineno-20-10"></a><span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">TypeVar</span>
</span><span id="__span-20-11"><a id="__codelineno-20-11" name="__codelineno-20-11" href="#__codelineno-20-11"></a><span class="kn">from</span><span class="w"> </span><span class="nn">.types</span><span class="w"> </span><span class="kn">import</span> <span class="n">Agent</span>
</span><span id="__span-20-12"><a id="__codelineno-20-12" name="__codelineno-20-12" href="#__codelineno-20-12"></a>
</span><span id="__span-20-13"><a id="__codelineno-20-13" name="__codelineno-20-13" href="#__codelineno-20-13"></a><span class="c1"># Type variables (adjust as needed)</span>
</span><span id="__span-20-14"><a id="__codelineno-20-14" name="__codelineno-20-14" href="#__codelineno-20-14"></a><span class="n">A</span> <span class="o">=</span> <span class="n">TypeVar</span><span class="p">(</span><span class="s2">&quot;A&quot;</span><span class="p">)</span>  <span class="c1"># Input type</span>
</span><span id="__span-20-15"><a id="__codelineno-20-15" name="__codelineno-20-15" href="#__codelineno-20-15"></a><span class="n">B</span> <span class="o">=</span> <span class="n">TypeVar</span><span class="p">(</span><span class="s2">&quot;B&quot;</span><span class="p">)</span>  <span class="c1"># Output type</span>
</span><span id="__span-20-16"><a id="__codelineno-20-16" name="__codelineno-20-16" href="#__codelineno-20-16"></a>
</span><span id="__span-20-17"><a id="__codelineno-20-17" name="__codelineno-20-17" href="#__codelineno-20-17"></a>
</span><span id="__span-20-18"><a id="__codelineno-20-18" name="__codelineno-20-18" href="#__codelineno-20-18"></a><span class="k">class</span><span class="w"> </span><span class="err">[</span><span class="nc">AgentName</span><span class="p">](</span><span class="n">Agent</span><span class="p">[</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">]):</span>
</span><span id="__span-20-19"><a id="__codelineno-20-19" name="__codelineno-20-19" href="#__codelineno-20-19"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-20-20"><a id="__codelineno-20-20" name="__codelineno-20-20" href="#__codelineno-20-20"></a><span class="sd">    [Detailed description]</span>
</span><span id="__span-20-21"><a id="__codelineno-20-21" name="__codelineno-20-21" href="#__codelineno-20-21"></a>
</span><span id="__span-20-22"><a id="__codelineno-20-22" name="__codelineno-20-22" href="#__codelineno-20-22"></a><span class="sd">    Usage:</span>
</span><span id="__span-20-23"><a id="__codelineno-20-23" name="__codelineno-20-23" href="#__codelineno-20-23"></a><span class="sd">        agent = [AgentName]([constructor args if any])</span>
</span><span id="__span-20-24"><a id="__codelineno-20-24" name="__codelineno-20-24" href="#__codelineno-20-24"></a><span class="sd">        result = await agent.invoke(input_data)</span>
</span><span id="__span-20-25"><a id="__codelineno-20-25" name="__codelineno-20-25" href="#__codelineno-20-25"></a>
</span><span id="__span-20-26"><a id="__codelineno-20-26" name="__codelineno-20-26" href="#__codelineno-20-26"></a><span class="sd">    Composition:</span>
</span><span id="__span-20-27"><a id="__codelineno-20-27" name="__codelineno-20-27" href="#__codelineno-20-27"></a><span class="sd">        [Example of composing with other agents if relevant]</span>
</span><span id="__span-20-28"><a id="__codelineno-20-28" name="__codelineno-20-28" href="#__codelineno-20-28"></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-20-29"><a id="__codelineno-20-29" name="__codelineno-20-29" href="#__codelineno-20-29"></a>
</span><span id="__span-20-30"><a id="__codelineno-20-30" name="__codelineno-20-30" href="#__codelineno-20-30"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="p">[</span><span class="n">constructor</span> <span class="n">parameters</span> <span class="k">if</span> <span class="n">needed</span><span class="p">]):</span>
</span><span id="__span-20-31"><a id="__codelineno-20-31" name="__codelineno-20-31" href="#__codelineno-20-31"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-20-32"><a id="__codelineno-20-32" name="__codelineno-20-32" href="#__codelineno-20-32"></a><span class="sd">        Initialize [AgentName].</span>
</span><span id="__span-20-33"><a id="__codelineno-20-33" name="__codelineno-20-33" href="#__codelineno-20-33"></a>
</span><span id="__span-20-34"><a id="__codelineno-20-34" name="__codelineno-20-34" href="#__codelineno-20-34"></a><span class="sd">        Args:</span>
</span><span id="__span-20-35"><a id="__codelineno-20-35" name="__codelineno-20-35" href="#__codelineno-20-35"></a><span class="sd">            [parameter]: [description]</span>
</span><span id="__span-20-36"><a id="__codelineno-20-36" name="__codelineno-20-36" href="#__codelineno-20-36"></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="__span-20-37"><a id="__codelineno-20-37" name="__codelineno-20-37" href="#__codelineno-20-37"></a>        <span class="c1"># Initialize state if needed</span>
</span><span id="__span-20-38"><a id="__codelineno-20-38" name="__codelineno-20-38" href="#__codelineno-20-38"></a>        <span class="k">pass</span>
</span><span id="__span-20-39"><a id="__codelineno-20-39" name="__codelineno-20-39" href="#__codelineno-20-39"></a>
</span><span id="__span-20-40"><a id="__codelineno-20-40" name="__codelineno-20-40" href="#__codelineno-20-40"></a>    <span class="nd">@property</span>
</span><span id="__span-20-41"><a id="__codelineno-20-41" name="__codelineno-20-41" href="#__codelineno-20-41"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">name</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="__span-20-42"><a id="__codelineno-20-42" name="__codelineno-20-42" href="#__codelineno-20-42"></a>        <span class="k">return</span> <span class="s2">&quot;[AgentName]&quot;</span>
</span><span id="__span-20-43"><a id="__codelineno-20-43" name="__codelineno-20-43" href="#__codelineno-20-43"></a>
</span><span id="__span-20-44"><a id="__codelineno-20-44" name="__codelineno-20-44" href="#__codelineno-20-44"></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">invoke</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">input</span><span class="p">:</span> <span class="n">A</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">B</span><span class="p">:</span>
</span><span id="__span-20-45"><a id="__codelineno-20-45" name="__codelineno-20-45" href="#__codelineno-20-45"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-20-46"><a id="__codelineno-20-46" name="__codelineno-20-46" href="#__codelineno-20-46"></a><span class="sd">        [Brief description of transformation]</span>
</span><span id="__span-20-47"><a id="__codelineno-20-47" name="__codelineno-20-47" href="#__codelineno-20-47"></a>
</span><span id="__span-20-48"><a id="__codelineno-20-48" name="__codelineno-20-48" href="#__codelineno-20-48"></a><span class="sd">        Args:</span>
</span><span id="__span-20-49"><a id="__codelineno-20-49" name="__codelineno-20-49" href="#__codelineno-20-49"></a><span class="sd">            input: [Description of input type and meaning]</span>
</span><span id="__span-20-50"><a id="__codelineno-20-50" name="__codelineno-20-50" href="#__codelineno-20-50"></a>
</span><span id="__span-20-51"><a id="__codelineno-20-51" name="__codelineno-20-51" href="#__codelineno-20-51"></a><span class="sd">        Returns:</span>
</span><span id="__span-20-52"><a id="__codelineno-20-52" name="__codelineno-20-52" href="#__codelineno-20-52"></a><span class="sd">            [Description of output type and meaning]</span>
</span><span id="__span-20-53"><a id="__codelineno-20-53" name="__codelineno-20-53" href="#__codelineno-20-53"></a>
</span><span id="__span-20-54"><a id="__codelineno-20-54" name="__codelineno-20-54" href="#__codelineno-20-54"></a><span class="sd">        Raises:</span>
</span><span id="__span-20-55"><a id="__codelineno-20-55" name="__codelineno-20-55" href="#__codelineno-20-55"></a><span class="sd">            [Any expected exceptions]</span>
</span><span id="__span-20-56"><a id="__codelineno-20-56" name="__codelineno-20-56" href="#__codelineno-20-56"></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="__span-20-57"><a id="__codelineno-20-57" name="__codelineno-20-57" href="#__codelineno-20-57"></a>        <span class="c1"># Step 1: [First transformation step]</span>
</span><span id="__span-20-58"><a id="__codelineno-20-58" name="__codelineno-20-58" href="#__codelineno-20-58"></a>        <span class="c1"># Step 2: [Second transformation step]</span>
</span><span id="__span-20-59"><a id="__codelineno-20-59" name="__codelineno-20-59" href="#__codelineno-20-59"></a>        <span class="c1"># Step 3: Return result</span>
</span><span id="__span-20-60"><a id="__codelineno-20-60" name="__codelineno-20-60" href="#__codelineno-20-60"></a>
</span><span id="__span-20-61"><a id="__codelineno-20-61" name="__codelineno-20-61" href="#__codelineno-20-61"></a>        <span class="n">result</span><span class="p">:</span> <span class="n">B</span> <span class="o">=</span> <span class="o">...</span>  <span class="c1"># Implementation here</span>
</span><span id="__span-20-62"><a id="__codelineno-20-62" name="__codelineno-20-62" href="#__codelineno-20-62"></a>        <span class="k">return</span> <span class="n">result</span>
</span><span id="__span-20-63"><a id="__codelineno-20-63" name="__codelineno-20-63" href="#__codelineno-20-63"></a>
</span><span id="__span-20-64"><a id="__codelineno-20-64" name="__codelineno-20-64" href="#__codelineno-20-64"></a>    <span class="c1"># Optional: Override composition if special behavior needed</span>
</span><span id="__span-20-65"><a id="__codelineno-20-65" name="__codelineno-20-65" href="#__codelineno-20-65"></a>    <span class="c1"># def __rshift__(self, other: &quot;Agent[B, C]&quot;) -&gt; &quot;Agent[A, C]&quot;:</span>
</span><span id="__span-20-66"><a id="__codelineno-20-66" name="__codelineno-20-66" href="#__codelineno-20-66"></a>    <span class="c1">#     &quot;&quot;&quot;Special composition behavior if needed.&quot;&quot;&quot;</span>
</span><span id="__span-20-67"><a id="__codelineno-20-67" name="__codelineno-20-67" href="#__codelineno-20-67"></a>    <span class="c1">#     return ...</span>
</span><span id="__span-20-68"><a id="__codelineno-20-68" name="__codelineno-20-68" href="#__codelineno-20-68"></a>
</span><span id="__span-20-69"><a id="__codelineno-20-69" name="__codelineno-20-69" href="#__codelineno-20-69"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="__span-20-70"><a id="__codelineno-20-70" name="__codelineno-20-70" href="#__codelineno-20-70"></a>        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;[AgentName]([repr of key params])&quot;</span>
</span><span id="__span-20-71"><a id="__codelineno-20-71" name="__codelineno-20-71" href="#__codelineno-20-71"></a>
</span><span id="__span-20-72"><a id="__codelineno-20-72" name="__codelineno-20-72" href="#__codelineno-20-72"></a>
</span><span id="__span-20-73"><a id="__codelineno-20-73" name="__codelineno-20-73" href="#__codelineno-20-73"></a><span class="c1"># Optional: Convenience constructor functions</span>
</span><span id="__span-20-74"><a id="__codelineno-20-74" name="__codelineno-20-74" href="#__codelineno-20-74"></a><span class="k">def</span><span class="w"> </span><span class="p">[</span><span class="n">agent_name_lowercase</span><span class="p">]([</span><span class="n">parameters</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="p">[</span><span class="n">AgentName</span><span class="p">]:</span>
</span><span id="__span-20-75"><a id="__codelineno-20-75" name="__codelineno-20-75" href="#__codelineno-20-75"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-20-76"><a id="__codelineno-20-76" name="__codelineno-20-76" href="#__codelineno-20-76"></a><span class="sd">    Create [AgentName] with [specific configuration].</span>
</span><span id="__span-20-77"><a id="__codelineno-20-77" name="__codelineno-20-77" href="#__codelineno-20-77"></a>
</span><span id="__span-20-78"><a id="__codelineno-20-78" name="__codelineno-20-78" href="#__codelineno-20-78"></a><span class="sd">    This is the default/recommended constructor.</span>
</span><span id="__span-20-79"><a id="__codelineno-20-79" name="__codelineno-20-79" href="#__codelineno-20-79"></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-20-80"><a id="__codelineno-20-80" name="__codelineno-20-80" href="#__codelineno-20-80"></a>    <span class="k">return</span> <span class="p">[</span><span class="n">AgentName</span><span class="p">]([</span><span class="n">parameters</span><span class="p">])</span>
</span></code></pre></div>
<h3 id="template-usage-checklist">Template Usage Checklist</h3>
<p>Before implementing a new agent, ensure:</p>
<ul class="task-list">
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled/><span class="task-list-indicator"></span></label> <strong>Read the spec completely</strong> - understand purpose, laws, examples</li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled/><span class="task-list-indicator"></span></label> <strong>Extract type signature</strong> - what are input and output types?</li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled/><span class="task-list-indicator"></span></label> <strong>Identify laws/properties</strong> - what invariants must hold?</li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled/><span class="task-list-indicator"></span></label> <strong>Check for composition patterns</strong> - does this compose with existing agents?</li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled/><span class="task-list-indicator"></span></label> <strong>Consider state</strong> - does the agent need internal state? (Usually no for pure agents)</li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled/><span class="task-list-indicator"></span></label> <strong>Write module docstring</strong> - copy key content from spec</li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled/><span class="task-list-indicator"></span></label> <strong>Write class docstring</strong> - add usage examples</li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled/><span class="task-list-indicator"></span></label> <strong>Implement invoke</strong> - mechanical translation of spec logic</li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled/><span class="task-list-indicator"></span></label> <strong>Add <strong>repr</strong></strong> - for debugging and introspection</li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled/><span class="task-list-indicator"></span></label> <strong>Consider convenience constructors</strong> - make common cases easy</li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled/><span class="task-list-indicator"></span></label> <strong>Verify against spec</strong> - does <code>Contradict(impl, spec)</code> return <code>None</code>?</li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled/><span class="task-list-indicator"></span></label> <strong>Judge against principles</strong> - does it pass all 7 principles?</li>
</ul>
<h3 id="example-minimal-agent-passthrough">Example: Minimal Agent (PassThrough)</h3>
<div class="language-python highlight"><pre><span></span><code><span id="__span-21-1"><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a><span class="sd">&quot;&quot;&quot;PassThrough - Returns input with logging.&quot;&quot;&quot;</span>
</span><span id="__span-21-2"><a id="__codelineno-21-2" name="__codelineno-21-2" href="#__codelineno-21-2"></a>
</span><span id="__span-21-3"><a id="__codelineno-21-3" name="__codelineno-21-3" href="#__codelineno-21-3"></a><span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">TypeVar</span>
</span><span id="__span-21-4"><a id="__codelineno-21-4" name="__codelineno-21-4" href="#__codelineno-21-4"></a><span class="kn">from</span><span class="w"> </span><span class="nn">.types</span><span class="w"> </span><span class="kn">import</span> <span class="n">Agent</span>
</span><span id="__span-21-5"><a id="__codelineno-21-5" name="__codelineno-21-5" href="#__codelineno-21-5"></a>
</span><span id="__span-21-6"><a id="__codelineno-21-6" name="__codelineno-21-6" href="#__codelineno-21-6"></a><span class="n">A</span> <span class="o">=</span> <span class="n">TypeVar</span><span class="p">(</span><span class="s2">&quot;A&quot;</span><span class="p">)</span>
</span><span id="__span-21-7"><a id="__codelineno-21-7" name="__codelineno-21-7" href="#__codelineno-21-7"></a>
</span><span id="__span-21-8"><a id="__codelineno-21-8" name="__codelineno-21-8" href="#__codelineno-21-8"></a><span class="k">class</span><span class="w"> </span><span class="nc">PassThrough</span><span class="p">(</span><span class="n">Agent</span><span class="p">[</span><span class="n">A</span><span class="p">,</span> <span class="n">A</span><span class="p">]):</span>
</span><span id="__span-21-9"><a id="__codelineno-21-9" name="__codelineno-21-9" href="#__codelineno-21-9"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Identity with side effect (logging).&quot;&quot;&quot;</span>
</span><span id="__span-21-10"><a id="__codelineno-21-10" name="__codelineno-21-10" href="#__codelineno-21-10"></a>
</span><span id="__span-21-11"><a id="__codelineno-21-11" name="__codelineno-21-11" href="#__codelineno-21-11"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">label</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;PassThrough&quot;</span><span class="p">):</span>
</span><span id="__span-21-12"><a id="__codelineno-21-12" name="__codelineno-21-12" href="#__codelineno-21-12"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">label</span> <span class="o">=</span> <span class="n">label</span>
</span><span id="__span-21-13"><a id="__codelineno-21-13" name="__codelineno-21-13" href="#__codelineno-21-13"></a>
</span><span id="__span-21-14"><a id="__codelineno-21-14" name="__codelineno-21-14" href="#__codelineno-21-14"></a>    <span class="nd">@property</span>
</span><span id="__span-21-15"><a id="__codelineno-21-15" name="__codelineno-21-15" href="#__codelineno-21-15"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">name</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="__span-21-16"><a id="__codelineno-21-16" name="__codelineno-21-16" href="#__codelineno-21-16"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">label</span>
</span><span id="__span-21-17"><a id="__codelineno-21-17" name="__codelineno-21-17" href="#__codelineno-21-17"></a>
</span><span id="__span-21-18"><a id="__codelineno-21-18" name="__codelineno-21-18" href="#__codelineno-21-18"></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">invoke</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">input</span><span class="p">:</span> <span class="n">A</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">A</span><span class="p">:</span>
</span><span id="__span-21-19"><a id="__codelineno-21-19" name="__codelineno-21-19" href="#__codelineno-21-19"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Log and return input unchanged.&quot;&quot;&quot;</span>
</span><span id="__span-21-20"><a id="__codelineno-21-20" name="__codelineno-21-20" href="#__codelineno-21-20"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">label</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="nb">input</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="__span-21-21"><a id="__codelineno-21-21" name="__codelineno-21-21" href="#__codelineno-21-21"></a>        <span class="k">return</span> <span class="nb">input</span>
</span><span id="__span-21-22"><a id="__codelineno-21-22" name="__codelineno-21-22" href="#__codelineno-21-22"></a>
</span><span id="__span-21-23"><a id="__codelineno-21-23" name="__codelineno-21-23" href="#__codelineno-21-23"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="__span-21-24"><a id="__codelineno-21-24" name="__codelineno-21-24" href="#__codelineno-21-24"></a>        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;PassThrough(&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">label</span><span class="si">}</span><span class="s2">&#39;)&quot;</span>
</span></code></pre></div>
<p>This minimal example shows the core structure. Real agents will have more complex logic in <code>invoke</code>, but the structure remains the same.</p>
<hr />
<h2 id="applied-idioms">Applied Idioms</h2>
<h3 id="idiom-1-polling-is-fix">Idiom 1: Polling is Fix</h3>
<div class="language-python highlight"><pre><span></span><code><span id="__span-22-1"><a id="__codelineno-22-1" name="__codelineno-22-1" href="#__codelineno-22-1"></a><span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="n">fix</span><span class="p">(</span>
</span><span id="__span-22-2"><a id="__codelineno-22-2" name="__codelineno-22-2" href="#__codelineno-22-2"></a>    <span class="n">transform</span><span class="o">=</span><span class="n">poll_and_detect</span><span class="p">,</span>
</span><span id="__span-22-3"><a id="__codelineno-22-3" name="__codelineno-22-3" href="#__codelineno-22-3"></a>    <span class="n">initial</span><span class="o">=</span><span class="n">DetectionState</span><span class="p">(</span><span class="n">RUNNING</span><span class="p">,</span> <span class="n">confidence</span><span class="o">=</span><span class="mf">0.0</span><span class="p">),</span>
</span><span id="__span-22-4"><a id="__codelineno-22-4" name="__codelineno-22-4" href="#__codelineno-22-4"></a>    <span class="n">equality_check</span><span class="o">=</span><span class="k">lambda</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="n">a</span><span class="o">.</span><span class="n">state</span> <span class="o">==</span> <span class="n">b</span><span class="o">.</span><span class="n">state</span> <span class="ow">and</span> <span class="n">b</span><span class="o">.</span><span class="n">confidence</span> <span class="o">&gt;=</span> <span class="mf">0.8</span>
</span><span id="__span-22-5"><a id="__codelineno-22-5" name="__codelineno-22-5" href="#__codelineno-22-5"></a><span class="p">)</span>
</span></code></pre></div>
<p>Anti-pattern: <code>while True</code> with inline break conditions.</p>
<h3 id="idiom-2-conflict-is-data">Idiom 2: Conflict is Data</h3>
<div class="language-python highlight"><pre><span></span><code><span id="__span-23-1"><a id="__codelineno-23-1" name="__codelineno-23-1" href="#__codelineno-23-1"></a><span class="n">conflicts</span> <span class="o">=</span> <span class="n">contradict</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">ground_state</span><span class="p">)</span>
</span><span id="__span-23-2"><a id="__codelineno-23-2" name="__codelineno-23-2" href="#__codelineno-23-2"></a><span class="k">if</span> <span class="n">conflicts</span><span class="p">:</span>
</span><span id="__span-23-3"><a id="__codelineno-23-3" name="__codelineno-23-3" href="#__codelineno-23-3"></a>    <span class="n">resolution</span> <span class="o">=</span> <span class="n">sublate</span><span class="p">(</span><span class="n">conflicts</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span></code></pre></div>
<p>Anti-pattern: Silent failures, swallowed exceptions.</p>
<h3 id="idiom-3-compose-dont-concatenate">Idiom 3: Compose, Don't Concatenate</h3>
<div class="language-python highlight"><pre><span></span><code><span id="__span-24-1"><a id="__codelineno-24-1" name="__codelineno-24-1" href="#__codelineno-24-1"></a><span class="n">Pipeline</span> <span class="o">=</span> <span class="n">Judge</span><span class="p">(</span><span class="n">config</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="n">Create</span><span class="p">(</span><span class="n">config</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="n">Spawn</span><span class="p">(</span><span class="n">session</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="n">Detect</span><span class="p">(</span><span class="n">session</span><span class="p">)</span>
</span></code></pre></div>
<p>Anti-pattern: 130-line methods mixing validation, I/O, state, errors.</p>
<h3 id="idiom-4-error-handling-with-result-types">Idiom 4: Error Handling with Result Types</h3>
<p>When to use exceptions vs Result types:</p>
<p><strong>Use Result[A, E] for</strong>:
- Expected failures (validation, parsing, network errors)
- Composable error propagation
- When errors are part of the domain model</p>
<p><strong>Use exceptions for</strong>:
- Programming errors (assertions, type errors)
- Truly exceptional conditions (out of memory, system failures)
- When immediate termination is desired</p>
<p><strong>Pattern: Result type composition</strong></p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-25-1"><a id="__codelineno-25-1" name="__codelineno-25-1" href="#__codelineno-25-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">bootstrap.types</span><span class="w"> </span><span class="kn">import</span> <span class="n">Result</span><span class="p">,</span> <span class="n">Ok</span><span class="p">,</span> <span class="n">Err</span>
</span><span id="__span-25-2"><a id="__codelineno-25-2" name="__codelineno-25-2" href="#__codelineno-25-2"></a>
</span><span id="__span-25-3"><a id="__codelineno-25-3" name="__codelineno-25-3" href="#__codelineno-25-3"></a><span class="c1"># Agent that may fail</span>
</span><span id="__span-25-4"><a id="__codelineno-25-4" name="__codelineno-25-4" href="#__codelineno-25-4"></a><span class="k">class</span><span class="w"> </span><span class="nc">ParseConfig</span><span class="p">(</span><span class="n">Agent</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Result</span><span class="p">[</span><span class="n">Config</span><span class="p">,</span> <span class="n">ConfigError</span><span class="p">]]):</span>
</span><span id="__span-25-5"><a id="__codelineno-25-5" name="__codelineno-25-5" href="#__codelineno-25-5"></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">invoke</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">input</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Result</span><span class="p">[</span><span class="n">Config</span><span class="p">,</span> <span class="n">ConfigError</span><span class="p">]:</span>
</span><span id="__span-25-6"><a id="__codelineno-25-6" name="__codelineno-25-6" href="#__codelineno-25-6"></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="__span-25-7"><a id="__codelineno-25-7" name="__codelineno-25-7" href="#__codelineno-25-7"></a>            <span class="n">config</span> <span class="o">=</span> <span class="n">parse</span><span class="p">(</span><span class="nb">input</span><span class="p">)</span>
</span><span id="__span-25-8"><a id="__codelineno-25-8" name="__codelineno-25-8" href="#__codelineno-25-8"></a>            <span class="k">return</span> <span class="n">Ok</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
</span><span id="__span-25-9"><a id="__codelineno-25-9" name="__codelineno-25-9" href="#__codelineno-25-9"></a>        <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="__span-25-10"><a id="__codelineno-25-10" name="__codelineno-25-10" href="#__codelineno-25-10"></a>            <span class="k">return</span> <span class="n">Err</span><span class="p">(</span><span class="n">ConfigError</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)))</span>
</span><span id="__span-25-11"><a id="__codelineno-25-11" name="__codelineno-25-11" href="#__codelineno-25-11"></a>
</span><span id="__span-25-12"><a id="__codelineno-25-12" name="__codelineno-25-12" href="#__codelineno-25-12"></a><span class="c1"># Composing Result-returning agents</span>
</span><span id="__span-25-13"><a id="__codelineno-25-13" name="__codelineno-25-13" href="#__codelineno-25-13"></a><span class="n">validate_result</span> <span class="o">=</span> <span class="k">await</span> <span class="n">validate_agent</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span id="__span-25-14"><a id="__codelineno-25-14" name="__codelineno-25-14" href="#__codelineno-25-14"></a><span class="k">match</span> <span class="n">validate_result</span><span class="p">:</span>
</span><span id="__span-25-15"><a id="__codelineno-25-15" name="__codelineno-25-15" href="#__codelineno-25-15"></a>    <span class="k">case</span> <span class="n">Ok</span><span class="p">(</span><span class="n">validated</span><span class="p">):</span>
</span><span id="__span-25-16"><a id="__codelineno-25-16" name="__codelineno-25-16" href="#__codelineno-25-16"></a>        <span class="n">transform_result</span> <span class="o">=</span> <span class="k">await</span> <span class="n">transform_agent</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span><span class="n">validated</span><span class="p">)</span>
</span><span id="__span-25-17"><a id="__codelineno-25-17" name="__codelineno-25-17" href="#__codelineno-25-17"></a>        <span class="k">match</span> <span class="n">transform_result</span><span class="p">:</span>
</span><span id="__span-25-18"><a id="__codelineno-25-18" name="__codelineno-25-18" href="#__codelineno-25-18"></a>            <span class="k">case</span> <span class="n">Ok</span><span class="p">(</span><span class="n">transformed</span><span class="p">):</span>
</span><span id="__span-25-19"><a id="__codelineno-25-19" name="__codelineno-25-19" href="#__codelineno-25-19"></a>                <span class="k">return</span> <span class="n">Ok</span><span class="p">(</span><span class="n">transformed</span><span class="p">)</span>
</span><span id="__span-25-20"><a id="__codelineno-25-20" name="__codelineno-25-20" href="#__codelineno-25-20"></a>            <span class="k">case</span> <span class="n">Err</span><span class="p">(</span><span class="n">e</span><span class="p">):</span>
</span><span id="__span-25-21"><a id="__codelineno-25-21" name="__codelineno-25-21" href="#__codelineno-25-21"></a>                <span class="k">return</span> <span class="n">Err</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
</span><span id="__span-25-22"><a id="__codelineno-25-22" name="__codelineno-25-22" href="#__codelineno-25-22"></a>    <span class="k">case</span> <span class="n">Err</span><span class="p">(</span><span class="n">e</span><span class="p">):</span>
</span><span id="__span-25-23"><a id="__codelineno-25-23" name="__codelineno-25-23" href="#__codelineno-25-23"></a>        <span class="k">return</span> <span class="n">Err</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
</span><span id="__span-25-24"><a id="__codelineno-25-24" name="__codelineno-25-24" href="#__codelineno-25-24"></a>
</span><span id="__span-25-25"><a id="__codelineno-25-25" name="__codelineno-25-25" href="#__codelineno-25-25"></a><span class="c1"># Or use bind for cleaner composition</span>
</span><span id="__span-25-26"><a id="__codelineno-25-26" name="__codelineno-25-26" href="#__codelineno-25-26"></a><span class="n">result</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="__span-25-27"><a id="__codelineno-25-27" name="__codelineno-25-27" href="#__codelineno-25-27"></a>    <span class="k">await</span> <span class="n">validate_agent</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span id="__span-25-28"><a id="__codelineno-25-28" name="__codelineno-25-28" href="#__codelineno-25-28"></a>    <span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="k">lambda</span> <span class="n">v</span><span class="p">:</span> <span class="n">transform_agent</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span><span class="n">v</span><span class="p">))</span>
</span><span id="__span-25-29"><a id="__codelineno-25-29" name="__codelineno-25-29" href="#__codelineno-25-29"></a>    <span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="k">lambda</span> <span class="n">t</span><span class="p">:</span> <span class="n">persist_agent</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span><span class="n">t</span><span class="p">))</span>
</span><span id="__span-25-30"><a id="__codelineno-25-30" name="__codelineno-25-30" href="#__codelineno-25-30"></a><span class="p">)</span>
</span></code></pre></div>
<p><strong>Pattern: Graceful degradation</strong></p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-26-1"><a id="__codelineno-26-1" name="__codelineno-26-1" href="#__codelineno-26-1"></a><span class="c1"># WRONG: Fail hard on optional features</span>
</span><span id="__span-26-2"><a id="__codelineno-26-2" name="__codelineno-26-2" href="#__codelineno-26-2"></a><span class="k">def</span><span class="w"> </span><span class="nf">process</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
</span><span id="__span-26-3"><a id="__codelineno-26-3" name="__codelineno-26-3" href="#__codelineno-26-3"></a>    <span class="n">enhanced</span> <span class="o">=</span> <span class="n">expensive_enhancement</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>  <span class="c1"># Might fail</span>
</span><span id="__span-26-4"><a id="__codelineno-26-4" name="__codelineno-26-4" href="#__codelineno-26-4"></a>    <span class="k">return</span> <span class="n">enhanced</span>
</span><span id="__span-26-5"><a id="__codelineno-26-5" name="__codelineno-26-5" href="#__codelineno-26-5"></a>
</span><span id="__span-26-6"><a id="__codelineno-26-6" name="__codelineno-26-6" href="#__codelineno-26-6"></a><span class="c1"># RIGHT: Degrade gracefully</span>
</span><span id="__span-26-7"><a id="__codelineno-26-7" name="__codelineno-26-7" href="#__codelineno-26-7"></a><span class="k">def</span><span class="w"> </span><span class="nf">process</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
</span><span id="__span-26-8"><a id="__codelineno-26-8" name="__codelineno-26-8" href="#__codelineno-26-8"></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="__span-26-9"><a id="__codelineno-26-9" name="__codelineno-26-9" href="#__codelineno-26-9"></a>        <span class="n">enhanced</span> <span class="o">=</span> <span class="n">expensive_enhancement</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span id="__span-26-10"><a id="__codelineno-26-10" name="__codelineno-26-10" href="#__codelineno-26-10"></a>        <span class="k">return</span> <span class="n">enhanced</span>
</span><span id="__span-26-11"><a id="__codelineno-26-11" name="__codelineno-26-11" href="#__codelineno-26-11"></a>    <span class="k">except</span> <span class="n">EnhancementError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="__span-26-12"><a id="__codelineno-26-12" name="__codelineno-26-12" href="#__codelineno-26-12"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Enhancement failed: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">, using base data&quot;</span><span class="p">)</span>
</span><span id="__span-26-13"><a id="__codelineno-26-13" name="__codelineno-26-13" href="#__codelineno-26-13"></a>        <span class="k">return</span> <span class="n">data</span>  <span class="c1"># Fallback to unenhanced</span>
</span></code></pre></div>
<p><strong>From practice (impl/claude/runtime/base.py)</strong>:
- LLM parsing failures → structured Result types
- Network errors → retryable vs permanent classification
- Validation failures → detailed error messages with context</p>
<hr />
<h2 id="constraints">Constraints</h2>
<ul>
<li>Composability is paramount (agents are morphisms)</li>
<li>Quality over quantity (Judge rejects mediocrity)</li>
<li>Each agent = one file with clear type signature</li>
<li>Tests are required</li>
</ul>
<hr />
<h2 id="verification">Verification</h2>
<p>A successful implementation satisfies:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-27-1"><a id="__codelineno-27-1" name="__codelineno-27-1" href="#__codelineno-27-1"></a><span class="k">assert</span> <span class="n">Regenerate</span><span class="p">(</span><span class="n">Spec</span><span class="p">)</span> <span class="err">≅</span> <span class="n">Impl</span>
</span><span id="__span-27-2"><a id="__codelineno-27-2" name="__codelineno-27-2" href="#__codelineno-27-2"></a><span class="k">assert</span> <span class="n">Judge</span><span class="p">(</span><span class="n">Impl</span><span class="p">,</span> <span class="n">Principles</span><span class="p">)</span><span class="o">.</span><span class="n">verdict</span> <span class="o">==</span> <span class="s2">&quot;accept&quot;</span>
</span><span id="__span-27-3"><a id="__codelineno-27-3" name="__codelineno-27-3" href="#__codelineno-27-3"></a><span class="k">assert</span> <span class="n">Contradict</span><span class="p">(</span><span class="n">Impl</span><span class="p">,</span> <span class="n">Spec</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span>
</span><span id="__span-27-4"><a id="__codelineno-27-4" name="__codelineno-27-4" href="#__codelineno-27-4"></a><span class="k">assert</span> <span class="n">autopoiesis_score</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mf">0.5</span>
</span></code></pre></div>
<h3 id="composition-verification-checklist">Composition Verification Checklist</h3>
<p>When implementing or reviewing an agent, verify these composability properties:</p>
<h4 id="1-type-safety">1. Type Safety</h4>
<ul class="task-list">
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled/><span class="task-list-indicator"></span></label> <strong>Input type is clearly defined</strong> - Agent[A, B] has concrete A type</li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled/><span class="task-list-indicator"></span></label> <strong>Output type is clearly defined</strong> - Agent[A, B] has concrete B type</li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled/><span class="task-list-indicator"></span></label> <strong>Type variables are consistent</strong> - Same TypeVar used throughout</li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled/><span class="task-list-indicator"></span></label> <strong>Generic constraints are documented</strong> - If A must be Serializable, state it</li>
</ul>
<div class="language-python highlight"><pre><span></span><code><span id="__span-28-1"><a id="__codelineno-28-1" name="__codelineno-28-1" href="#__codelineno-28-1"></a><span class="c1"># Example type safety test</span>
</span><span id="__span-28-2"><a id="__codelineno-28-2" name="__codelineno-28-2" href="#__codelineno-28-2"></a><span class="k">def</span><span class="w"> </span><span class="nf">test_type_preservation</span><span class="p">():</span>
</span><span id="__span-28-3"><a id="__codelineno-28-3" name="__codelineno-28-3" href="#__codelineno-28-3"></a>    <span class="n">agent</span><span class="p">:</span> <span class="n">Agent</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">MyAgent</span><span class="p">()</span>
</span><span id="__span-28-4"><a id="__codelineno-28-4" name="__codelineno-28-4" href="#__codelineno-28-4"></a>    <span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="n">agent</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span><span class="s2">&quot;test&quot;</span><span class="p">)</span>
</span><span id="__span-28-5"><a id="__codelineno-28-5" name="__codelineno-28-5" href="#__codelineno-28-5"></a>    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span>  <span class="c1"># Output type matches signature</span>
</span></code></pre></div>
<h4 id="2-composition-laws">2. Composition Laws</h4>
<ul class="task-list">
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled/><span class="task-list-indicator"></span></label> <strong>Associativity holds</strong> - <code>(f &gt;&gt; g) &gt;&gt; h == f &gt;&gt; (g &gt;&gt; h)</code></li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled/><span class="task-list-indicator"></span></label> <strong>Left identity holds</strong> - <code>Id() &gt;&gt; agent == agent</code></li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled/><span class="task-list-indicator"></span></label> <strong>Right identity holds</strong> - <code>agent &gt;&gt; Id() == agent</code></li>
</ul>
<div class="language-python highlight"><pre><span></span><code><span id="__span-29-1"><a id="__codelineno-29-1" name="__codelineno-29-1" href="#__codelineno-29-1"></a><span class="c1"># Example composition law tests</span>
</span><span id="__span-29-2"><a id="__codelineno-29-2" name="__codelineno-29-2" href="#__codelineno-29-2"></a><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">test_associativity</span><span class="p">():</span>
</span><span id="__span-29-3"><a id="__codelineno-29-3" name="__codelineno-29-3" href="#__codelineno-29-3"></a>    <span class="n">f</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">h</span> <span class="o">=</span> <span class="n">AgentF</span><span class="p">(),</span> <span class="n">AgentG</span><span class="p">(),</span> <span class="n">AgentH</span><span class="p">()</span>
</span><span id="__span-29-4"><a id="__codelineno-29-4" name="__codelineno-29-4" href="#__codelineno-29-4"></a>    <span class="n">input_data</span> <span class="o">=</span> <span class="n">create_test_input</span><span class="p">()</span>
</span><span id="__span-29-5"><a id="__codelineno-29-5" name="__codelineno-29-5" href="#__codelineno-29-5"></a>
</span><span id="__span-29-6"><a id="__codelineno-29-6" name="__codelineno-29-6" href="#__codelineno-29-6"></a>    <span class="c1"># (f &gt;&gt; g) &gt;&gt; h</span>
</span><span id="__span-29-7"><a id="__codelineno-29-7" name="__codelineno-29-7" href="#__codelineno-29-7"></a>    <span class="n">result1</span> <span class="o">=</span> <span class="k">await</span> <span class="p">((</span><span class="n">f</span> <span class="o">&gt;&gt;</span> <span class="n">g</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="n">h</span><span class="p">)</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span><span class="n">input_data</span><span class="p">)</span>
</span><span id="__span-29-8"><a id="__codelineno-29-8" name="__codelineno-29-8" href="#__codelineno-29-8"></a>
</span><span id="__span-29-9"><a id="__codelineno-29-9" name="__codelineno-29-9" href="#__codelineno-29-9"></a>    <span class="c1"># f &gt;&gt; (g &gt;&gt; h)</span>
</span><span id="__span-29-10"><a id="__codelineno-29-10" name="__codelineno-29-10" href="#__codelineno-29-10"></a>    <span class="n">result2</span> <span class="o">=</span> <span class="k">await</span> <span class="p">(</span><span class="n">f</span> <span class="o">&gt;&gt;</span> <span class="p">(</span><span class="n">g</span> <span class="o">&gt;&gt;</span> <span class="n">h</span><span class="p">))</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span><span class="n">input_data</span><span class="p">)</span>
</span><span id="__span-29-11"><a id="__codelineno-29-11" name="__codelineno-29-11" href="#__codelineno-29-11"></a>
</span><span id="__span-29-12"><a id="__codelineno-29-12" name="__codelineno-29-12" href="#__codelineno-29-12"></a>    <span class="k">assert</span> <span class="n">result1</span> <span class="o">==</span> <span class="n">result2</span>
</span><span id="__span-29-13"><a id="__codelineno-29-13" name="__codelineno-29-13" href="#__codelineno-29-13"></a>
</span><span id="__span-29-14"><a id="__codelineno-29-14" name="__codelineno-29-14" href="#__codelineno-29-14"></a><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">test_left_identity</span><span class="p">():</span>
</span><span id="__span-29-15"><a id="__codelineno-29-15" name="__codelineno-29-15" href="#__codelineno-29-15"></a>    <span class="n">agent</span> <span class="o">=</span> <span class="n">MyAgent</span><span class="p">()</span>
</span><span id="__span-29-16"><a id="__codelineno-29-16" name="__codelineno-29-16" href="#__codelineno-29-16"></a>    <span class="n">input_data</span> <span class="o">=</span> <span class="n">create_test_input</span><span class="p">()</span>
</span><span id="__span-29-17"><a id="__codelineno-29-17" name="__codelineno-29-17" href="#__codelineno-29-17"></a>
</span><span id="__span-29-18"><a id="__codelineno-29-18" name="__codelineno-29-18" href="#__codelineno-29-18"></a>    <span class="n">result1</span> <span class="o">=</span> <span class="k">await</span> <span class="p">(</span><span class="n">Id</span><span class="p">()</span> <span class="o">&gt;&gt;</span> <span class="n">agent</span><span class="p">)</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span><span class="n">input_data</span><span class="p">)</span>
</span><span id="__span-29-19"><a id="__codelineno-29-19" name="__codelineno-29-19" href="#__codelineno-29-19"></a>    <span class="n">result2</span> <span class="o">=</span> <span class="k">await</span> <span class="n">agent</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span><span class="n">input_data</span><span class="p">)</span>
</span><span id="__span-29-20"><a id="__codelineno-29-20" name="__codelineno-29-20" href="#__codelineno-29-20"></a>
</span><span id="__span-29-21"><a id="__codelineno-29-21" name="__codelineno-29-21" href="#__codelineno-29-21"></a>    <span class="k">assert</span> <span class="n">result1</span> <span class="o">==</span> <span class="n">result2</span>
</span><span id="__span-29-22"><a id="__codelineno-29-22" name="__codelineno-29-22" href="#__codelineno-29-22"></a>
</span><span id="__span-29-23"><a id="__codelineno-29-23" name="__codelineno-29-23" href="#__codelineno-29-23"></a><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">test_right_identity</span><span class="p">():</span>
</span><span id="__span-29-24"><a id="__codelineno-29-24" name="__codelineno-29-24" href="#__codelineno-29-24"></a>    <span class="n">agent</span> <span class="o">=</span> <span class="n">MyAgent</span><span class="p">()</span>
</span><span id="__span-29-25"><a id="__codelineno-29-25" name="__codelineno-29-25" href="#__codelineno-29-25"></a>    <span class="n">input_data</span> <span class="o">=</span> <span class="n">create_test_input</span><span class="p">()</span>
</span><span id="__span-29-26"><a id="__codelineno-29-26" name="__codelineno-29-26" href="#__codelineno-29-26"></a>
</span><span id="__span-29-27"><a id="__codelineno-29-27" name="__codelineno-29-27" href="#__codelineno-29-27"></a>    <span class="n">result1</span> <span class="o">=</span> <span class="k">await</span> <span class="p">(</span><span class="n">agent</span> <span class="o">&gt;&gt;</span> <span class="n">Id</span><span class="p">())</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span><span class="n">input_data</span><span class="p">)</span>
</span><span id="__span-29-28"><a id="__codelineno-29-28" name="__codelineno-29-28" href="#__codelineno-29-28"></a>    <span class="n">result2</span> <span class="o">=</span> <span class="k">await</span> <span class="n">agent</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span><span class="n">input_data</span><span class="p">)</span>
</span><span id="__span-29-29"><a id="__codelineno-29-29" name="__codelineno-29-29" href="#__codelineno-29-29"></a>
</span><span id="__span-29-30"><a id="__codelineno-29-30" name="__codelineno-29-30" href="#__codelineno-29-30"></a>    <span class="k">assert</span> <span class="n">result1</span> <span class="o">==</span> <span class="n">result2</span>
</span></code></pre></div>
<h4 id="3-error-propagation">3. Error Propagation</h4>
<ul class="task-list">
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled/><span class="task-list-indicator"></span></label> <strong>Errors compose correctly</strong> - Result[A, E] &gt;&gt; Result[B, E] propagates E</li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled/><span class="task-list-indicator"></span></label> <strong>Exceptions are documented</strong> - Raised exceptions listed in docstring</li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled/><span class="task-list-indicator"></span></label> <strong>Graceful degradation is explicit</strong> - Fallback behavior is clear</li>
</ul>
<div class="language-python highlight"><pre><span></span><code><span id="__span-30-1"><a id="__codelineno-30-1" name="__codelineno-30-1" href="#__codelineno-30-1"></a><span class="c1"># Example error propagation test</span>
</span><span id="__span-30-2"><a id="__codelineno-30-2" name="__codelineno-30-2" href="#__codelineno-30-2"></a><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">test_error_propagation</span><span class="p">():</span>
</span><span id="__span-30-3"><a id="__codelineno-30-3" name="__codelineno-30-3" href="#__codelineno-30-3"></a>    <span class="n">failing_agent</span> <span class="o">=</span> <span class="n">FailingAgent</span><span class="p">()</span>
</span><span id="__span-30-4"><a id="__codelineno-30-4" name="__codelineno-30-4" href="#__codelineno-30-4"></a>    <span class="n">downstream_agent</span> <span class="o">=</span> <span class="n">DownstreamAgent</span><span class="p">()</span>
</span><span id="__span-30-5"><a id="__codelineno-30-5" name="__codelineno-30-5" href="#__codelineno-30-5"></a>
</span><span id="__span-30-6"><a id="__codelineno-30-6" name="__codelineno-30-6" href="#__codelineno-30-6"></a>    <span class="n">pipeline</span> <span class="o">=</span> <span class="n">failing_agent</span> <span class="o">&gt;&gt;</span> <span class="n">downstream_agent</span>
</span><span id="__span-30-7"><a id="__codelineno-30-7" name="__codelineno-30-7" href="#__codelineno-30-7"></a>
</span><span id="__span-30-8"><a id="__codelineno-30-8" name="__codelineno-30-8" href="#__codelineno-30-8"></a>    <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="n">ExpectedError</span><span class="p">):</span>
</span><span id="__span-30-9"><a id="__codelineno-30-9" name="__codelineno-30-9" href="#__codelineno-30-9"></a>        <span class="k">await</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span><span class="n">test_input</span><span class="p">)</span>
</span><span id="__span-30-10"><a id="__codelineno-30-10" name="__codelineno-30-10" href="#__codelineno-30-10"></a>    <span class="c1"># Verify downstream never executed when upstream fails</span>
</span></code></pre></div>
<h4 id="4-state-isolation">4. State Isolation</h4>
<ul class="task-list">
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled/><span class="task-list-indicator"></span></label> <strong>No shared mutable state</strong> - Each invocation is independent</li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled/><span class="task-list-indicator"></span></label> <strong>Thread-safe if needed</strong> - Concurrent invocations don't interfere</li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled/><span class="task-list-indicator"></span></label> <strong>Idempotent where expected</strong> - Same input → same output (for pure agents)</li>
</ul>
<div class="language-python highlight"><pre><span></span><code><span id="__span-31-1"><a id="__codelineno-31-1" name="__codelineno-31-1" href="#__codelineno-31-1"></a><span class="c1"># Example state isolation test</span>
</span><span id="__span-31-2"><a id="__codelineno-31-2" name="__codelineno-31-2" href="#__codelineno-31-2"></a><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">test_state_isolation</span><span class="p">():</span>
</span><span id="__span-31-3"><a id="__codelineno-31-3" name="__codelineno-31-3" href="#__codelineno-31-3"></a>    <span class="n">agent</span> <span class="o">=</span> <span class="n">MyAgent</span><span class="p">()</span>
</span><span id="__span-31-4"><a id="__codelineno-31-4" name="__codelineno-31-4" href="#__codelineno-31-4"></a>
</span><span id="__span-31-5"><a id="__codelineno-31-5" name="__codelineno-31-5" href="#__codelineno-31-5"></a>    <span class="c1"># Concurrent invocations</span>
</span><span id="__span-31-6"><a id="__codelineno-31-6" name="__codelineno-31-6" href="#__codelineno-31-6"></a>    <span class="n">results</span> <span class="o">=</span> <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span>
</span><span id="__span-31-7"><a id="__codelineno-31-7" name="__codelineno-31-7" href="#__codelineno-31-7"></a>        <span class="n">agent</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span><span class="n">input1</span><span class="p">),</span>
</span><span id="__span-31-8"><a id="__codelineno-31-8" name="__codelineno-31-8" href="#__codelineno-31-8"></a>        <span class="n">agent</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span><span class="n">input2</span><span class="p">),</span>
</span><span id="__span-31-9"><a id="__codelineno-31-9" name="__codelineno-31-9" href="#__codelineno-31-9"></a>        <span class="n">agent</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span><span class="n">input1</span><span class="p">),</span>  <span class="c1"># Repeat</span>
</span><span id="__span-31-10"><a id="__codelineno-31-10" name="__codelineno-31-10" href="#__codelineno-31-10"></a>    <span class="p">)</span>
</span><span id="__span-31-11"><a id="__codelineno-31-11" name="__codelineno-31-11" href="#__codelineno-31-11"></a>
</span><span id="__span-31-12"><a id="__codelineno-31-12" name="__codelineno-31-12" href="#__codelineno-31-12"></a>    <span class="c1"># Verify no cross-contamination</span>
</span><span id="__span-31-13"><a id="__codelineno-31-13" name="__codelineno-31-13" href="#__codelineno-31-13"></a>    <span class="k">assert</span> <span class="n">results</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">results</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>  <span class="c1"># Same input → same output</span>
</span><span id="__span-31-14"><a id="__codelineno-31-14" name="__codelineno-31-14" href="#__codelineno-31-14"></a>    <span class="k">assert</span> <span class="n">results</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="n">results</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>  <span class="c1"># Different inputs → different outputs</span>
</span></code></pre></div>
<h4 id="5-composition-operators">5. Composition Operators</h4>
<ul class="task-list">
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled/><span class="task-list-indicator"></span></label> <strong><code>&gt;&gt;</code> (right shift) works correctly</strong> - Sequential composition</li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled/><span class="task-list-indicator"></span></label> <strong><code>__rshift__</code> preserves types</strong> - Agent[A,B] &gt;&gt; Agent[B,C] → Agent[A,C]</li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled/><span class="task-list-indicator"></span></label> <strong>Optimization is sound</strong> - Fast paths don't break semantics (e.g., Id &gt;&gt; f = f)</li>
</ul>
<div class="language-python highlight"><pre><span></span><code><span id="__span-32-1"><a id="__codelineno-32-1" name="__codelineno-32-1" href="#__codelineno-32-1"></a><span class="c1"># Example composition operator test</span>
</span><span id="__span-32-2"><a id="__codelineno-32-2" name="__codelineno-32-2" href="#__codelineno-32-2"></a><span class="k">def</span><span class="w"> </span><span class="nf">test_rshift_types</span><span class="p">():</span>
</span><span id="__span-32-3"><a id="__codelineno-32-3" name="__codelineno-32-3" href="#__codelineno-32-3"></a>    <span class="n">f</span><span class="p">:</span> <span class="n">Agent</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">StrToInt</span><span class="p">()</span>
</span><span id="__span-32-4"><a id="__codelineno-32-4" name="__codelineno-32-4" href="#__codelineno-32-4"></a>    <span class="n">g</span><span class="p">:</span> <span class="n">Agent</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="n">IntToBool</span><span class="p">()</span>
</span><span id="__span-32-5"><a id="__codelineno-32-5" name="__codelineno-32-5" href="#__codelineno-32-5"></a>
</span><span id="__span-32-6"><a id="__codelineno-32-6" name="__codelineno-32-6" href="#__codelineno-32-6"></a>    <span class="n">composed</span><span class="p">:</span> <span class="n">Agent</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="n">f</span> <span class="o">&gt;&gt;</span> <span class="n">g</span>
</span><span id="__span-32-7"><a id="__codelineno-32-7" name="__codelineno-32-7" href="#__codelineno-32-7"></a>
</span><span id="__span-32-8"><a id="__codelineno-32-8" name="__codelineno-32-8" href="#__codelineno-32-8"></a>    <span class="c1"># Type checker should accept this</span>
</span><span id="__span-32-9"><a id="__codelineno-32-9" name="__codelineno-32-9" href="#__codelineno-32-9"></a>    <span class="n">result</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="k">await</span> <span class="n">composed</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span><span class="s2">&quot;42&quot;</span><span class="p">)</span>
</span><span id="__span-32-10"><a id="__codelineno-32-10" name="__codelineno-32-10" href="#__codelineno-32-10"></a>    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="nb">bool</span><span class="p">)</span>
</span></code></pre></div>
<h4 id="6-practical-composability">6. Practical Composability</h4>
<ul class="task-list">
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled/><span class="task-list-indicator"></span></label> <strong>Works with standard combinators</strong> - maybe(), either(), parallel(), etc.</li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled/><span class="task-list-indicator"></span></label> <strong>Integrates with Fix</strong> - Can be used in fixed-point iteration</li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled/><span class="task-list-indicator"></span></label> <strong>Compatible with Judge</strong> - Can be evaluated against principles</li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled/><span class="task-list-indicator"></span></label> <strong>Serializable if needed</strong> - State can be saved/restored for stateful agents</li>
</ul>
<div class="language-python highlight"><pre><span></span><code><span id="__span-33-1"><a id="__codelineno-33-1" name="__codelineno-33-1" href="#__codelineno-33-1"></a><span class="c1"># Example combinator compatibility test</span>
</span><span id="__span-33-2"><a id="__codelineno-33-2" name="__codelineno-33-2" href="#__codelineno-33-2"></a><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">test_maybe_combinator</span><span class="p">():</span>
</span><span id="__span-33-3"><a id="__codelineno-33-3" name="__codelineno-33-3" href="#__codelineno-33-3"></a>    <span class="n">agent</span> <span class="o">=</span> <span class="n">MyAgent</span><span class="p">()</span>
</span><span id="__span-33-4"><a id="__codelineno-33-4" name="__codelineno-33-4" href="#__codelineno-33-4"></a>    <span class="n">maybe_agent</span> <span class="o">=</span> <span class="n">maybe</span><span class="p">(</span><span class="n">agent</span><span class="p">)</span>
</span><span id="__span-33-5"><a id="__codelineno-33-5" name="__codelineno-33-5" href="#__codelineno-33-5"></a>
</span><span id="__span-33-6"><a id="__codelineno-33-6" name="__codelineno-33-6" href="#__codelineno-33-6"></a>    <span class="c1"># Should handle None gracefully</span>
</span><span id="__span-33-7"><a id="__codelineno-33-7" name="__codelineno-33-7" href="#__codelineno-33-7"></a>    <span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="n">maybe_agent</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
</span><span id="__span-33-8"><a id="__codelineno-33-8" name="__codelineno-33-8" href="#__codelineno-33-8"></a>    <span class="k">assert</span> <span class="n">result</span> <span class="ow">is</span> <span class="kc">None</span>
</span><span id="__span-33-9"><a id="__codelineno-33-9" name="__codelineno-33-9" href="#__codelineno-33-9"></a>
</span><span id="__span-33-10"><a id="__codelineno-33-10" name="__codelineno-33-10" href="#__codelineno-33-10"></a>    <span class="c1"># Should pass through valid input</span>
</span><span id="__span-33-11"><a id="__codelineno-33-11" name="__codelineno-33-11" href="#__codelineno-33-11"></a>    <span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="n">maybe_agent</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span><span class="n">valid_input</span><span class="p">)</span>
</span><span id="__span-33-12"><a id="__codelineno-33-12" name="__codelineno-33-12" href="#__codelineno-33-12"></a>    <span class="k">assert</span> <span class="n">result</span> <span class="o">==</span> <span class="n">expected_output</span>
</span></code></pre></div>
<h3 id="verification-anti-patterns">Verification Anti-Patterns</h3>
<p><strong>❌ Don't:</strong>
- Skip type annotations ("will add later")
- Test only happy path (ignore error cases)
- Assume single-threaded usage without documenting it
- Mix stateful and stateless behavior without clear boundaries
- Optimize before verifying correctness</p>
<p><strong>✅ Do:</strong>
- Write composition law tests first
- Document state assumptions explicitly
- Test edge cases and error propagation
- Verify type safety with mypy --strict
- Use agents to verify agents (Judge, Contradict)</p>
<hr />
<h2 id="implementation-progress-template">Implementation Progress Template</h2>
<p>Use this checklist to track progress when implementing kgents from spec. Copy this to <code>PROGRESS.md</code> and check off items as you complete them.</p>
<h3 id="phase-0-foundation">Phase 0: Foundation</h3>
<p><strong>Goal</strong>: Set up environment and understand specs</p>
<ul class="task-list">
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled/><span class="task-list-indicator"></span></label> <strong>Environment Setup</strong></li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled/><span class="task-list-indicator"></span></label> Clone/fork kgents repository</li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled/><span class="task-list-indicator"></span></label> Set up Python ≥3.11 virtual environment</li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled/><span class="task-list-indicator"></span></label> Install dependencies: <code>pip install -e .</code></li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled/><span class="task-list-indicator"></span></label> Verify mypy installed: <code>mypy --version</code></li>
<li class="task-list-item">
<p><label class="task-list-control"><input type="checkbox" disabled/><span class="task-list-indicator"></span></label> Set up IDE with type checking</p>
</li>
<li class="task-list-item">
<p><label class="task-list-control"><input type="checkbox" disabled/><span class="task-list-indicator"></span></label> <strong>Read Specifications</strong> (in order)</p>
</li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled/><span class="task-list-indicator"></span></label> <code>spec/principles.md</code> - 7 core principles</li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled/><span class="task-list-indicator"></span></label> <code>spec/bootstrap.md</code> - 7 irreducible agents</li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled/><span class="task-list-indicator"></span></label> <code>spec/anatomy.md</code> - What constitutes an agent</li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled/><span class="task-list-indicator"></span></label> <code>spec/c-gents/composition.md</code> - How agents compose</li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled/><span class="task-list-indicator"></span></label> <code>AUTONOMOUS_BOOTSTRAP_PROTOCOL.md</code> - Meta-level protocol</li>
<li class="task-list-item">
<p><label class="task-list-control"><input type="checkbox" disabled/><span class="task-list-indicator"></span></label> <code>docs/BOOTSTRAP_PROMPT.md</code> - This document</p>
</li>
<li class="task-list-item">
<p><label class="task-list-control"><input type="checkbox" disabled/><span class="task-list-indicator"></span></label> <strong>Initialize Runtime</strong> (Step 0, before ANY code)</p>
</li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled/><span class="task-list-indicator"></span></label> Set up ClaudeCLIRuntime or ClaudeRuntime</li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled/><span class="task-list-indicator"></span></label> Test basic agent invocation (try kgent or creativity_coach)</li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled/><span class="task-list-indicator"></span></label> Verify LLM access working</li>
</ul>
<p><strong>Autopoiesis checkpoint</strong>: Did I use agents to plan the implementation approach? (CreativityCoach, HypothesisEngine)</p>
<hr />
<h3 id="phase-1-foundation-types-and-base-classes">Phase 1: Foundation - Types and Base Classes</h3>
<p><strong>Goal</strong>: Implement <code>types.py</code> with Agent[A, B] base class and composition operators</p>
<p><strong>Files to create/modify</strong>:
- [ ] <code>impl/claude/bootstrap/types.py</code></p>
<p><strong>Tasks</strong>:
- [ ] Define <code>Agent[A, B]</code> abstract base class with <code>invoke</code> method
- [ ] Implement <code>__rshift__</code> composition operator (<code>&gt;&gt;</code>)
- [ ] Define <code>ComposedAgent[A, B, C]</code> for sequential composition
- [ ] Add <code>Result[T, E]</code> types (Ok, Err) for error handling
- [ ] Write module docstring with type signatures
- [ ] Add comprehensive type annotations</p>
<p><strong>Validation</strong>:
- [ ] <code>mypy --strict types.py</code> passes with zero errors
- [ ] Manual review: Can compose agents with <code>f &gt;&gt; g</code> syntax?
- [ ] Test: <code>Id &gt;&gt; SomeAgent</code> should equal <code>SomeAgent</code> (type level)</p>
<p><strong>Autopoiesis checkpoint</strong>:
- [ ] Used K-gent for naming decisions?
- [ ] Used CreativityCoach to explore API design?
- [ ] Used Judge to review against principles?</p>
<p><strong>Dependencies</strong>: None (foundational)</p>
<hr />
<h3 id="phase-2-level-1-agents-id-and-ground">Phase 2: Level 1 Agents - Id and Ground</h3>
<p><strong>Goal</strong>: Implement simplest agents with no dependencies</p>
<h4 id="21-id-agent">2.1 Id Agent</h4>
<p><strong>Files</strong>:
- [ ] <code>impl/claude/bootstrap/id.py</code></p>
<p><strong>Tasks</strong>:
- [ ] Read spec: <code>spec/bootstrap.md</code> (Id section)
- [ ] Use agent template from docs/BOOTSTRAP_PROMPT.md
- [ ] Implement <code>Id(Agent[A, A])</code> class
- [ ] Optimize <code>__rshift__</code>: <code>Id &gt;&gt; f</code> should return <code>f</code>
- [ ] Write tests: identity laws, composition laws</p>
<p><strong>Validation</strong>:
- [ ] <code>mypy --strict id.py</code> passes
- [ ] Tests pass (associativity, left/right identity)
- [ ] Judge verdict: ACCEPT
- [ ] Contradict(spec, impl): None</p>
<p><strong>Autopoiesis</strong>: Used agents to implement? (K-gent for naming, Judge for review)</p>
<h4 id="22-ground-agent">2.2 Ground Agent</h4>
<p><strong>Files</strong>:
- [ ] <code>impl/claude/bootstrap/ground.py</code>
- [ ] Optional: <code>impl/claude/bootstrap/ground_parser.py</code> (GroundParser agent)</p>
<p><strong>Tasks</strong>:
- [ ] Read spec: <code>spec/bootstrap.md</code> (Ground section)
- [ ] Implement <code>Ground(Agent[Void, Facts])</code> or specific variant
- [ ] Load persona from <code>spec/k-gent/persona.md</code>
- [ ] Parse markdown → PersonaSeed structure
- [ ] Consider: Use LLM-based GroundParser for flexibility (see Phase 5.3)</p>
<p><strong>Validation</strong>:
- [ ] Can load persona.md successfully
- [ ] PersonaSeed structure complete (name, values, heuristics, etc.)
- [ ] Judge verdict: ACCEPT
- [ ] Ground checklist complete (see PROTOCOL)</p>
<p><strong>Autopoiesis</strong>: Used GroundParser agent (meta!)</p>
<p><strong>Dependencies</strong>: types.py</p>
<hr />
<h3 id="phase-3-level-2-agents-compose-and-contradict">Phase 3: Level 2 Agents - Compose and Contradict</h3>
<p><strong>Goal</strong>: Implement agents that build on Level 1</p>
<h4 id="31-compose-agent">3.1 Compose Agent</h4>
<p><strong>Files</strong>:
- [ ] <code>impl/claude/bootstrap/compose.py</code></p>
<p><strong>Tasks</strong>:
- [ ] Read spec: <code>spec/bootstrap.md</code> (Compose section)
- [ ] Implement <code>Compose(Agent[(Agent, Agent), Agent])</code>
- [ ] Verify composition laws (associativity)
- [ ] Ensure types propagate correctly: <code>Agent[A,B] &gt;&gt; Agent[B,C] → Agent[A,C]</code>
- [ ] Handle edge cases (Id composition, error propagation)</p>
<p><strong>Validation</strong>:
- [ ] Composition laws hold (associativity tests)
- [ ] Type safety verified with mypy
- [ ] Judge: ACCEPT</p>
<p><strong>Dependencies</strong>: types.py, id.py</p>
<h4 id="32-contradict-agent">3.2 Contradict Agent</h4>
<p><strong>Files</strong>:
- [ ] <code>impl/claude/bootstrap/contradict.py</code></p>
<p><strong>Tasks</strong>:
- [ ] Read spec: <code>spec/bootstrap.md</code> (Contradict section)
- [ ] Implement <code>Contradict(Agent[(A, B), Tension | None])</code>
- [ ] Define Tension types (LOGICAL, PRAGMATIC, AESTHETIC)
- [ ] Implement TensionDetector protocol for extensibility
- [ ] Add 2-3 basic detectors (semantic, structural)</p>
<p><strong>Validation</strong>:
- [ ] Detects obvious contradictions (tests with known conflicts)
- [ ] Returns None when no tension (tests with aligned pairs)
- [ ] Judge: ACCEPT
- [ ] TensionDetector extensible (can add custom detectors)</p>
<p><strong>Dependencies</strong>: types.py</p>
<hr />
<h3 id="phase-4-level-3-agents-judge-and-sublate">Phase 4: Level 3 Agents - Judge and Sublate</h3>
<p><strong>Goal</strong>: Implement evaluation and synthesis agents</p>
<h4 id="41-judge-agent-seven-mini-judges-architecture">4.1 Judge Agent (Seven Mini-Judges Architecture)</h4>
<p><strong>Files</strong>:
- [ ] <code>impl/claude/bootstrap/judge.py</code>
- [ ] Optionally split into: <code>judge_tasteful.py</code>, <code>judge_curated.py</code>, etc.</p>
<p><strong>Tasks</strong>:
- [ ] Read spec: <code>spec/bootstrap.md</code> (Judge section)
- [ ] Read principles: <code>spec/principles.md</code> (all 7)
- [ ] Implement seven mini-judges (see BOOTSTRAP_PROMPT section on Judge)
  - [ ] JudgeTasteful (compressed expertise)
  - [ ] JudgeCurated (unique value)
  - [ ] JudgeEthical (respects agency)
  - [ ] JudgeJoyful (inspiring)
  - [ ] JudgeComposable (works with others)
  - [ ] JudgeGenerative (regenerable)
  - [ ] JudgeHeterarchical (avoids hierarchy)
- [ ] Compose via <code>&gt;&gt;</code>: <code>judge = tasteful &gt;&gt; curated &gt;&gt; ... &gt;&gt; heterarchical</code>
- [ ] Aggregate PartialVerdicts → final Verdict (ACCEPT/REVISE/REJECT)</p>
<p><strong>Validation</strong>:
- [ ] Test on Id agent: should ACCEPT
- [ ] Test on bootstrap agents: all should ACCEPT or REVISE (not REJECT)
- [ ] Test on deliberately bad code: should REVISE or REJECT
- [ ] Each mini-judge independently testable
- [ ] Judge itself passes Judge (meta!)</p>
<p><strong>Autopoiesis</strong>: Used agents to implement Judge? (self-referential)</p>
<p><strong>Dependencies</strong>: types.py, compose.py</p>
<h4 id="42-sublate-agent">4.2 Sublate Agent</h4>
<p><strong>Files</strong>:
- [ ] <code>impl/claude/bootstrap/sublate.py</code></p>
<p><strong>Tasks</strong>:
- [ ] Read spec: <code>spec/bootstrap.md</code> (Sublate section)
- [ ] Implement <code>Sublate(Agent[Tension, Synthesis | HoldTension])</code>
- [ ] Define Synthesis and HoldTension types
- [ ] Implement synthesis logic (LLM-based or rule-based)
- [ ] Add pattern: conscious holding when synthesis not yet possible</p>
<p><strong>Validation</strong>:
- [ ] Can synthesize simple tensions (tests)
- [ ] Can consciously hold unresolvable tensions
- [ ] Judge: ACCEPT</p>
<p><strong>Dependencies</strong>: types.py, contradict.py (for Tension type)</p>
<hr />
<h3 id="phase-5-level-4-agent-fix">Phase 5: Level 4 Agent - Fix</h3>
<p><strong>Goal</strong>: Implement fixed-point iteration</p>
<p><strong>Files</strong>:
- [ ] <code>impl/claude/bootstrap/fix.py</code></p>
<p><strong>Tasks</strong>:
- [ ] Read spec: <code>spec/bootstrap.md</code> (Fix section)
- [ ] Implement <code>Fix(Agent[(A → A), A])</code>
- [ ] Add convergence detection via <code>equality_check</code>
- [ ] Add max_iterations safety limit
- [ ] Implement stateful Fix pattern (memory between iterations)
- [ ] Add convenience function: <code>fix(transform, initial, equality_check)</code></p>
<p><strong>Validation</strong>:
- [ ] Converges for simple cases (tests)
- [ ] Respects max_iterations limit
- [ ] Accumulates state correctly (see PROTOCOL Pitfall 3)
- [ ] Judge: ACCEPT</p>
<p><strong>Dependencies</strong>: types.py, compose.py</p>
<hr />
<h3 id="phase-6-verification-and-validation">Phase 6: Verification and Validation</h3>
<p><strong>Goal</strong>: Ensure all agents work correctly, compose properly, and pass Judge</p>
<p><strong>Tasks</strong>:
- [ ] <strong>Type checking</strong>: <code>mypy --strict impl/claude/bootstrap/</code> (zero errors)
- [ ] <strong>Unit tests</strong>: Write pytest suite for each agent
  - [ ] Test composition laws (associativity, identity)
  - [ ] Test type safety (inputs/outputs match signatures)
  - [ ] Test error propagation
  - [ ] Test state isolation (concurrent invocations)
- [ ] <strong>Integration tests</strong>: Compose multiple agents, verify pipelines work
- [ ] <strong>Judge all agents</strong>: Each bootstrap agent should pass Judge
- [ ] <strong>Contradict check</strong>: Compare impl to spec, should find no tensions
- [ ] <strong>Autopoiesis review</strong>: Calculate % agent usage, document narrative</p>
<p><strong>Validation checklist</strong> (from Verification section above):
- [ ] All composition law tests pass
- [ ] Type safety verified
- [ ] Error propagation works
- [ ] State isolation maintained
- [ ] Judge verdict: ACCEPT for all bootstrap agents
- [ ] Contradict(spec, impl) returns None for each agent
- [ ] Autopoiesis &gt;50% (or qualitative: "felt agent-driven")</p>
<hr />
<h3 id="phase-7-regeneration-test-behavior-equivalence">Phase 7: Regeneration Test (Behavior Equivalence)</h3>
<p><strong>Goal</strong>: Validate that documents are sufficient by regenerating bootstrap</p>
<p><strong>Tasks</strong>:
- [ ] <strong>Backup current implementation</strong>: <code>cp -r bootstrap/ bootstrap.backup/</code>
- [ ] <strong>Delete implementation</strong>: <code>rm -rf bootstrap/*.py</code> (keep types.py)
- [ ] <strong>Regenerate from spec</strong>: Follow BOOTSTRAP_PROMPT.md from scratch
- [ ] <strong>Compare behavior</strong>:
  - [ ] Run tests on regenerated code (should pass)
  - [ ] Compare outputs for same inputs (should match)
  - [ ] Run Contradict(original, regenerated) (no critical tensions)
  - [ ] Qualitative check: "Does this feel like the same agent?"
- [ ] <strong>Document differences</strong>: Style, variable names, comments OK; behavior must match</p>
<p><strong>Success criteria</strong> (from improvement plan Decision 4):
- [ ] Tests pass on regenerated code
- [ ] Behavior equivalence: same inputs → same outputs
- [ ] No major tensions from Contradict
- [ ] Vibes check: "Feels right" (qualitative)
- [ ] Style differences acceptable (formatting, names, comments)</p>
<p><strong>NOT required</strong>:
- Character-exact match (too brittle)
- Identical implementation approach (allow creativity)</p>
<hr />
<h3 id="phase-8-documentation-and-finalization">Phase 8: Documentation and Finalization</h3>
<p><strong>Goal</strong>: Complete documentation, examples, and final polish</p>
<p><strong>Tasks</strong>:
- [ ] <strong>Write examples</strong>: <code>examples/</code> directory with usage examples
- [ ] <strong>Update HYDRATE.md</strong>: Document completion, any learnings
- [ ] <strong>Write IMPLEMENTATION_PLAN retrospective</strong>: What worked, what didn't
- [ ] <strong>Autopoiesis report</strong>: Final narrative of agent usage throughout
- [ ] <strong>Commit with protocol-compliant message</strong>:
  <div class="language-bash highlight"><pre><span></span><code><span id="__span-34-1"><a id="__codelineno-34-1" name="__codelineno-34-1" href="#__codelineno-34-1"></a>git<span class="w"> </span>commit<span class="w"> </span>-m<span class="w"> </span><span class="s2">&quot;feat: Complete bootstrap agents implementation</span>
</span><span id="__span-34-2"><a id="__codelineno-34-2" name="__codelineno-34-2" href="#__codelineno-34-2"></a>
</span><span id="__span-34-3"><a id="__codelineno-34-3" name="__codelineno-34-3" href="#__codelineno-34-3"></a><span class="s2">All 7 bootstrap agents implemented and validated.</span>
</span><span id="__span-34-4"><a id="__codelineno-34-4" name="__codelineno-34-4" href="#__codelineno-34-4"></a><span class="s2">Autopoiesis: [X]% (K-gent [N]x, CreativityCoach [N]x, Judge [N]x, etc.)</span>
</span><span id="__span-34-5"><a id="__codelineno-34-5" name="__codelineno-34-5" href="#__codelineno-34-5"></a><span class="s2">Judge: All agents ACCEPT</span>
</span><span id="__span-34-6"><a id="__codelineno-34-6" name="__codelineno-34-6" href="#__codelineno-34-6"></a><span class="s2">Contradict: Zero tensions</span>
</span><span id="__span-34-7"><a id="__codelineno-34-7" name="__codelineno-34-7" href="#__codelineno-34-7"></a><span class="s2">Tests: 100% pass rate</span>
</span><span id="__span-34-8"><a id="__codelineno-34-8" name="__codelineno-34-8" href="#__codelineno-34-8"></a><span class="s2">Regeneration: Behavior equivalence verified&quot;</span>
</span></code></pre></div></p>
<hr />
<h2 id="progress-tracking-tips">Progress Tracking Tips</h2>
<h3 id="daily-checklist">Daily Checklist</h3>
<p>At start of each session:
1. [ ] Review PROGRESS.md, identify next phase
2. [ ] Initialize ProtocolObserver (if using observability)
3. [ ] Invoke agents for design decisions (Step 0)</p>
<p>During session:
4. [ ] Check off tasks as completed
5. [ ] Log agent usage (for autopoiesis narrative)
6. [ ] Document tensions/decisions</p>
<p>At end of session:
7. [ ] Update PROGRESS.md with current state
8. [ ] Generate autopoiesis narrative
9. [ ] Commit work with descriptive message</p>
<h3 id="measuring-progress">Measuring Progress</h3>
<p><strong>Quantitative</strong>:
- Files completed / Total files
- Tests passing / Total tests
- Judge ACCEPT rate</p>
<p><strong>Qualitative</strong>:
- Does code reflect principles?
- Is autopoiesis &gt;50% (or "felt agent-driven")?
- Would I be proud to show this code?</p>
<h3 id="when-stuck">When Stuck</h3>
<ol>
<li>Consult Troubleshooting section (below)</li>
<li>Use K-gent (REFLECT mode) to explore problem</li>
<li>Use HypothesisEngine to generate approaches</li>
<li>Review AUTONOMOUS_BOOTSTRAP_PROTOCOL.md for guidance</li>
<li>Check HYDRATE.md for recent relevant changes</li>
</ol>
<hr />
<h2 id="troubleshooting-common-errors">Troubleshooting Common Errors</h2>
<p>This section addresses common errors encountered during kgents implementation and provides actionable fixes.</p>
<h3 id="error-1-type-errors-type-is-not-subscriptable">Error 1: Type Errors - "Type is not subscriptable"</h3>
<p><strong>Symptom</strong>:
<div class="language-text highlight"><pre><span></span><code><span id="__span-35-1"><a id="__codelineno-35-1" name="__codelineno-35-1" href="#__codelineno-35-1"></a>TypeError: &#39;type&#39; object is not subscriptable
</span><span id="__span-35-2"><a id="__codelineno-35-2" name="__codelineno-35-2" href="#__codelineno-35-2"></a>Agent[A, B]
</span></code></pre></div></p>
<p><strong>Cause</strong>: Using generic types without importing from <code>typing</code> or using Python &lt;3.9 syntax.</p>
<p><strong>Fix</strong>:
<div class="language-python highlight"><pre><span></span><code><span id="__span-36-1"><a id="__codelineno-36-1" name="__codelineno-36-1" href="#__codelineno-36-1"></a><span class="c1"># WRONG (Python &lt;3.9)</span>
</span><span id="__span-36-2"><a id="__codelineno-36-2" name="__codelineno-36-2" href="#__codelineno-36-2"></a><span class="k">class</span><span class="w"> </span><span class="nc">MyAgent</span><span class="p">(</span><span class="n">Agent</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]):</span>  <span class="c1"># Error if Agent not properly imported</span>
</span><span id="__span-36-3"><a id="__codelineno-36-3" name="__codelineno-36-3" href="#__codelineno-36-3"></a>    <span class="o">...</span>
</span><span id="__span-36-4"><a id="__codelineno-36-4" name="__codelineno-36-4" href="#__codelineno-36-4"></a>
</span><span id="__span-36-5"><a id="__codelineno-36-5" name="__codelineno-36-5" href="#__codelineno-36-5"></a><span class="c1"># RIGHT</span>
</span><span id="__span-36-6"><a id="__codelineno-36-6" name="__codelineno-36-6" href="#__codelineno-36-6"></a><span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">TypeVar</span>
</span><span id="__span-36-7"><a id="__codelineno-36-7" name="__codelineno-36-7" href="#__codelineno-36-7"></a><span class="kn">from</span><span class="w"> </span><span class="nn">bootstrap.types</span><span class="w"> </span><span class="kn">import</span> <span class="n">Agent</span>
</span><span id="__span-36-8"><a id="__codelineno-36-8" name="__codelineno-36-8" href="#__codelineno-36-8"></a>
</span><span id="__span-36-9"><a id="__codelineno-36-9" name="__codelineno-36-9" href="#__codelineno-36-9"></a><span class="n">A</span> <span class="o">=</span> <span class="n">TypeVar</span><span class="p">(</span><span class="s2">&quot;A&quot;</span><span class="p">)</span>
</span><span id="__span-36-10"><a id="__codelineno-36-10" name="__codelineno-36-10" href="#__codelineno-36-10"></a><span class="n">B</span> <span class="o">=</span> <span class="n">TypeVar</span><span class="p">(</span><span class="s2">&quot;B&quot;</span><span class="p">)</span>
</span><span id="__span-36-11"><a id="__codelineno-36-11" name="__codelineno-36-11" href="#__codelineno-36-11"></a>
</span><span id="__span-36-12"><a id="__codelineno-36-12" name="__codelineno-36-12" href="#__codelineno-36-12"></a><span class="k">class</span><span class="w"> </span><span class="nc">MyAgent</span><span class="p">(</span><span class="n">Agent</span><span class="p">[</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">]):</span>  <span class="c1"># Generic</span>
</span><span id="__span-36-13"><a id="__codelineno-36-13" name="__codelineno-36-13" href="#__codelineno-36-13"></a>    <span class="o">...</span>
</span><span id="__span-36-14"><a id="__codelineno-36-14" name="__codelineno-36-14" href="#__codelineno-36-14"></a>
</span><span id="__span-36-15"><a id="__codelineno-36-15" name="__codelineno-36-15" href="#__codelineno-36-15"></a><span class="c1"># Or for concrete types</span>
</span><span id="__span-36-16"><a id="__codelineno-36-16" name="__codelineno-36-16" href="#__codelineno-36-16"></a><span class="k">class</span><span class="w"> </span><span class="nc">StrToIntAgent</span><span class="p">(</span><span class="n">Agent</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]):</span>  <span class="c1"># Requires proper Agent base</span>
</span><span id="__span-36-17"><a id="__codelineno-36-17" name="__codelineno-36-17" href="#__codelineno-36-17"></a>    <span class="o">...</span>
</span></code></pre></div></p>
<p><strong>Prevention</strong>: Always import <code>TypeVar</code> and define type variables at module level.</p>
<h3 id="error-2-module-import-issues-no-module-named-bootstrap">Error 2: Module Import Issues - "No module named bootstrap"</h3>
<p><strong>Symptom</strong>:
<div class="language-text highlight"><pre><span></span><code><span id="__span-37-1"><a id="__codelineno-37-1" name="__codelineno-37-1" href="#__codelineno-37-1"></a>ModuleNotFoundError: No module named &#39;bootstrap&#39;
</span></code></pre></div></p>
<p><strong>Cause</strong>: Package structure not set up correctly, or running from wrong directory.</p>
<p><strong>Fix</strong>:
<div class="language-bash highlight"><pre><span></span><code><span id="__span-38-1"><a id="__codelineno-38-1" name="__codelineno-38-1" href="#__codelineno-38-1"></a><span class="c1"># Check pyproject.toml exists and has correct structure</span>
</span><span id="__span-38-2"><a id="__codelineno-38-2" name="__codelineno-38-2" href="#__codelineno-38-2"></a>cat<span class="w"> </span>pyproject.toml<span class="w">  </span><span class="c1"># Should have [project] with dependencies</span>
</span><span id="__span-38-3"><a id="__codelineno-38-3" name="__codelineno-38-3" href="#__codelineno-38-3"></a>
</span><span id="__span-38-4"><a id="__codelineno-38-4" name="__codelineno-38-4" href="#__codelineno-38-4"></a><span class="c1"># Install in development mode</span>
</span><span id="__span-38-5"><a id="__codelineno-38-5" name="__codelineno-38-5" href="#__codelineno-38-5"></a>pip<span class="w"> </span>install<span class="w"> </span>-e<span class="w"> </span>.
</span><span id="__span-38-6"><a id="__codelineno-38-6" name="__codelineno-38-6" href="#__codelineno-38-6"></a>
</span><span id="__span-38-7"><a id="__codelineno-38-7" name="__codelineno-38-7" href="#__codelineno-38-7"></a><span class="c1"># Or ensure you&#39;re running from correct directory</span>
</span><span id="__span-38-8"><a id="__codelineno-38-8" name="__codelineno-38-8" href="#__codelineno-38-8"></a><span class="nb">cd</span><span class="w"> </span>impl/claude/
</span><span id="__span-38-9"><a id="__codelineno-38-9" name="__codelineno-38-9" href="#__codelineno-38-9"></a>python<span class="w"> </span>-m<span class="w"> </span>pytest<span class="w">  </span><span class="c1"># Use module syntax</span>
</span></code></pre></div></p>
<p><strong>Prevention</strong>: Use proper Python packaging from the start. No <code>sys.path</code> hacks.</p>
<h3 id="error-3-contradict-false-negatives-should-detect-tension-but-doesnt">Error 3: Contradict False Negatives - "Should detect tension but doesn't"</h3>
<p><strong>Symptom</strong>: <code>Contradict(a, b)</code> returns <code>None</code> when there's an obvious conflict.</p>
<p><strong>Cause</strong>: Contradict implementation not comprehensive, or conflict is subtle/requires domain knowledge.</p>
<p><strong>Example</strong>:
<div class="language-python highlight"><pre><span></span><code><span id="__span-39-1"><a id="__codelineno-39-1" name="__codelineno-39-1" href="#__codelineno-39-1"></a><span class="c1"># Spec says: &quot;Agent must be stateless&quot;</span>
</span><span id="__span-39-2"><a id="__codelineno-39-2" name="__codelineno-39-2" href="#__codelineno-39-2"></a><span class="c1"># Impl has: self.cache = {}  # State!</span>
</span><span id="__span-39-3"><a id="__codelineno-39-3" name="__codelineno-39-3" href="#__codelineno-39-3"></a><span class="c1"># But Contradict returns None—missed it</span>
</span></code></pre></div></p>
<p><strong>Fix</strong>:
1. <strong>Extend TensionDetector</strong>: Add domain-specific detectors
2. <strong>Be explicit in specs</strong>: State requirements clearly
3. <strong>Use Judge as backup</strong>: Judge can catch what Contradict misses</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-40-1"><a id="__codelineno-40-1" name="__codelineno-40-1" href="#__codelineno-40-1"></a><span class="c1"># Add custom tension detector</span>
</span><span id="__span-40-2"><a id="__codelineno-40-2" name="__codelineno-40-2" href="#__codelineno-40-2"></a><span class="k">class</span><span class="w"> </span><span class="nc">StatefulnessDetector</span><span class="p">(</span><span class="n">TensionDetector</span><span class="p">):</span>
</span><span id="__span-40-3"><a id="__codelineno-40-3" name="__codelineno-40-3" href="#__codelineno-40-3"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">detect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">spec</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">impl</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Tension</span><span class="p">]:</span>
</span><span id="__span-40-4"><a id="__codelineno-40-4" name="__codelineno-40-4" href="#__codelineno-40-4"></a>        <span class="k">if</span> <span class="s2">&quot;stateless&quot;</span> <span class="ow">in</span> <span class="n">spec</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">and</span> <span class="s2">&quot;self.&quot;</span> <span class="ow">in</span> <span class="n">impl</span><span class="p">:</span>
</span><span id="__span-40-5"><a id="__codelineno-40-5" name="__codelineno-40-5" href="#__codelineno-40-5"></a>            <span class="c1"># Check for instance variables (crude heuristic)</span>
</span><span id="__span-40-6"><a id="__codelineno-40-6" name="__codelineno-40-6" href="#__codelineno-40-6"></a>            <span class="k">return</span> <span class="n">Tension</span><span class="p">(</span>
</span><span id="__span-40-7"><a id="__codelineno-40-7" name="__codelineno-40-7" href="#__codelineno-40-7"></a>                <span class="nb">type</span><span class="o">=</span><span class="n">TensionType</span><span class="o">.</span><span class="n">PRAGMATIC</span><span class="p">,</span>
</span><span id="__span-40-8"><a id="__codelineno-40-8" name="__codelineno-40-8" href="#__codelineno-40-8"></a>                <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Spec requires stateless, impl has instance state&quot;</span><span class="p">,</span>
</span><span id="__span-40-9"><a id="__codelineno-40-9" name="__codelineno-40-9" href="#__codelineno-40-9"></a>                <span class="o">...</span>
</span><span id="__span-40-10"><a id="__codelineno-40-10" name="__codelineno-40-10" href="#__codelineno-40-10"></a>            <span class="p">)</span>
</span><span id="__span-40-11"><a id="__codelineno-40-11" name="__codelineno-40-11" href="#__codelineno-40-11"></a>        <span class="k">return</span> <span class="kc">None</span>
</span></code></pre></div>
<p><strong>Prevention</strong>: Write explicit specs. Use both Contradict AND Judge.</p>
<h3 id="error-4-fix-non-convergence-fix-loops-forever">Error 4: Fix Non-Convergence - "Fix loops forever"</h3>
<p><strong>Symptom</strong>: <code>fix()</code> runs indefinitely without reaching fixed point.</p>
<p><strong>Cause</strong>:
1. <code>equality_check</code> never returns True
2. Transform function doesn't converge
3. No state accumulation (see Pitfall 3 in PROTOCOL)</p>
<p><strong>Fix</strong>:
<div class="language-python highlight"><pre><span></span><code><span id="__span-41-1"><a id="__codelineno-41-1" name="__codelineno-41-1" href="#__codelineno-41-1"></a><span class="c1"># Add max iterations and debugging</span>
</span><span id="__span-41-2"><a id="__codelineno-41-2" name="__codelineno-41-2" href="#__codelineno-41-2"></a><span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="n">fix</span><span class="p">(</span>
</span><span id="__span-41-3"><a id="__codelineno-41-3" name="__codelineno-41-3" href="#__codelineno-41-3"></a>    <span class="n">transform</span><span class="o">=</span><span class="n">my_transform</span><span class="p">,</span>
</span><span id="__span-41-4"><a id="__codelineno-41-4" name="__codelineno-41-4" href="#__codelineno-41-4"></a>    <span class="n">initial</span><span class="o">=</span><span class="n">initial_state</span><span class="p">,</span>
</span><span id="__span-41-5"><a id="__codelineno-41-5" name="__codelineno-41-5" href="#__codelineno-41-5"></a>    <span class="n">equality_check</span><span class="o">=</span><span class="k">lambda</span> <span class="n">prev</span><span class="p">,</span> <span class="n">curr</span><span class="p">:</span> <span class="n">prev</span> <span class="o">==</span> <span class="n">curr</span><span class="p">,</span>
</span><span id="__span-41-6"><a id="__codelineno-41-6" name="__codelineno-41-6" href="#__codelineno-41-6"></a>    <span class="n">max_iterations</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>  <span class="c1"># Safety limit</span>
</span><span id="__span-41-7"><a id="__codelineno-41-7" name="__codelineno-41-7" href="#__codelineno-41-7"></a><span class="p">)</span>
</span><span id="__span-41-8"><a id="__codelineno-41-8" name="__codelineno-41-8" href="#__codelineno-41-8"></a>
</span><span id="__span-41-9"><a id="__codelineno-41-9" name="__codelineno-41-9" href="#__codelineno-41-9"></a><span class="c1"># Debug: Log iterations</span>
</span><span id="__span-41-10"><a id="__codelineno-41-10" name="__codelineno-41-10" href="#__codelineno-41-10"></a><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">debug_transform</span><span class="p">(</span><span class="n">state</span><span class="p">):</span>
</span><span id="__span-41-11"><a id="__codelineno-41-11" name="__codelineno-41-11" href="#__codelineno-41-11"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Iteration: </span><span class="si">{</span><span class="n">state</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="__span-41-12"><a id="__codelineno-41-12" name="__codelineno-41-12" href="#__codelineno-41-12"></a>    <span class="k">return</span> <span class="k">await</span> <span class="n">my_transform</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>
</span><span id="__span-41-13"><a id="__codelineno-41-13" name="__codelineno-41-13" href="#__codelineno-41-13"></a>
</span><span id="__span-41-14"><a id="__codelineno-41-14" name="__codelineno-41-14" href="#__codelineno-41-14"></a><span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="n">fix</span><span class="p">(</span><span class="n">transform</span><span class="o">=</span><span class="n">debug_transform</span><span class="p">,</span> <span class="o">...</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Prevention</strong>:
- Always accumulate state/confidence in transform
- Test equality_check separately
- Add max_iterations safety limit
- Use Fix with memory pattern (see PROTOCOL Pitfall 3)</p>
<h3 id="error-5-low-autopoiesis-score-20">Error 5: Low Autopoiesis Score (&lt;20%)</h3>
<p><strong>Symptom</strong>: Implementation complete but hardly any agent usage.</p>
<p><strong>Cause</strong>: Forgot to use agents during development, or used them only at beginning.</p>
<p><strong>Fix</strong>:
1. <strong>Retrospectively document</strong>: "Where COULD I have used agents?"
2. <strong>Refactor naming</strong>: Use K-gent to rename poorly-named things
3. <strong>Use Judge to review</strong>: Let Judge suggest improvements
4. <strong>For next feature</strong>: Set reminder to invoke agents continuously</p>
<p><strong>Pattern for sustained autopoiesis</strong>:
<div class="language-python highlight"><pre><span></span><code><span id="__span-42-1"><a id="__codelineno-42-1" name="__codelineno-42-1" href="#__codelineno-42-1"></a><span class="c1"># Checkpoint throughout development</span>
</span><span id="__span-42-2"><a id="__codelineno-42-2" name="__codelineno-42-2" href="#__codelineno-42-2"></a><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">feature_implementation</span><span class="p">():</span>
</span><span id="__span-42-3"><a id="__codelineno-42-3" name="__codelineno-42-3" href="#__codelineno-42-3"></a>    <span class="c1"># Phase 1: Design (use CreativityCoach)</span>
</span><span id="__span-42-4"><a id="__codelineno-42-4" name="__codelineno-42-4" href="#__codelineno-42-4"></a>    <span class="n">design</span> <span class="o">=</span> <span class="k">await</span> <span class="n">runtime</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">creativity_coach</span><span class="p">(),</span> <span class="o">...</span><span class="p">)</span>
</span><span id="__span-42-5"><a id="__codelineno-42-5" name="__codelineno-42-5" href="#__codelineno-42-5"></a>
</span><span id="__span-42-6"><a id="__codelineno-42-6" name="__codelineno-42-6" href="#__codelineno-42-6"></a>    <span class="c1"># Phase 2: Naming (use K-gent)</span>
</span><span id="__span-42-7"><a id="__codelineno-42-7" name="__codelineno-42-7" href="#__codelineno-42-7"></a>    <span class="n">name</span> <span class="o">=</span> <span class="k">await</span> <span class="n">runtime</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">kgent</span><span class="p">(),</span> <span class="o">...</span><span class="p">)</span>
</span><span id="__span-42-8"><a id="__codelineno-42-8" name="__codelineno-42-8" href="#__codelineno-42-8"></a>
</span><span id="__span-42-9"><a id="__codelineno-42-9" name="__codelineno-42-9" href="#__codelineno-42-9"></a>    <span class="c1"># Phase 3: Implementation (manual, guided by design)</span>
</span><span id="__span-42-10"><a id="__codelineno-42-10" name="__codelineno-42-10" href="#__codelineno-42-10"></a>    <span class="n">code</span> <span class="o">=</span> <span class="n">implement_from_design</span><span class="p">(</span><span class="n">design</span><span class="p">)</span>
</span><span id="__span-42-11"><a id="__codelineno-42-11" name="__codelineno-42-11" href="#__codelineno-42-11"></a>
</span><span id="__span-42-12"><a id="__codelineno-42-12" name="__codelineno-42-12" href="#__codelineno-42-12"></a>    <span class="c1"># Phase 4: Review (use Judge)</span>
</span><span id="__span-42-13"><a id="__codelineno-42-13" name="__codelineno-42-13" href="#__codelineno-42-13"></a>    <span class="n">verdict</span> <span class="o">=</span> <span class="k">await</span> <span class="n">judge</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span><span class="n">JudgeInput</span><span class="p">(</span><span class="n">agent</span><span class="o">=</span><span class="n">code</span><span class="p">,</span> <span class="o">...</span><span class="p">))</span>
</span><span id="__span-42-14"><a id="__codelineno-42-14" name="__codelineno-42-14" href="#__codelineno-42-14"></a>
</span><span id="__span-42-15"><a id="__codelineno-42-15" name="__codelineno-42-15" href="#__codelineno-42-15"></a>    <span class="c1"># Phase 5: Check consistency (use Contradict)</span>
</span><span id="__span-42-16"><a id="__codelineno-42-16" name="__codelineno-42-16" href="#__codelineno-42-16"></a>    <span class="n">tension</span> <span class="o">=</span> <span class="k">await</span> <span class="n">contradict</span><span class="o">.</span><span class="n">invoke</span><span class="p">((</span><span class="n">spec</span><span class="p">,</span> <span class="n">code</span><span class="p">))</span>
</span><span id="__span-42-17"><a id="__codelineno-42-17" name="__codelineno-42-17" href="#__codelineno-42-17"></a>
</span><span id="__span-42-18"><a id="__codelineno-42-18" name="__codelineno-42-18" href="#__codelineno-42-18"></a>    <span class="c1"># Now autopoiesis is high (used agents at 4/5 phases)</span>
</span></code></pre></div></p>
<p><strong>Prevention</strong>: Use agents FIRST (see Step 0 in this doc), not just once at start.</p>
<h3 id="error-6-missing-type-annotations">Error 6: Missing Type Annotations</h3>
<p><strong>Symptom</strong>: <code>mypy</code> reports errors, or runtime type checking fails.</p>
<p><strong>Cause</strong>: Skipped type annotations, or used <code>Any</code> too liberally.</p>
<p><strong>Fix</strong>:
<div class="language-python highlight"><pre><span></span><code><span id="__span-43-1"><a id="__codelineno-43-1" name="__codelineno-43-1" href="#__codelineno-43-1"></a><span class="c1"># WRONG: No annotations</span>
</span><span id="__span-43-2"><a id="__codelineno-43-2" name="__codelineno-43-2" href="#__codelineno-43-2"></a><span class="k">def</span><span class="w"> </span><span class="nf">process</span><span class="p">(</span><span class="nb">input</span><span class="p">):</span>  <span class="c1"># What type?</span>
</span><span id="__span-43-3"><a id="__codelineno-43-3" name="__codelineno-43-3" href="#__codelineno-43-3"></a>    <span class="k">return</span> <span class="n">transform</span><span class="p">(</span><span class="nb">input</span><span class="p">)</span>  <span class="c1"># What does this return?</span>
</span><span id="__span-43-4"><a id="__codelineno-43-4" name="__codelineno-43-4" href="#__codelineno-43-4"></a>
</span><span id="__span-43-5"><a id="__codelineno-43-5" name="__codelineno-43-5" href="#__codelineno-43-5"></a><span class="c1"># RIGHT: Full annotations</span>
</span><span id="__span-43-6"><a id="__codelineno-43-6" name="__codelineno-43-6" href="#__codelineno-43-6"></a><span class="k">def</span><span class="w"> </span><span class="nf">process</span><span class="p">(</span><span class="nb">input</span><span class="p">:</span> <span class="n">InputType</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">OutputType</span><span class="p">:</span>
</span><span id="__span-43-7"><a id="__codelineno-43-7" name="__codelineno-43-7" href="#__codelineno-43-7"></a>    <span class="n">result</span><span class="p">:</span> <span class="n">OutputType</span> <span class="o">=</span> <span class="n">transform</span><span class="p">(</span><span class="nb">input</span><span class="p">)</span>
</span><span id="__span-43-8"><a id="__codelineno-43-8" name="__codelineno-43-8" href="#__codelineno-43-8"></a>    <span class="k">return</span> <span class="n">result</span>
</span><span id="__span-43-9"><a id="__codelineno-43-9" name="__codelineno-43-9" href="#__codelineno-43-9"></a>
</span><span id="__span-43-10"><a id="__codelineno-43-10" name="__codelineno-43-10" href="#__codelineno-43-10"></a><span class="c1"># For generics</span>
</span><span id="__span-43-11"><a id="__codelineno-43-11" name="__codelineno-43-11" href="#__codelineno-43-11"></a><span class="n">A</span> <span class="o">=</span> <span class="n">TypeVar</span><span class="p">(</span><span class="s2">&quot;A&quot;</span><span class="p">)</span>
</span><span id="__span-43-12"><a id="__codelineno-43-12" name="__codelineno-43-12" href="#__codelineno-43-12"></a><span class="n">B</span> <span class="o">=</span> <span class="n">TypeVar</span><span class="p">(</span><span class="s2">&quot;B&quot;</span><span class="p">)</span>
</span><span id="__span-43-13"><a id="__codelineno-43-13" name="__codelineno-43-13" href="#__codelineno-43-13"></a>
</span><span id="__span-43-14"><a id="__codelineno-43-14" name="__codelineno-43-14" href="#__codelineno-43-14"></a><span class="k">class</span><span class="w"> </span><span class="nc">MyAgent</span><span class="p">(</span><span class="n">Agent</span><span class="p">[</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">]):</span>
</span><span id="__span-43-15"><a id="__codelineno-43-15" name="__codelineno-43-15" href="#__codelineno-43-15"></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">invoke</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">input</span><span class="p">:</span> <span class="n">A</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">B</span><span class="p">:</span>
</span><span id="__span-43-16"><a id="__codelineno-43-16" name="__codelineno-43-16" href="#__codelineno-43-16"></a>        <span class="o">...</span>
</span></code></pre></div></p>
<p><strong>Prevention</strong>: Use <code>mypy --strict</code> from the start. Fix warnings incrementally.</p>
<h3 id="error-7-composition-type-mismatches">Error 7: Composition Type Mismatches</h3>
<p><strong>Symptom</strong>:
<div class="language-text highlight"><pre><span></span><code><span id="__span-44-1"><a id="__codelineno-44-1" name="__codelineno-44-1" href="#__codelineno-44-1"></a>TypeError: Cannot compose Agent[A, B] with Agent[C, D] (B != C)
</span></code></pre></div></p>
<p><strong>Cause</strong>: Output type of first agent doesn't match input type of second.</p>
<p><strong>Example</strong>:
<div class="language-python highlight"><pre><span></span><code><span id="__span-45-1"><a id="__codelineno-45-1" name="__codelineno-45-1" href="#__codelineno-45-1"></a><span class="c1"># WRONG: Type mismatch</span>
</span><span id="__span-45-2"><a id="__codelineno-45-2" name="__codelineno-45-2" href="#__codelineno-45-2"></a><span class="n">agent1</span><span class="p">:</span> <span class="n">Agent</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">StrToInt</span><span class="p">()</span>
</span><span id="__span-45-3"><a id="__codelineno-45-3" name="__codelineno-45-3" href="#__codelineno-45-3"></a><span class="n">agent2</span><span class="p">:</span> <span class="n">Agent</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="n">StrToBool</span><span class="p">()</span>  <span class="c1"># Expects str, not int</span>
</span><span id="__span-45-4"><a id="__codelineno-45-4" name="__codelineno-45-4" href="#__codelineno-45-4"></a>
</span><span id="__span-45-5"><a id="__codelineno-45-5" name="__codelineno-45-5" href="#__codelineno-45-5"></a><span class="n">pipeline</span> <span class="o">=</span> <span class="n">agent1</span> <span class="o">&gt;&gt;</span> <span class="n">agent2</span>  <span class="c1"># Error: int -&gt; str mismatch</span>
</span></code></pre></div></p>
<p><strong>Fix</strong>: Use adapters or check types manually.</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-46-1"><a id="__codelineno-46-1" name="__codelineno-46-1" href="#__codelineno-46-1"></a><span class="c1"># Option 1: Add adapter</span>
</span><span id="__span-46-2"><a id="__codelineno-46-2" name="__codelineno-46-2" href="#__codelineno-46-2"></a><span class="n">int_to_str</span> <span class="o">=</span> <span class="n">IntToStr</span><span class="p">()</span>
</span><span id="__span-46-3"><a id="__codelineno-46-3" name="__codelineno-46-3" href="#__codelineno-46-3"></a><span class="n">pipeline</span> <span class="o">=</span> <span class="n">agent1</span> <span class="o">&gt;&gt;</span> <span class="n">int_to_str</span> <span class="o">&gt;&gt;</span> <span class="n">agent2</span>  <span class="c1"># str -&gt; int -&gt; str -&gt; bool</span>
</span><span id="__span-46-4"><a id="__codelineno-46-4" name="__codelineno-46-4" href="#__codelineno-46-4"></a>
</span><span id="__span-46-5"><a id="__codelineno-46-5" name="__codelineno-46-5" href="#__codelineno-46-5"></a><span class="c1"># Option 2: Use correct types from start</span>
</span><span id="__span-46-6"><a id="__codelineno-46-6" name="__codelineno-46-6" href="#__codelineno-46-6"></a><span class="n">agent2b</span><span class="p">:</span> <span class="n">Agent</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="n">IntToBool</span><span class="p">()</span>
</span><span id="__span-46-7"><a id="__codelineno-46-7" name="__codelineno-46-7" href="#__codelineno-46-7"></a><span class="n">pipeline</span> <span class="o">=</span> <span class="n">agent1</span> <span class="o">&gt;&gt;</span> <span class="n">agent2b</span>  <span class="c1"># str -&gt; int -&gt; bool ✓</span>
</span></code></pre></div>
<p><strong>Prevention</strong>: Write out type signatures before implementing. Verify B_1 == A_2 for <code>f: Agent[A, B_1]</code> and <code>g: Agent[A_2, C]</code>.</p>
<h3 id="error-8-asyncawait-mistakes">Error 8: Async/Await Mistakes</h3>
<p><strong>Symptom</strong>:
<div class="language-text highlight"><pre><span></span><code><span id="__span-47-1"><a id="__codelineno-47-1" name="__codelineno-47-1" href="#__codelineno-47-1"></a>RuntimeWarning: coroutine was never awaited
</span></code></pre></div></p>
<p><strong>Cause</strong>: Forgot <code>await</code> on async function call.</p>
<p><strong>Fix</strong>:
<div class="language-python highlight"><pre><span></span><code><span id="__span-48-1"><a id="__codelineno-48-1" name="__codelineno-48-1" href="#__codelineno-48-1"></a><span class="c1"># WRONG: Missing await</span>
</span><span id="__span-48-2"><a id="__codelineno-48-2" name="__codelineno-48-2" href="#__codelineno-48-2"></a><span class="n">result</span> <span class="o">=</span> <span class="n">agent</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span><span class="nb">input</span><span class="p">)</span>  <span class="c1"># Returns coroutine, not result</span>
</span><span id="__span-48-3"><a id="__codelineno-48-3" name="__codelineno-48-3" href="#__codelineno-48-3"></a>
</span><span id="__span-48-4"><a id="__codelineno-48-4" name="__codelineno-48-4" href="#__codelineno-48-4"></a><span class="c1"># RIGHT: Await the coroutine</span>
</span><span id="__span-48-5"><a id="__codelineno-48-5" name="__codelineno-48-5" href="#__codelineno-48-5"></a><span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="n">agent</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span><span class="nb">input</span><span class="p">)</span>
</span><span id="__span-48-6"><a id="__codelineno-48-6" name="__codelineno-48-6" href="#__codelineno-48-6"></a>
</span><span id="__span-48-7"><a id="__codelineno-48-7" name="__codelineno-48-7" href="#__codelineno-48-7"></a><span class="c1"># For parallel execution</span>
</span><span id="__span-48-8"><a id="__codelineno-48-8" name="__codelineno-48-8" href="#__codelineno-48-8"></a><span class="n">results</span> <span class="o">=</span> <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span>
</span><span id="__span-48-9"><a id="__codelineno-48-9" name="__codelineno-48-9" href="#__codelineno-48-9"></a>    <span class="n">agent1</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span><span class="n">input1</span><span class="p">),</span>
</span><span id="__span-48-10"><a id="__codelineno-48-10" name="__codelineno-48-10" href="#__codelineno-48-10"></a>    <span class="n">agent2</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span><span class="n">input2</span><span class="p">),</span>
</span><span id="__span-48-11"><a id="__codelineno-48-11" name="__codelineno-48-11" href="#__codelineno-48-11"></a><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Prevention</strong>: All <code>Agent.invoke()</code> calls are async and require <code>await</code>.</p>
<h3 id="error-9-ground-extraction-failures">Error 9: Ground Extraction Failures</h3>
<p><strong>Symptom</strong>: <code>Ground</code> agent can't parse persona.md or returns incomplete data.</p>
<p><strong>Cause</strong>: persona.md format doesn't match expected structure, or parser is too rigid.</p>
<p><strong>Fix</strong>:
<div class="language-python highlight"><pre><span></span><code><span id="__span-49-1"><a id="__codelineno-49-1" name="__codelineno-49-1" href="#__codelineno-49-1"></a><span class="c1"># Option 1: Use GroundParser agent (recommended, see Phase 5.3)</span>
</span><span id="__span-49-2"><a id="__codelineno-49-2" name="__codelineno-49-2" href="#__codelineno-49-2"></a><span class="n">parser</span> <span class="o">=</span> <span class="n">GroundParser</span><span class="p">()</span>
</span><span id="__span-49-3"><a id="__codelineno-49-3" name="__codelineno-49-3" href="#__codelineno-49-3"></a><span class="n">persona_seed</span> <span class="o">=</span> <span class="k">await</span> <span class="n">parser</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span><span class="n">persona_md_content</span><span class="p">)</span>
</span><span id="__span-49-4"><a id="__codelineno-49-4" name="__codelineno-49-4" href="#__codelineno-49-4"></a>
</span><span id="__span-49-5"><a id="__codelineno-49-5" name="__codelineno-49-5" href="#__codelineno-49-5"></a><span class="c1"># Option 2: Improve parser robustness</span>
</span><span id="__span-49-6"><a id="__codelineno-49-6" name="__codelineno-49-6" href="#__codelineno-49-6"></a><span class="c1"># Make parser handle variations in markdown format</span>
</span><span id="__span-49-7"><a id="__codelineno-49-7" name="__codelineno-49-7" href="#__codelineno-49-7"></a><span class="c1"># Use LLM-based extraction for flexibility</span>
</span></code></pre></div></p>
<p><strong>Prevention</strong>: Keep persona.md format consistent. Use agent-based parsing (GroundParser) for flexibility.</p>
<h3 id="error-10-judge-rejects-everything">Error 10: Judge Rejects Everything</h3>
<p><strong>Symptom</strong>: Judge always returns REJECT, even for reasonable code.</p>
<p><strong>Cause</strong>: Overly strict principles, or Judge implementation has bugs.</p>
<p><strong>Fix</strong>:
1. <strong>Check Judge implementation</strong>: Verify seven mini-judges logic
2. <strong>Review principles</strong>: Are they realistic? (See <code>spec/principles.md</code>)
3. <strong>Use REVISE mode</strong>: Judge should suggest improvements, not just reject
4. <strong>Incremental validation</strong>: Test Judge on known-good agents first</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-50-1"><a id="__codelineno-50-1" name="__codelineno-50-1" href="#__codelineno-50-1"></a><span class="c1"># Debug Judge by testing on Id (should ACCEPT)</span>
</span><span id="__span-50-2"><a id="__codelineno-50-2" name="__codelineno-50-2" href="#__codelineno-50-2"></a><span class="n">verdict</span> <span class="o">=</span> <span class="k">await</span> <span class="n">judge</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span><span class="n">JudgeInput</span><span class="p">(</span>
</span><span id="__span-50-3"><a id="__codelineno-50-3" name="__codelineno-50-3" href="#__codelineno-50-3"></a>    <span class="n">agent_spec</span><span class="o">=</span><span class="n">id_agent_code</span><span class="p">,</span>
</span><span id="__span-50-4"><a id="__codelineno-50-4" name="__codelineno-50-4" href="#__codelineno-50-4"></a>    <span class="n">principles</span><span class="o">=</span><span class="n">PRINCIPLES</span>
</span><span id="__span-50-5"><a id="__codelineno-50-5" name="__codelineno-50-5" href="#__codelineno-50-5"></a><span class="p">))</span>
</span><span id="__span-50-6"><a id="__codelineno-50-6" name="__codelineno-50-6" href="#__codelineno-50-6"></a><span class="k">assert</span> <span class="n">verdict</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">VerdictType</span><span class="o">.</span><span class="n">ACCEPT</span>  <span class="c1"># Id should always pass</span>
</span><span id="__span-50-7"><a id="__codelineno-50-7" name="__codelineno-50-7" href="#__codelineno-50-7"></a>
</span><span id="__span-50-8"><a id="__codelineno-50-8" name="__codelineno-50-8" href="#__codelineno-50-8"></a><span class="c1"># If this fails, Judge is too strict or buggy</span>
</span></code></pre></div>
<p><strong>Prevention</strong>: Validate Judge against bootstrap agents first (they should all ACCEPT).</p>
<h3 id="troubleshooting-checklist">Troubleshooting Checklist</h3>
<p>When stuck:</p>
<ol>
<li><strong>Check types first</strong> - Most errors are type mismatches (use <code>mypy --strict</code>)</li>
<li><strong>Verify imports</strong> - Ensure proper package structure (no <code>sys.path</code> hacks)</li>
<li><strong>Test components in isolation</strong> - Before composing, verify each agent works alone</li>
<li><strong>Use agents to debug</strong> - K-gent (REFLECT mode) can help identify issues</li>
<li><strong>Check Ground</strong> - Are environmental assumptions explicit?</li>
<li><strong>Read error messages carefully</strong> - Python tracebacks point to exact line</li>
<li><strong>Consult HYDRATE.md</strong> - Recent changes and known issues documented there</li>
</ol>
<h3 id="getting-help">Getting Help</h3>
<p>If errors persist:
1. Check <code>HYDRATE.md</code> for recent changes that might affect your code
2. Review <code>AUTONOMOUS_BOOTSTRAP_PROTOCOL.md</code> "Common Pitfalls" section
3. Use Contradict to compare your impl with spec
4. Use Judge to get specific feedback on what's wrong
5. Use K-gent (REFLECT mode) to explore the problem space</p>
<hr />
<h2 id="quick-start">Quick Start</h2>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-51-1"><a id="__codelineno-51-1" name="__codelineno-51-1" href="#__codelineno-51-1"></a>claude<span class="w"> </span><span class="s2">&quot;Read docs/BOOTSTRAP_PROMPT.md. I want to implement {X}. Start with CreativityCoach.&quot;</span>
</span></code></pre></div>
<p>Use kgents agents to HELP you implement—that's autopoiesis.</p>












                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2025 Kent Gang
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        
<div class="md-social">
  
    
    
    
    
    <a href="https://github.com/kentgang/kgents" target="_blank" rel="noopener" title="kgents on GitHub" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "../..", "features": ["content.code.copy", "content.code.annotate", "content.tabs.link", "navigation.instant", "navigation.tracking", "navigation.tabs", "navigation.sections", "navigation.expand", "navigation.top", "search.suggest", "search.highlight", "toc.follow"], "search": "../../assets/javascripts/workers/search.7a47a382.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.e71a0d61.min.js"></script>
      
    
  </body>
</html>